var angloFingeringsGenerator=function(e){var n,a=function(e,n,a,t){this.name=e,this.notes=n,this.cost=a,this.finger=t},t={L1a:new a("L1a",["E,","F,"],10,"l4"),L2a:new a("L2a",["A,","_B,"],10,"l4"),L3a:new a("L3a",["^C","_E"],10,"l3"),L4a:new a("L4a",["A","G"],10,"l2"),L5a:new a("L5a",["^G","_B"],10,"l1"),L1:new a("L1",["C,","G,"],1,"l4"),L2:new a("L2",["G,","B,"],1,"l4"),L3:new a("L3",["C","D"],1,"l3"),L4:new a("L4",["E","F"],1,"l2"),L5:new a("L5",["G","A"],1,"l1"),L6:new a("L6",["B,","A,"],1,"l4"),L7:new a("L7",["D","^F"],2,"l4"),L8:new a("L8",["G","A"],2,"l3"),L9:new a("L9",["B","c"],2,"l2"),L10:new a("L10",["d","e"],2,"l1"),R1:new a("R1",["c","B"],1,"r1"),R2:new a("R2",["e","d"],1,"r2"),R3:new a("R3",["g","f"],2,"r3"),R4:new a("R4",["c'","a"],2,"r4"),R5:new a("R5",["e'","b"],2,"r4"),R6:new a("R6",["g","^f"],1,"r1"),R7:new a("R7",["b","a"],1,"r2"),R8:new a("R8",["d'","c'"],1,"r3"),R9:new a("R9",["g'","e'"],1,"r4"),R10:new a("R10",["b'","^f'"],1,"r4")};new a("L1a",["E,","F,"],10,"l4"),new a("L2a",["A,","_B,"],10,"l4"),new a("L3a",["^C","_E"],10,"l3"),new a("L4a",["A","G"],10,"l2"),new a("L5a",["^G","_B"],10,"l1"),new a("L1",["C,","G,"],1,"l4"),new a("L2",["G,","B,"],1,"l4"),new a("L3",["C","D"],1,"l3"),new a("L4",["E","F"],1,"l2"),new a("L5",["G","A"],1,"l1"),new a("L6",["B,","A,"],1,"l4"),new a("L7",["D","^F"],2,"l4"),new a("L8",["G","A"],2,"l3"),new a("L9",["B","c"],2,"l2"),new a("L10",["d","e"],1,"l1"),new a("R1",["c","B"],1,"r1"),new a("R2",["e","d"],2,"r2"),new a("R3",["g","f"],2,"r3"),new a("R4",["c'","a"],2,"r4"),new a("R5",["e'","b"],2,"r4"),new a("R6",["g","^f"],1,"r1"),new a("R7",["b","a"],1,"r2"),new a("R8",["d'","c'"],1,"r3"),new a("R9",["g'","e'"],1,"r4"),new a("R10",["b'","^f'"],1,"r4");var r={L1a:new a("L1a",["E,","F,"],10,"l4"),L2a:new a("L2a",["A,","_B,"],10,"l4"),L3a:new a("L3a",["^C","_E"],10,"l3"),L4a:new a("L4a",["A","G"],10,"l2"),L5a:new a("L5a",["^G","_B"],10,"l1"),L1:new a("L1",["C,","G,"],1,"l4"),L2:new a("L2",["G,","B,"],1,"l4"),L3:new a("L3",["C","D"],1,"l3"),L4:new a("L4",["E","F"],1,"l2"),L5:new a("L5",["G","A"],1,"l1"),L6:new a("L6",["B,","A,"],1,"l4"),L7:new a("L7",["D","^F"],2,"l4"),L8:new a("L8",["G","A"],2,"l3"),L9:new a("L9",["B","z"],2,"l2"),L9a:new a("L9",["z","c"],1,"l2"),L10:new a("L10",["d","e"],1,"l1"),R1:new a("R1",["c","x"],2,"r1"),R1x:new a("R1",["x","B"],1,"r1"),R2:new a("R2",["e","d"],2,"r2"),R3:new a("R3",["g","f"],2,"r3"),R4:new a("R4",["c'","a"],2,"r4"),R5:new a("R5",["e'","b"],2,"r4"),R6:new a("R6",["g","^f"],1,"r1"),R7:new a("R7",["b","a"],1,"r2"),R8:new a("R8",["d'","c'"],1,"r3"),R9:new a("R9",["g'","e'"],1,"r4"),R10:new a("R10",["b'","^f'"],1,"r4")};new a("R1a",["^d","^c"],1,"r1"),new a("R2a",["^c","^d"],10,"r2"),new a("R3a",["^g","g"],10,"r3"),new a("R4a",["^c'","_b"],10,"r4"),new a("R5a",["a","d'"],10,"r4");var s={R1a:new a("R1a",["^d","^c"],10,"r1"),R2a:new a("R2a",["^c","^d"],1,"r2"),R3a:new a("R3a",["^g","g"],10,"r3"),R4a:new a("R4a",["^c'","_b"],10,"r4"),R5a:new a("R5a",["a","d'"],10,"r4")},l={R1a:new a("R1a",["^c","^d"],10,"r1"),R2a:new a("R2a",["a","g"],10,"r2"),R3a:new a("R3a",["^g","_b"],10,"r3"),R4a:new a("R4a",["^c'","_e'"],10,"r4"),R5a:new a("R5a",["a","f'"],10,"r4")},c=null,o=null,u=null,_=null,f=null,d=0;function h(e){}function $(e){if(h("Got input:"+e),!function e(){var n,a=parseInt(gInjectTab_ConcertinaFingering);switch(c=[],o=[],a){case 0:for(var _ in s)c[_]=s[_];for(var _ in l)o[_]=l[_];for(var _ in t)c[_]=t[_],o[_]=t[_];break;case 1:for(var _ in s)c[_]=s[_];for(var _ in l)o[_]=l[_];for(var _ in r)c[_]=r[_];for(var _ in r)o[_]=r[_]}u=((n=u=0==parseInt(gInjectTab_ConcertinaStyle)?c:o).L1a.name=gAngloButtonNames[0],n.L2a.name=gAngloButtonNames[1],n.L3a.name=gAngloButtonNames[2],n.L4a.name=gAngloButtonNames[3],n.L5a.name=gAngloButtonNames[4],n.R1a.name=gAngloButtonNames[5],n.R2a.name=gAngloButtonNames[6],n.R3a.name=gAngloButtonNames[7],n.R4a.name=gAngloButtonNames[8],n.R5a.name=gAngloButtonNames[9],n.L1.name=gAngloButtonNames[10],n.L2.name=gAngloButtonNames[11],n.L3.name=gAngloButtonNames[12],n.L4.name=gAngloButtonNames[13],n.L5.name=gAngloButtonNames[14],n.R1.name=gAngloButtonNames[15],n.R1x&&(n.R1x.name=gAngloButtonNames[15]),n.R2.name=gAngloButtonNames[16],n.R3.name=gAngloButtonNames[17],n.R4.name=gAngloButtonNames[18],n.R5.name=gAngloButtonNames[19],n.L6.name=gAngloButtonNames[20],n.L7.name=gAngloButtonNames[21],n.L8.name=gAngloButtonNames[22],n.L9.name=gAngloButtonNames[23],n.L9a&&(n.L9a.name=gAngloButtonNames[23]),n.L10.name=gAngloButtonNames[24],n.R6.name=gAngloButtonNames[25],n.R7.name=gAngloButtonNames[26],n.R8.name=gAngloButtonNames[27],n.R9.name=gAngloButtonNames[28],n.R10.name=gAngloButtonNames[29],n)}(),null==(_=function e(n){var a,t,r=null,s=n.match(/[kK]: *([A-G])([b#])? *(.*?)$/m);if(null==s||s.length<3)return null;if(h("Got base key of '"+(a=void 0==s[2]?s[1]:s[1]+s[2])+"' and extra of '"+(t=s[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(h("Mode: Ionian (major)"),r=R(a,0)):-1!=t.search("mix")?(h("Mode: Mixolydian"),r=R(a,1)):-1!=t.search("dor")?(h("Mode: Dorian"),r=R(a,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(h("Mode: Aeolian (minor)"),r=R(a,3)):-1!=t.search("phr")?(h("Mode: Phrygian"),r=R(a,4)):-1!=t.search("loc")?(h("Mode: Locrian"),r=R(a,5)):-1!=t.search("lyd")?(h("Mode: Lydian"),r=R(a,-1)):-1!=t.search("exp")?(h("(Accidentals to be explicitly specified)"),r=R("C",0)):(h("Failed to determine key signature mode"),r=null),null==r)return r;var l=t.match(/_./g),c=t.match(/\^./g);for(note in l)r.flats+=l[note][1].toUpperCase();for(note in c)r.sharps+=c[note][1].toUpperCase();return r}(e)))return"ERROR: Unknown or unsupported key signature";var d,$=function e(n){for(var a,t,r=n,s=/^\w:.*$/mg;a=s.exec(n);)r=v(r,a.index,a[0].length);for(var l=/"[^"]*"/gm;t=l.exec(r);)for(var c=t.index,o=c+t[0].length,u=c;u<o;++u)r=r.substring(0,u)+"*"+r.substring(u+1);for(l=/\[[^\]|]*\]/g;t=l.exec(r);)for(var c=t.index,o=c+t[0].length,u=c;u<o;++u)r=r.substring(0,u)+"*"+r.substring(u+1);h("sanitized input:"+r);for(var f=/([=^_]?[a-gA-G][',]?|\|)/g,d=[];t=f.exec(r);){var $=t[1];if("|"==$)_.accidentalFlats="",_.accidentalSharps="",_.accidentalNaturals="";else{var g=A($);h("UnNormalized="+$+" normalized="+g),d.push(new w(t.index,$,g))}}return d}(e),G=function e(n){var a={};for(var t in n){var r=n[t].notes;if(null==r){h("Failed to find entry for button "+b);continue}r.forEach(function(e){null==a[e]?a[e]=[n[t]]:a[e].push(n[t]),null==a[e=x(e)]?a[e]=[n[t]]:a[e].push(n[t])})}return a}(u);!function e(n){for(var a in n)n[a].sort(function(e,n){return e.cost-n.cost})}(G);var F,B=(d=function e(n,t){for(var r=null,s=null,l=0;l<n.length;++l){var c=n[l],o=c.normalizedValue,u=t[o];if(null==u||u.length<1){h("Failed to find button for note "+o),h("Attempting respell...");var _=x(o);if(h("Respelled as "+_),null==(u=t[_])||u.length<1)return h("Respelling as "+_+" failed to find a button."),abcOutput="ERROR:Failed to find button for note '"+o+"'",null}var f=[];u.forEach(function(e){f.push(new m(c,e,L(c,e)))}),null==r&&(r=f),null!=s&&s.forEach(function(e){e.nextStates=f}),s=f}var d=new m(null,new a("root",[],0,"none"));return d.nextStates=r,d}($,G),n=1e8,f={},function e(n){if(0==n.nextStates.length)return h("Last state, note="+n.note.normalizedValue+" button="+n.button.name+". Popping up the stack"),new g([n],n.button.cost);var a=n.note,t=null,r=null;if(null!=a&&(t=a.unNormalizedValue,r=a.normalizedValue),h("Choosing: current note="+r+" button="+n.button.name),f[n])return h("Already visited state note="+n.note.normalizedValue+" button="+n.button.name),f[n];for(var s=new g([],1e7),l=0;l<n.nextStates.length;++l){var c=n.nextStates[l];h("Trying next ["+l+"/"+n.nextStates.length+"] note="+c.note.normalizedValue+" button="+c.button.name);var o=e(c);if(null==o)return h("Could not get fingerings"),null;var u=n.button.cost;if(0!=o.states.length){var _=o.states[0].button;o.states[0].button.finger,p(n.button,_)&&(h("Penalizing finger hop for note "+r),u+=100)}if(h("path had cost of "+o.cost+" my cost="+u),o.cost+u<s.cost){var d=o.states.slice(0);d.unshift(n),h("New best path for note["+r+"], cost="+(s=new g(d,o.cost+u)).cost)}}return f[n]=s,h("Done choosing: current note="+r+" button="+n.button.name+" best cost="+s.cost),s}(d));return null==B?(h("No fingerings generated!"),abcOutput):abcOutput=function e(n,a,t){if(a.states.shift(),a.states.length!=t.length)return"ERROR: Internal error. Length mismatch";for(var r=n,s=0,l=parseInt(gInjectTab_TabLocation),c=0;c<a.states.length;++c){var o=t[c].index+s,u=a.states[c].button.name;if(gInjectTab_UseBarForDraw)switch(l){case 0:if(a.states[c].direction==y)u='"^'+u+'"';else{for(var _=u.length,f="",d=0;d<_;++d)f+="_";var h=u;u=(u='"^'+f+";")+h+'"'}break;case 1:if(a.states[c].direction==y)u='"_ ;'+u+'"';else{for(var _=u.length,f="",d=0;d<_;++d)f+="_";var h=u;u=(u='"_'+f+";")+h+'"'}}else switch(l){case 0:u=(u='"^'+u+";")+a.states[c].direction+'"';break;case 1:u=(u='"_'+u+";")+a.states[c].direction+'"'}var $=u.length;r=r.substr(0,o)+u+r.substr(o),s+=$}return r}(e,B,$)}var g=function(e,n){this.states=e,this.cost=n},w=function(e,n,a){this.index=e,this.unNormalizedValue=n,this.normalizedValue=a},m=function(e,n,a){this.note=e,this.button=n,this.direction=a,this.nextStates=[],this.id=d++,this.toString=function(){var e="["+this.id+"] Note:";return this.note?e+=this.note.normalizedValue:e+="none",e+=" Button:"+this.button.name}};function R(e,n){var a="FCGDAEB",t={sharps:"",flats:""},r=a.indexOf(e[0])-1;if(-2==r)return h("Bad tonic: "+e),null;"b"==e.slice(1)?r-=7:"#"==e.slice(1)&&(r+=7);var s=r-n;return s>7?(h("Too many sharps: "+s),null):s<-7?(h("Too many flats: "+-1*s),null):(s>0?t.sharps=a.slice(0,s):s<0&&(t.flats=a.slice(s)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function L(e,n){if(e.normalizedValue==n.notes[0])return y;if(e.normalizedValue==n.notes[1])return D;var a=function e(n){var a=n,t={"^A":"_B","^D":"_E","^G":"_A"};for(var r in t)a=(a=a.replace(r,t[r])).replace(r.toLowerCase(),t[r].toLowerCase());return a}(e.normalizedValue);return a==n.notes[0]?y:a==n.notes[1]?D:" "}function p(e,n){return e.finger==n.finger&&e.name!=n.name}function v(e,n,a){for(var t="",r=0;r<a;++r)t+="*";return e.substr(0,n)+t+e.substr(n+a)}function x(e){var n=e,a={_B:"^A","^B":"C",_C:"B",_D:"^C","^D":"_E",_E:"^D","^E":"F",_F:"E",_G:"^F","^G":"_A"};for(var t in a)n=(n=n.replace(t,a[t])).replace(t.toLowerCase(),a[t].toLowerCase());return n}function A(e){var n=e.search(/[A-G]/i);if(-1==n)return h("Failed to find basename for value!"),e;var a=e.substr(n,1).toUpperCase();return"="==e.substr(0,1)?(_.accidentalFlats=_.accidentalFlats.replace(a,""),_.accidentalSharps=_.accidentalSharps.replace(a,""),_.accidentalNaturals+=a,e.substr(1)):"_"==e.substr(0,1)?(_.accidentalFlats+=a,_.accidentalSharps=_.accidentalSharps.replace(a,""),_.accidentalNaturals=_.accidentalNaturals.replace(a,""),e):"^"==e.substr(0,1)?(_.accidentalFlats=_.accidentalFlats.replace(a,""),_.accidentalNaturals=_.accidentalNaturals.replace(a,""),_.accidentalSharps+=a,e):-1!=_.accidentalNaturals.search(a)?e:-1!=_.sharps.search(a)||-1!=_.accidentalSharps.search(a)?"^"+e:-1!=_.flats.search(a)||-1!=_.accidentalFlats.search(a)?"_"+e:e}function G(e){return e.split(/^X:.*$/gm).length-1}function F(e,n){var a=escape(e).split("%0A"),t="",r="";for(i=0;i<a.length;++i){var s=(r=unescape(a[i])).split("");"|"!=s[0]&&"["!=s[0]&&":"==s[1]?(t+=r+"\n","X"==s[0]&&(t+=n+"\n")):(t+=r,i!=a.length-1&&(t+="\n"))}return t}function B(e,n){return"X:"+e.split(/^X:/gm)[n+1]}function C(e){return e=e.replace(/%.*[\r\n]*/gm,"")}function E(e){return e=e.replace(/"[^"]*"/gm,"")}var y="↓",D="↑";return function e(n){var a=n.split(/^X:.*$/gm).length-1,t=gInjectTab_InjectVolumeDirectives,r=gInjectTab_FontFamily,s=gInjectTab_TitleFontSize,l=gInjectTab_SubtitleFontSize,c=gInjectTab_InfoFontSize,o=gInjectTab_TabFontSize,u=gInjectTab_MusicSpace,_=gInjectTab_StaffSep,f=parseInt(gInjectTab_TabLocation),d=gInjectTab_StripChords;y=gInjectTab_PushGlyph,D=gInjectTab_DrawGlyph;for(var h="",g=0;g<a;++g){var w=B(n,g);w=C(w),(0==f||1==f&&d)&&(w=E(w)),w=$(w),w=F(w,"%%musicspace "+u),w=F(w,"%%staffsep "+_),w=F(w,"%%annotationfont "+r+" "+o),w=F(w,"%%infofont "+r+" "+c),w=F(w,"%%subtitlefont "+r+" "+l),w=F(w,"%%titlefont "+r+" "+s),t&&(w=F(w,"%%MIDI bassvol 0"),w=F(w,"%%MIDI chordvol 0")),h+=w}return h}(e)},boxTabGenerator=function(e){var n=null;function a(e){}function t(e){a("Got input:"+e);var t=parseInt(gInjectTab_BoxStyle);if(null==(n=function e(n){var t,r,l=null,c=n.match(/[kK]: *([A-G])([b#])? *(.*?)$/m);if(null==c||c.length<3)return null;if(a("Got base key of '"+(t=void 0==c[2]?c[1]:c[1]+c[2])+"' and extra of '"+(r=c[3].toLowerCase())+"'"),""==r||-1!=r.search("maj")||-1!=r.search("ion")?(a("Mode: Ionian (major)"),l=s(t,0)):-1!=r.search("mix")?(a("Mode: Mixolydian"),l=s(t,1)):-1!=r.search("dor")?(a("Mode: Dorian"),l=s(t,2)):-1!=r.search("m")&&-1==r.search("mix")||-1!=r.search("min")||-1!=r.search("aeo")?(a("Mode: Aeolian (minor)"),l=s(t,3)):-1!=r.search("phr")?(a("Mode: Phrygian"),l=s(t,4)):-1!=r.search("loc")?(a("Mode: Locrian"),l=s(t,5)):-1!=r.search("lyd")?(a("Mode: Lydian"),l=s(t,-1)):-1!=r.search("exp")?(a("(Accidentals to be explicitly specified)"),l=s("C",0)):(a("Failed to determine key signature mode"),l=null),null==l)return l;var o=r.match(/_./g),u=r.match(/\^./g);for(note in o)l.flats+=o[note][1].toUpperCase();for(note in u)l.sharps+=u[note][1].toUpperCase();return l}(e)))return"ERROR: Unknown or unsupported key signature";var u=function e(t,s){for(var u,_,f=t,d=/^\w:.*$/mg;u=d.exec(t);)f=l(f,u.index,u[0].length);for(var h=/"[^"]*"/gm;_=h.exec(f);)for(var $=_.index,g=$+_[0].length,w=$;w<g;++w)f=f.substring(0,w)+"*"+f.substring(w+1);for(h=/\[[^\]|]*\]/g;_=h.exec(f);)for(var $=_.index,g=$+_[0].length,w=$;w<g;++w)f=f.substring(0,w)+"*"+f.substring(w+1);a("sanitized input:"+f);for(var m=/([=^_]?[a-gA-G][',]?|\|)/g,R=[];_=m.exec(f);){var L=_[1];if("|"==L)n.accidentalFlats="",n.accidentalSharps="",n.accidentalNaturals="";else{var p=o(L);a("UnNormalized="+L+" normalized="+p);var v=c(p,s);R.push(new r(_.index,L,p,v))}}return R}(e,t);return function e(n,a){for(var t,r=n,s=0,l=parseInt(gInjectTab_TabLocation),c=0;c<a.length;++c){var o=a[c].index+s,u=a[c].glyph,_=u.length,f=u.substr(0,1),d=u.substr(1,_-1);if(0==u.indexOf("10")&&(f=u.substr(0,2),d=u.substr(2,_-1)),gInjectTab_UseBarForDraw)switch(l){case 0:if(d==$)t='"^'+f+'"';else{for(var h=f.length,g="",w=0;w<h;++w)g+="_";if(gIsChrome||gIsSafari)switch(f){case"①":case"②":case"③":case"④":case"⑤":case"⑥":case"⑦":case"⑧":case"⑨":case"⑩":case"⑪":g+="_"}t=(t='"^'+g+";")+f+'"'}break;case 1:if(d==$)t='"_ ;'+f+'"';else{for(var h=f.length,g="",w=0;w<h;++w)g+="_";if(gIsChrome||gIsSafari)switch(f){case"①":case"②":case"③":case"④":case"⑤":case"⑥":case"⑦":case"⑧":case"⑨":case"⑩":case"⑪":g+="_"}t=(t='"_'+g+";")+f+'"'}}else switch(l){case 0:t=(t='"^'+f+";")+d+'"';break;case 1:t=(t='"_'+f+";")+d+'"'}var m=t.length;r=r.substr(0,o)+t+r.substr(o),s+=m}return r}(e,u)}var r=function(e,n,a,t){this.index=e,this.unNormalizedValue=n,this.normalizedValue=a,this.glyph=t};function s(e,n){var t="FCGDAEB",r={sharps:"",flats:""},s=t.indexOf(e[0])-1;if(-2==s)return a("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-n;return l>7?(a("Too many sharps: "+l),null):l<-7?(a("Too many flats: "+-1*l),null):(l>0?r.sharps=t.slice(0,l):l<0&&(r.flats=t.slice(l)),r.accidentalSharps="",r.accidentalFlats="",r.accidentalNaturals="",r)}function l(e,n,a){for(var t="",r=0;r<a;++r)t+="*";return e.substr(0,n)+t+e.substr(n+a)}function c(e,n){switch(n){case 0:var a={"^D,":"①"+$,"_E,":"①"+$,"E,":"1"+$,"F,":"x ","^F,":"②"+$,"_G,":"②"+$,"G,":"2"+$,"^G,":"①"+g,"_A,":"①"+g,"A,":"1"+g,"^A,":"②"+g,"_B,":"②"+g,"B,":"2"+g,C:"3"+$,"^C":"③"+g,_D:"③"+g,D:"3"+g,"^D":"④"+$,_E:"④"+$,E:"4"+$,F:"4"+g,"^F":"⑤"+$,_G:"⑤"+$,G:"5"+$,"^G":"⑤"+g,_A:"⑤"+g,A:"5"+g,"^A":"⑥"+g,_B:"⑥"+g,B:"6"+g,c:"6"+$,"^c":"⑦"+g,_d:"⑦"+g,d:"7"+g,"^d":"⑦"+$,_e:"⑦"+$,e:"7"+$,f:"8"+g,"^f":"⑧"+$,_g:"⑧"+$,g:"8"+$,"^g":"⑨"+g,_a:"⑨"+g,a:"9"+g,"^a":"⑩"+g,_b:"⑩"+g,b:"10"+g,"c'":"9"+$,"^c'":"⑪"+g,"_d'":"⑪"+g,"d'":"x ","^d'":"⑩"+$,"_e'":"⑩"+$,"e'":"10"+$,"^f'":"⑪"+$,"_g'":"⑪"+$},t=a[e];if(!t)return"x ";break;case 1:var a={"F,":"①"+$,"^F,":"1"+$,"_G,":"1"+$,"G,":"x ","^G,":"②"+$,"_A,":"②"+$,"A,":"2"+$,"^A,":"①"+g,"_B,":"①"+g,"B,":"1"+g,C:"②"+g,"^C":"2"+g,_D:"2"+g,D:"3"+$,"^D":"③"+g,_E:"③"+g,E:"3"+g,F:"④"+$,"^F":"4"+$,_G:"4"+$,G:"4"+g,"^G":"⑤"+$,_A:"⑤"+$,A:"5"+$,"^A":"⑤"+g,_B:"⑤"+g,B:"5"+g,c:"⑥"+g,"^c":"6"+g,_d:"6"+g,d:"6"+$,"^d":"⑦"+g,_e:"⑦"+g,e:"7"+g,f:"⑦"+$,"^f":"7"+$,_g:"7"+$,g:"8"+g,"^g":"⑧"+$,_a:"⑧"+$,a:"8"+$,"^a":"⑨"+g,_b:"⑨"+g,b:"9"+g,"c'":"⑩"+g,"^c'":"10"+g,"_d'":"10"+g,"d'":"9"+$,"^d'":"⑪"+g,"_e'":"⑪"+g,"e'":"x ","f'":"⑩"+$,"^f'":"10"+$,"_g'":"10"+$,"g'":"x ","^g'":"⑪"+$,"_a'":"⑪"+$},t=a[e];if(!t)return"x "}return t}function o(e){var t=e.search(/[A-G]/i);if(-1==t)return a("Failed to find basename for value!"),e;var r=e.substr(t,1).toUpperCase();return"="==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(r,""),n.accidentalSharps=n.accidentalSharps.replace(r,""),n.accidentalNaturals+=r,e.substr(1)):"_"==e.substr(0,1)?(n.accidentalFlats+=r,n.accidentalSharps=n.accidentalSharps.replace(r,""),n.accidentalNaturals=n.accidentalNaturals.replace(r,""),e):"^"==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(r,""),n.accidentalNaturals=n.accidentalNaturals.replace(r,""),n.accidentalSharps+=r,e):-1!=n.accidentalNaturals.search(r)?e:-1!=n.sharps.search(r)||-1!=n.accidentalSharps.search(r)?"^"+e:-1!=n.flats.search(r)||-1!=n.accidentalFlats.search(r)?"_"+e:e}function u(e){return e.split(/^X:.*$/gm).length-1}function _(e,n){var a=escape(e).split("%0A"),t="",r="";for(i=0;i<a.length;++i){var s=(r=unescape(a[i])).split("");"|"!=s[0]&&"["!=s[0]&&":"==s[1]?(t+=r+"\n","X"==s[0]&&(t+=n+"\n")):(t+=r,i!=a.length-1&&(t+="\n"))}return t}function f(e,n){return"X:"+e.split(/^X:/gm)[n+1]}function d(e){return e=e.replace(/%.*[\r\n]*/gm,"")}function h(e){return e=e.replace(/"[^"]*"/gm,"")}var $="↓",g="↑";return function e(n){var a=n.split(/^X:.*$/gm).length-1,r=gInjectTab_InjectVolumeDirectives,s=gInjectTab_FontFamily,l=gInjectTab_TitleFontSize,c=gInjectTab_SubtitleFontSize,o=gInjectTab_InfoFontSize,u=gInjectTab_TabFontSize,w=gInjectTab_MusicSpace,m=gInjectTab_StaffSep,R=parseInt(gInjectTab_TabLocation),L=gInjectTab_StripChords;$=gInjectTab_PushGlyph,g=gInjectTab_DrawGlyph;for(var p="",v=0;v<a;++v){var x=f(n,v);x=d(x),(0==R||1==R&&L)&&(x=h(x)),x=t(x),x=_(x,"%%musicspace "+w),x=_(x,"%%staffsep "+m),x=_(x,"%%annotationfont "+s+" "+u),x=_(x,"%%infofont "+s+" "+o),x=_(x,"%%subtitlefont "+s+" "+c),x=_(x,"%%titlefont "+s+" "+l),r&&(x=_(x,"%%MIDI bassvol 0"),x=_(x,"%%MIDI chordvol 0")),p+=x}return p}(e)};
