var angloFingeringsGenerator=function(e){var a,n=function(e,a,n,r){this.name=e,this.notes=a,this.cost=n,this.finger=r},r={L1a:new n("L1a",["E,","F,"],10,"l4"),L2a:new n("L2a",["A,","_B,"],10,"l4"),L3a:new n("L3a",["^C","_E"],10,"l3"),L4a:new n("L4a",["A","G"],10,"l2"),L5a:new n("L5a",["^G","_B"],10,"l1"),L1:new n("L1",["C,","G,"],1,"l4"),L2:new n("L2",["G,","B,"],1,"l4"),L3:new n("L3",["C","D"],1,"l3"),L4:new n("L4",["E","F"],1,"l2"),L5:new n("L5",["G","A"],1,"l1"),L6:new n("L6",["B,","A,"],1,"l4"),L7:new n("L7",["D","^F"],2,"l4"),L8:new n("L8",["G","A"],2,"l3"),L9:new n("L9",["B","c"],2,"l2"),L10:new n("L10",["d","e"],2,"l1"),R1:new n("R1",["c","B"],1,"r1"),R2:new n("R2",["e","d"],1,"r2"),R3:new n("R3",["g","f"],2,"r3"),R4:new n("R4",["c'","a"],2,"r4"),R5:new n("R5",["e'","b"],2,"r4"),R6:new n("R6",["g","^f"],1,"r1"),R7:new n("R7",["b","a"],1,"r2"),R8:new n("R8",["d'","c'"],1,"r3"),R9:new n("R9",["g'","e'"],1,"r4"),R10:new n("R10",["b'","^f'"],1,"r4")};new n("L1a",["E,","F,"],10,"l4"),new n("L2a",["A,","_B,"],10,"l4"),new n("L3a",["^C","_E"],10,"l3"),new n("L4a",["A","G"],10,"l2"),new n("L5a",["^G","_B"],10,"l1"),new n("L1",["C,","G,"],1,"l4"),new n("L2",["G,","B,"],1,"l4"),new n("L3",["C","D"],1,"l3"),new n("L4",["E","F"],1,"l2"),new n("L5",["G","A"],1,"l1"),new n("L6",["B,","A,"],1,"l4"),new n("L7",["D","^F"],2,"l4"),new n("L8",["G","A"],2,"l3"),new n("L9",["B","c"],2,"l2"),new n("L10",["d","e"],1,"l1"),new n("R1",["c","B"],1,"r1"),new n("R2",["e","d"],2,"r2"),new n("R3",["g","f"],2,"r3"),new n("R4",["c'","a"],2,"r4"),new n("R5",["e'","b"],2,"r4"),new n("R6",["g","^f"],1,"r1"),new n("R7",["b","a"],1,"r2"),new n("R8",["d'","c'"],1,"r3"),new n("R9",["g'","e'"],1,"r4"),new n("R10",["b'","^f'"],1,"r4");var t={L1a:new n("L1a",["E,","F,"],10,"l4"),L2a:new n("L2a",["A,","_B,"],10,"l4"),L3a:new n("L3a",["^C","_E"],10,"l3"),L4a:new n("L4a",["A","G"],10,"l2"),L5a:new n("L5a",["^G","_B"],10,"l1"),L1:new n("L1",["C,","G,"],1,"l4"),L2:new n("L2",["G,","B,"],1,"l4"),L3:new n("L3",["C","D"],1,"l3"),L4:new n("L4",["E","F"],1,"l2"),L5:new n("L5",["G","A"],1,"l1"),L6:new n("L6",["B,","A,"],1,"l4"),L7:new n("L7",["D","^F"],2,"l4"),L8:new n("L8",["G","A"],2,"l3"),L9:new n("L9",["B","z"],2,"l2"),L9a:new n("L9",["z","c"],1,"l2"),L10:new n("L10",["d","e"],1,"l1"),R1:new n("R1",["c","x"],2,"r1"),R1x:new n("R1",["x","B"],1,"r1"),R2:new n("R2",["e","d"],2,"r2"),R3:new n("R3",["g","f"],2,"r3"),R4:new n("R4",["c'","a"],2,"r4"),R5:new n("R5",["e'","b"],2,"r4"),R6:new n("R6",["g","^f"],1,"r1"),R7:new n("R7",["b","a"],1,"r2"),R8:new n("R8",["d'","c'"],1,"r3"),R9:new n("R9",["g'","e'"],1,"r4"),R10:new n("R10",["b'","^f'"],1,"r4")};new n("R1a",["^d","^c"],1,"r1"),new n("R2a",["^c","^d"],10,"r2"),new n("R3a",["^g","g"],10,"r3"),new n("R4a",["^c'","_b"],10,"r4"),new n("R5a",["a","d'"],10,"r4");var s={R1a:new n("R1a",["^d","^c"],10,"r1"),R2a:new n("R2a",["^c","^d"],1,"r2"),R3a:new n("R3a",["^g","g"],10,"r3"),R4a:new n("R4a",["^c'","_b"],10,"r4"),R5a:new n("R5a",["a","d'"],10,"r4")},l={R1a:new n("R1a",["^c","^d"],10,"r1"),R2a:new n("R2a",["a","g"],10,"r2"),R3a:new n("R3a",["^g","_b"],10,"r3"),R4a:new n("R4a",["^c'","_e'"],10,"r4"),R5a:new n("R5a",["a","f'"],10,"r4")},c=null,o=null,u=null,_=null,f=null,d=0;function h(e){}function $(e){if(h("Got input:"+e),!function e(){var a,n=parseInt(gInjectTab_ConcertinaFingering);switch(c=[],o=[],n){case 0:for(var _ in s)c[_]=s[_];for(var _ in l)o[_]=l[_];for(var _ in r)c[_]=r[_],o[_]=r[_];break;case 1:for(var _ in s)c[_]=s[_];for(var _ in l)o[_]=l[_];for(var _ in t)c[_]=t[_];for(var _ in t)o[_]=t[_]}u=((a=u=0==parseInt(gInjectTab_ConcertinaStyle)?c:o).L1a.name=gAngloButtonNames[0],a.L2a.name=gAngloButtonNames[1],a.L3a.name=gAngloButtonNames[2],a.L4a.name=gAngloButtonNames[3],a.L5a.name=gAngloButtonNames[4],a.R1a.name=gAngloButtonNames[5],a.R2a.name=gAngloButtonNames[6],a.R3a.name=gAngloButtonNames[7],a.R4a.name=gAngloButtonNames[8],a.R5a.name=gAngloButtonNames[9],a.L1.name=gAngloButtonNames[10],a.L2.name=gAngloButtonNames[11],a.L3.name=gAngloButtonNames[12],a.L4.name=gAngloButtonNames[13],a.L5.name=gAngloButtonNames[14],a.R1.name=gAngloButtonNames[15],a.R1x&&(a.R1x.name=gAngloButtonNames[15]),a.R2.name=gAngloButtonNames[16],a.R3.name=gAngloButtonNames[17],a.R4.name=gAngloButtonNames[18],a.R5.name=gAngloButtonNames[19],a.L6.name=gAngloButtonNames[20],a.L7.name=gAngloButtonNames[21],a.L8.name=gAngloButtonNames[22],a.L9.name=gAngloButtonNames[23],a.L9a&&(a.L9a.name=gAngloButtonNames[23]),a.L10.name=gAngloButtonNames[24],a.R6.name=gAngloButtonNames[25],a.R7.name=gAngloButtonNames[26],a.R8.name=gAngloButtonNames[27],a.R9.name=gAngloButtonNames[28],a.R10.name=gAngloButtonNames[29],a)}(),null==(_=function e(a){var n,r,t=null,s=a.match(/[kK]: *([A-G])([b#])? *(.*?)$/m);if(null==s||s.length<3)return null;if(h("Got base key of '"+(n=void 0==s[2]?s[1]:s[1]+s[2])+"' and extra of '"+(r=s[3].toLowerCase())+"'"),""==r||-1!=r.search("maj")||-1!=r.search("ion")?(h("Mode: Ionian (major)"),t=v(n,0)):-1!=r.search("mix")?(h("Mode: Mixolydian"),t=v(n,1)):-1!=r.search("dor")?(h("Mode: Dorian"),t=v(n,2)):-1!=r.search("m")&&-1==r.search("mix")||-1!=r.search("min")||-1!=r.search("aeo")?(h("Mode: Aeolian (minor)"),t=v(n,3)):-1!=r.search("phr")?(h("Mode: Phrygian"),t=v(n,4)):-1!=r.search("loc")?(h("Mode: Locrian"),t=v(n,5)):-1!=r.search("lyd")?(h("Mode: Lydian"),t=v(n,-1)):-1!=r.search("exp")?(h("(Accidentals to be explicitly specified)"),t=v("C",0)):(h("Failed to determine key signature mode"),t=null),null==t)return t;var l=r.match(/_./g),c=r.match(/\^./g);for(note in l)t.flats+=l[note][1].toUpperCase();for(note in c)t.sharps+=c[note][1].toUpperCase();return t}(e)))return"ERROR: Unknown or unsupported key signature";var d,$=function e(a){for(var n,r,t=a,s=/^\w:.*$/mg;n=s.exec(a);)t=L(t,n.index,n[0].length);for(var l=/"[^"]*"/gm;r=l.exec(t);)for(var c=r.index,o=c+r[0].length,u=c;u<o;++u)t=t.substring(0,u)+"*"+t.substring(u+1);for(l=/\[[^\]|]*\]/g;r=l.exec(t);)for(var c=r.index,o=c+r[0].length,u=c;u<o;++u)t=t.substring(0,u)+"*"+t.substring(u+1);h("sanitized input:"+t);for(var f=/([=^_]?[a-gA-G][',]?|\|)/g,d=[];r=f.exec(t);){var $=r[1];if("|"==$)_.accidentalFlats="",_.accidentalSharps="",_.accidentalNaturals="";else{var g=A($);h("UnNormalized="+$+" normalized="+g),d.push(new p(r.index,$,g))}}return d}(e),G=function e(a){var n={};for(var r in a){var t=a[r].notes;if(null==t){h("Failed to find entry for button "+b);continue}t.forEach(function(e){null==n[e]?n[e]=[a[r]]:n[e].push(a[r]),null==n[e=x(e)]?n[e]=[a[r]]:n[e].push(a[r])})}return n}(u);!function e(a){for(var n in a)a[n].sort(function(e,a){return e.cost-a.cost})}(G);var F,B=(d=function e(a,r){for(var t=null,s=null,l=0;l<a.length;++l){var c=a[l],o=c.normalizedValue,u=r[o];if(null==u||u.length<1){h("Failed to find button for note "+o),h("Attempting respell...");var _=x(o);if(h("Respelled as "+_),null==(u=r[_])||u.length<1)return h("Respelling as "+_+" failed to find a button."),abcOutput="ERROR:Failed to find button for note '"+o+"'",null}var f=[];u.forEach(function(e){f.push(new m(c,e,w(c,e)))}),null==t&&(t=f),null!=s&&s.forEach(function(e){e.nextStates=f}),s=f}var d=new m(null,new n("root",[],0,"none"));return d.nextStates=t,d}($,G),a=1e8,f={},function e(a){if(0==a.nextStates.length)return h("Last state, note="+a.note.normalizedValue+" button="+a.button.name+". Popping up the stack"),new g([a],a.button.cost);var n=a.note,r=null,t=null;if(null!=n&&(r=n.unNormalizedValue,t=n.normalizedValue),h("Choosing: current note="+t+" button="+a.button.name),f[a])return h("Already visited state note="+a.note.normalizedValue+" button="+a.button.name),f[a];for(var s=new g([],1e7),l=0;l<a.nextStates.length;++l){var c=a.nextStates[l];h("Trying next ["+l+"/"+a.nextStates.length+"] note="+c.note.normalizedValue+" button="+c.button.name);var o=e(c);if(null==o)return h("Could not get fingerings"),null;var u=a.button.cost;if(0!=o.states.length){var _=o.states[0].button;o.states[0].button.finger,R(a.button,_)&&(h("Penalizing finger hop for note "+t),u+=100)}if(h("path had cost of "+o.cost+" my cost="+u),o.cost+u<s.cost){var d=o.states.slice(0);d.unshift(a),h("New best path for note["+t+"], cost="+(s=new g(d,o.cost+u)).cost)}}return f[a]=s,h("Done choosing: current note="+t+" button="+a.button.name+" best cost="+s.cost),s}(d));return null==B?(h("No fingerings generated!"),abcOutput):abcOutput=function e(a,n,r){if(n.states.shift(),n.states.length!=r.length)return"ERROR: Internal error. Length mismatch";for(var t=a,s=0,l=parseInt(gInjectTab_TabLocation),c=0;c<n.states.length;++c){var o=r[c].index+s,u=n.states[c].button.name;if(gInjectTab_UseBarForDraw)switch(l){case 0:if(n.states[c].direction==E)u='"^'+u+'"';else{for(var _=u.length,f="",d=0;d<_;++d)f+="_";var h=u;u=(u='"^'+f+";")+h+'"'}break;case 1:if(n.states[c].direction==E)u='"_ ;'+u+'"';else{for(var _=u.length,f="",d=0;d<_;++d)f+="_";var h=u;u=(u='"_'+f+";")+h+'"'}}else switch(l){case 0:u=(u='"^'+u+";")+n.states[c].direction+'"';break;case 1:u=(u='"_'+u+";")+n.states[c].direction+'"'}var $=u.length;t=t.substr(0,o)+u+t.substr(o),s+=$}return t}(e,B,$)}var g=function(e,a){this.states=e,this.cost=a},p=function(e,a,n){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n},m=function(e,a,n){this.note=e,this.button=a,this.direction=n,this.nextStates=[],this.id=d++,this.toString=function(){var e="["+this.id+"] Note:";return this.note?e+=this.note.normalizedValue:e+="none",e+=" Button:"+this.button.name}};function v(e,a){var n="FCGDAEB",r={sharps:"",flats:""},t=n.indexOf(e[0])-1;if(-2==t)return h("Bad tonic: "+e),null;"b"==e.slice(1)?t-=7:"#"==e.slice(1)&&(t+=7);var s=t-a;return s>7?(h("Too many sharps: "+s),null):s<-7?(h("Too many flats: "+-1*s),null):(s>0?r.sharps=n.slice(0,s):s<0&&(r.flats=n.slice(s)),r.accidentalSharps="",r.accidentalFlats="",r.accidentalNaturals="",r)}function w(e,a){if(e.normalizedValue==a.notes[0])return E;if(e.normalizedValue==a.notes[1])return y;var n=function e(a){var n=a,r={"^A":"_B","^D":"_E","^G":"_A"};for(var t in r)n=(n=n.replace(t,r[t])).replace(t.toLowerCase(),r[t].toLowerCase());return n}(e.normalizedValue);return n==a.notes[0]?E:n==a.notes[1]?y:" "}function R(e,a){return e.finger==a.finger&&e.name!=a.name}function L(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function x(e){var a=e,n={_B:"^A","^B":"C",_C:"B",_D:"^C","^D":"_E",_E:"^D","^E":"F",_F:"E",_G:"^F","^G":"_A"};for(var r in n)a=(a=a.replace(r,n[r])).replace(r.toLowerCase(),n[r].toLowerCase());return a}function A(e){var a=e.search(/[A-G]/i);if(-1==a)return h("Failed to find basename for value!"),e;var n=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(_.accidentalFlats=_.accidentalFlats.replace(n,""),_.accidentalSharps=_.accidentalSharps.replace(n,""),_.accidentalNaturals+=n,e.substr(1)):"_"==e.substr(0,1)?(_.accidentalFlats+=n,_.accidentalSharps=_.accidentalSharps.replace(n,""),_.accidentalNaturals=_.accidentalNaturals.replace(n,""),e):"^"==e.substr(0,1)?(_.accidentalFlats=_.accidentalFlats.replace(n,""),_.accidentalNaturals=_.accidentalNaturals.replace(n,""),_.accidentalSharps+=n,e):-1!=_.accidentalNaturals.search(n)?e:-1!=_.sharps.search(n)||-1!=_.accidentalSharps.search(n)?"^"+e:-1!=_.flats.search(n)||-1!=_.accidentalFlats.search(n)?"_"+e:e}function G(e){return e.split(/^X:.*$/gm).length-1}function F(e,a){var n=escape(e).split("%0A"),r="",t="";for(i=0;i<n.length;++i){var s=(t=unescape(n[i])).split("");"|"!=s[0]&&"["!=s[0]&&":"==s[1]?(r+=t+"\n","X"==s[0]&&(r+=a+"\n")):(r+=t,i!=n.length-1&&(r+="\n"))}return r}function B(e,a){return"X:"+e.split(/^X:/gm)[a+1]}function C(e){return e=e.replace(/%.*[\r\n]*/gm,"")}function D(e){return e=e.replace(/"[^"]*"/gm,"")}var E="↓",y="↑";return function e(a){var n=a.split(/^X:.*$/gm).length-1,r=gInjectTab_InjectVolumeDirectives,t=gInjectTab_FontFamily,s=gInjectTab_TabFontSize,l=gInjectTab_MusicSpace,c=gInjectTab_StaffSep,o=parseInt(gInjectTab_TabLocation),u=gInjectTab_StripChords;E=gInjectTab_PushGlyph,y=gInjectTab_DrawGlyph;for(var _="",f=0;f<n;++f){var d=B(a,f);d=C(d),(0==o||1==o&&u)&&(d=D(d)),d=$(d),d=F(d,"%%musicspace "+l),d=F(d,"%%staffsep "+c),d=F(d,"%%annotationfont "+t+" "+s),r&&(d=F(d,"%%MIDI bassvol 0"),d=F(d,"%%MIDI chordvol 0")),_+=d}return _}(e)},boxTabGenerator=function(e){var a=null;function n(e){}function r(e){n("Got input:"+e);var r=parseInt(gInjectTab_BoxStyle);if(null==(a=function e(a){var r,t,l=null,c=a.match(/[kK]: *([A-G])([b#])? *(.*?)$/m);if(null==c||c.length<3)return null;if(n("Got base key of '"+(r=void 0==c[2]?c[1]:c[1]+c[2])+"' and extra of '"+(t=c[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(n("Mode: Ionian (major)"),l=s(r,0)):-1!=t.search("mix")?(n("Mode: Mixolydian"),l=s(r,1)):-1!=t.search("dor")?(n("Mode: Dorian"),l=s(r,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(n("Mode: Aeolian (minor)"),l=s(r,3)):-1!=t.search("phr")?(n("Mode: Phrygian"),l=s(r,4)):-1!=t.search("loc")?(n("Mode: Locrian"),l=s(r,5)):-1!=t.search("lyd")?(n("Mode: Lydian"),l=s(r,-1)):-1!=t.search("exp")?(n("(Accidentals to be explicitly specified)"),l=s("C",0)):(n("Failed to determine key signature mode"),l=null),null==l)return l;var o=t.match(/_./g),u=t.match(/\^./g);for(note in o)l.flats+=o[note][1].toUpperCase();for(note in u)l.sharps+=u[note][1].toUpperCase();return l}(e)))return"ERROR: Unknown or unsupported key signature";var u=function e(r,s){for(var u,_,f=r,d=/^\w:.*$/mg;u=d.exec(r);)f=l(f,u.index,u[0].length);for(var h=/"[^"]*"/gm;_=h.exec(f);)for(var $=_.index,g=$+_[0].length,p=$;p<g;++p)f=f.substring(0,p)+"*"+f.substring(p+1);for(h=/\[[^\]|]*\]/g;_=h.exec(f);)for(var $=_.index,g=$+_[0].length,p=$;p<g;++p)f=f.substring(0,p)+"*"+f.substring(p+1);n("sanitized input:"+f);for(var m=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];_=m.exec(f);){var w=_[1];if("|"==w)a.accidentalFlats="",a.accidentalSharps="",a.accidentalNaturals="";else{var R=o(w);n("UnNormalized="+w+" normalized="+R);var L=c(R,s);v.push(new t(_.index,w,R,L))}}return v}(e,r);return function e(a,n){for(var r,t=a,s=0,l=parseInt(gInjectTab_TabLocation),c=0;c<n.length;++c){var o=n[c].index+s,u=n[c].glyph,_=u.length,f=u.substr(0,1),d=u.substr(1,_-1);if(0==u.indexOf("10")&&(f=u.substr(0,2),d=u.substr(2,_-1)),gInjectTab_UseBarForDraw)switch(l){case 0:if(d==$)r='"^'+f+'"';else{for(var h=f.length,g="",p=0;p<h;++p)g+="_";if(gIsChrome||gIsSafari)switch(f){case"①":case"②":case"③":case"④":case"⑤":case"⑥":case"⑦":case"⑧":case"⑨":case"⑩":case"⑪":g+="_"}r=(r='"^'+g+";")+f+'"'}break;case 1:if(d==$)r='"_ ;'+f+'"';else{for(var h=f.length,g="",p=0;p<h;++p)g+="_";if(gIsChrome||gIsSafari)switch(f){case"①":case"②":case"③":case"④":case"⑤":case"⑥":case"⑦":case"⑧":case"⑨":case"⑩":case"⑪":g+="_"}r=(r='"_'+g+";")+f+'"'}}else switch(l){case 0:r=(r='"^'+f+";")+d+'"';break;case 1:r=(r='"_'+f+";")+d+'"'}var m=r.length;t=t.substr(0,o)+r+t.substr(o),s+=m}return t}(e,u)}var t=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function s(e,a){var r="FCGDAEB",t={sharps:"",flats:""},s=r.indexOf(e[0])-1;if(-2==s)return n("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(n("Too many sharps: "+l),null):l<-7?(n("Too many flats: "+-1*l),null):(l>0?t.sharps=r.slice(0,l):l<0&&(t.flats=r.slice(l)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function l(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function c(e,a){switch(a){case 0:var n={"^D,":"①"+$,"_E,":"①"+$,"E,":"1"+$,"F,":"x ","^F,":"②"+$,"_G,":"②"+$,"G,":"2"+$,"^G,":"①"+g,"_A,":"①"+g,"A,":"1"+g,"^A,":"②"+g,"_B,":"②"+g,"B,":"2"+g,C:"3"+$,"^C":"③"+g,_D:"③"+g,D:"3"+g,"^D":"④"+$,_E:"④"+$,E:"4"+$,F:"4"+g,"^F":"⑤"+$,_G:"⑤"+$,G:"5"+$,"^G":"⑤"+g,_A:"⑤"+g,A:"5"+g,"^A":"⑥"+g,_B:"⑥"+g,B:"6"+g,c:"6"+$,"^c":"⑦"+g,_d:"⑦"+g,d:"7"+g,"^d":"⑦"+$,_e:"⑦"+$,e:"7"+$,f:"8"+g,"^f":"⑧"+$,_g:"⑧"+$,g:"8"+$,"^g":"⑨"+g,_a:"⑨"+g,a:"9"+g,"^a":"⑩"+g,_b:"⑩"+g,b:"10"+g,"c'":"9"+$,"^c'":"⑪"+g,"_d'":"⑪"+g,"d'":"x ","^d'":"⑩"+$,"_e'":"⑩"+$,"e'":"10"+$,"^f'":"⑪"+$,"_g'":"⑪"+$},r=n[e];if(!r)return"x ";break;case 1:var n={"F,":"①"+$,"^F,":"1"+$,"_G,":"1"+$,"G,":"x ","^G,":"②"+$,"_A,":"②"+$,"A,":"2"+$,"^A,":"①"+g,"_B,":"①"+g,"B,":"1"+g,C:"②"+g,"^C":"2"+g,_D:"2"+g,D:"3"+$,"^D":"③"+g,_E:"③"+g,E:"3"+g,F:"④"+$,"^F":"4"+$,_G:"4"+$,G:"4"+g,"^G":"⑤"+$,_A:"⑤"+$,A:"5"+$,"^A":"⑤"+g,_B:"⑤"+g,B:"5"+g,c:"⑥"+g,"^c":"6"+g,_d:"6"+g,d:"6"+$,"^d":"⑦"+g,_e:"⑦"+g,e:"7"+g,f:"⑦"+$,"^f":"7"+$,_g:"7"+$,g:"8"+g,"^g":"⑧"+$,_a:"⑧"+$,a:"8"+$,"^a":"⑨"+g,_b:"⑨"+g,b:"9"+g,"c'":"⑩"+g,"^c'":"10"+g,"_d'":"10"+g,"d'":"9"+$,"^d'":"⑪"+g,"_e'":"⑪"+g,"e'":"x ","f'":"⑩"+$,"^f'":"10"+$,"_g'":"10"+$,"g'":"x ","^g'":"⑪"+$,"_a'":"⑪"+$},r=n[e];if(!r)return"x "}return r}function o(e){var r=e.search(/[A-G]/i);if(-1==r)return n("Failed to find basename for value!"),e;var t=e.substr(r,1).toUpperCase();return"="==e.substr(0,1)?(a.accidentalFlats=a.accidentalFlats.replace(t,""),a.accidentalSharps=a.accidentalSharps.replace(t,""),a.accidentalNaturals+=t,e.substr(1)):"_"==e.substr(0,1)?(a.accidentalFlats+=t,a.accidentalSharps=a.accidentalSharps.replace(t,""),a.accidentalNaturals=a.accidentalNaturals.replace(t,""),e):"^"==e.substr(0,1)?(a.accidentalFlats=a.accidentalFlats.replace(t,""),a.accidentalNaturals=a.accidentalNaturals.replace(t,""),a.accidentalSharps+=t,e):-1!=a.accidentalNaturals.search(t)?e:-1!=a.sharps.search(t)||-1!=a.accidentalSharps.search(t)?"^"+e:-1!=a.flats.search(t)||-1!=a.accidentalFlats.search(t)?"_"+e:e}function u(e){return e.split(/^X:.*$/gm).length-1}function _(e,a){var n=escape(e).split("%0A"),r="",t="";for(i=0;i<n.length;++i){var s=(t=unescape(n[i])).split("");"|"!=s[0]&&"["!=s[0]&&":"==s[1]?(r+=t+"\n","X"==s[0]&&(r+=a+"\n")):(r+=t,i!=n.length-1&&(r+="\n"))}return r}function f(e,a){return"X:"+e.split(/^X:/gm)[a+1]}function d(e){return e=e.replace(/%.*[\r\n]*/gm,"")}function h(e){return e=e.replace(/"[^"]*"/gm,"")}var $="↓",g="↑";return function e(a){var n=a.split(/^X:.*$/gm).length-1,t=gInjectTab_InjectVolumeDirectives,s=gInjectTab_FontFamily,l=gInjectTab_TabFontSize,c=gInjectTab_MusicSpace,o=gInjectTab_StaffSep,u=parseInt(gInjectTab_TabLocation),p=gInjectTab_StripChords;$=gInjectTab_PushGlyph,g=gInjectTab_DrawGlyph;for(var m="",v=0;v<n;++v){var w=f(a,v);w=d(w),(0==u||1==u&&p)&&(w=h(w)),w=r(w),w=_(w,"%%musicspace "+c),w=_(w,"%%staffsep "+o),w=_(w,"%%annotationfont "+s+" "+l),t&&(w=_(w,"%%MIDI bassvol 0"),w=_(w,"%%MIDI chordvol 0")),m+=w}return m}(e)},bambooFluteTabGenerator=function(e){var a="",n=null;function r(e){}function t(e){r("Got input:"+e);var t=parseInt(gBambooFluteKey);if(null==(n=function e(a){var n,t,s=null,c=a.match(/[kK]: *([A-G])([b#])? *(.*?)$/m);if(null==c||c.length<3)return null;if(r("Got base key of '"+(n=void 0==c[2]?c[1]:c[1]+c[2])+"' and extra of '"+(t=c[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(r("Mode: Ionian (major)"),s=l(n,0)):-1!=t.search("mix")?(r("Mode: Mixolydian"),s=l(n,1)):-1!=t.search("dor")?(r("Mode: Dorian"),s=l(n,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(r("Mode: Aeolian (minor)"),s=l(n,3)):-1!=t.search("phr")?(r("Mode: Phrygian"),s=l(n,4)):-1!=t.search("loc")?(r("Mode: Locrian"),s=l(n,5)):-1!=t.search("lyd")?(r("Mode: Lydian"),s=l(n,-1)):-1!=t.search("exp")?(r("(Accidentals to be explicitly specified)"),s=l("C",0)):(r("Failed to determine key signature mode"),s=null),null==s)return s;var o=t.match(/_./g),u=t.match(/\^./g);for(note in o)s.flats+=o[note][1].toUpperCase();for(note in u)s.sharps+=u[note][1].toUpperCase();return s}(e)))return"ERROR: Unknown or unsupported key signature";var _=function e(a,t){for(var l,_,f=a,d=/^\w:.*$/mg;l=d.exec(a);)f=c(f,l.index,l[0].length);for(var h=/"[^"]*"/gm;_=h.exec(f);)for(var $=_.index,g=$+_[0].length,p=$;p<g;++p)f=f.substring(0,p)+"*"+f.substring(p+1);for(h=/\[[^\]|]*\]/g;_=h.exec(f);)for(var $=_.index,g=$+_[0].length,p=$;p<g;++p)f=f.substring(0,p)+"*"+f.substring(p+1);r("sanitized input:"+f);for(var m=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];_=m.exec(f);){var w=_[1];if("|"==w)n.accidentalFlats="",n.accidentalSharps="",n.accidentalNaturals="";else{var R=u(w);r("UnNormalized="+w+" normalized="+R);var L=o(R,t);v.push(new s(_.index,w,R,L))}}return v}(e,t);return a=function e(a,n){for(var r,t=a,s=0,l=0;l<n.length;++l){var c=n[l].index+s,o=n[l].glyph,u=o.length,_=o.substr(0,u-1),f=o.substr(u-1,u-1),d=(r="-"!=f?'"_'+f+";"+_+'"':'"_ ;'+_+';•"').length;t=t.substr(0,c)+r+t.substr(c),s+=d}return t}(e,_)}var s=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function l(e,a){var n="FCGDAEB",t={sharps:"",flats:""},s=n.indexOf(e[0])-1;if(-2==s)return r("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(r("Too many sharps: "+l),null):l<-7?(r("Too many flats: "+-1*l),null):(l>0?t.sharps=n.slice(0,l):l<0&&(t.flats=n.slice(l)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function c(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function o(e,a){var n="";switch(a){case 0:var r={"G,":"5-","^G,":"#5-","_A,":"#5-","A,":"6-","^A,":"#6-","_B,":"#6-","B,":"7-",C:"1 ","^C":"#1 ",_D:"#1 ",D:"2 ","^D":"#2 ",_E:"#2 ",E:"3 ",F:"4 ","^F":"#4 ",_G:"#4 ",G:"5 ","^G":"#5 ",_A:"#5 ",A:"6 ","^A":"#6 ",_B:"#6 ",B:"7 ",c:"1•","^c":"#1•",_d:"#1•",d:"2•","^d":"#2•",_e:"#2•",e:"3•",f:"4•","^f":"#4•",_g:"#4•",g:"5•","^g":"#5•",_a:"#5•",a:"6•","^a":"#6•",_b:"#6•",b:"7•"};if(!(n=r[e]))return"x ";break;case 1:var r={"G,":"4-","^G,":"#4-","_A,":"#4-","A,":"5-","^A,":"#5-","_B,":"#5-","B,":"6-",C:"#6-","^C":"7-",_D:"7-",D:"1 ","^D":"#1 ",_E:"#1 ",E:"2 ",F:"#2 ","^F":"3 ",_G:"3 ",G:"4 ","^G":"#4 ",_A:"#4 ",A:"5 ","^A":"#5 ",_B:"#5 ",B:"6 ",c:"#6 ","^c":"7 ",_d:"7 ",d:"1•","^d":"#1•",_e:"#1•",e:"2•",f:"#2•","^f":"3•",_g:"3•",g:"4•","^g":"#4•",_a:"#4•",a:"5•","^a":"#5•",_b:"#5•",b:"6•","c'":"#6•","^c'":"7•"};if(!(n=r[e]))return"x ";break;case 2:var r={"G,":"1-","^G,":"#1-","_A,":"#1-","A,":"2-","^A,":"#2-","_B,":"#2-","B,":"3-",C:"4-","^C":"#4-",_D:"#4-",D:"5-","^D":"#5-",_E:"#5-",E:"6-",F:"#6-","^F":"7-",G:"1 ","^G":"#1 ",_A:"#1 ",A:"2 ","^A":"#2 ",_B:"#2 ",B:"3 ",c:"4 ","^c":"#4 ",_d:"#4 ",d:"5 ","^d":"#5 ",_e:"#5 ",e:"6 ",f:"#6 ","^f":"7 ",_g:"7 ",g:"1•","^g":"#1•",_a:"#1•",a:"2•","^a":"#2•",_b:"#2•",b:"3•","c'":"4•","^c'":"#4•","_d'":"#4•","d'":"5•","^d'":"#5•","_e'":"#5•","e'":"6•","f'":"6#•","^f'":"7•","_g'":"7•"};if(!(n=r[e]))return"x ";break;case 3:var r={"A,":"1-","^A,":"#1-","_B,":"#1-","B,":"2-",C:"#2-","^C":"3-",_D:"3-",D:"4-","^D":"#4-",_E:"#4-",E:"5-",F:"#5-","^F":"6-",_G:"6-",G:"6#-","^G":"7-",_A:"7-",A:"1 ","^A":"#1 ",_B:"#1 ",B:"2 ",c:"#2 ","^c":"3 ",_d:"3 ",d:"4 ","^d":"#4 ",_e:"#4 ",e:"5 ",f:"#5 ","^f":"6 ",_g:"6 ",g:"6# ","^g":"7 ",_a:"7 ",a:"1•","^a":"#1•",_b:"#1•",b:"2•","c'":"#2•","^c'":"3•","_d'":"3•","d'":"4•","^d'":"#4•","_e'":"#4•","e'":"5•","f'":"#5•","^f'":"6•","_g'":"6•","g'":"6#•","^g'":"7•","_a'":"7•"};if(!(n=r[e]))return"x "}return n}function u(e){var a=e.search(/[A-G]/i);if(-1==a)return r("Failed to find basename for value!"),e;var t=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals+=t,e.substr(1)):"_"==e.substr(0,1)?(n.accidentalFlats+=t,n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),e):"^"==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),n.accidentalSharps+=t,e):-1!=n.accidentalNaturals.search(t)?e:-1!=n.sharps.search(t)||-1!=n.accidentalSharps.search(t)?"^"+e:-1!=n.flats.search(t)||-1!=n.accidentalFlats.search(t)?"_"+e:e}function _(e){return e.split(/^X:.*$/gm).length-1}function f(e,a){var n=escape(e).split("%0A"),r="",t="";for(i=0;i<n.length;++i){var s=(t=unescape(n[i])).split("");"|"!=s[0]&&"["!=s[0]&&":"==s[1]?(r+=t+"\n","X"==s[0]&&(r+=a+"\n")):(r+=t,i!=n.length-1&&(r+="\n"))}return r}function d(e,a){return"X:"+e.split(/^X:/gm)[a+1]}function h(e){return e=e.replace(/%.*[\r\n]*/gm,"")}function $(e){return e=e.replace(/"[^"]*"/gm,"")}return function e(a){var n=a.split(/^X:.*$/gm).length-1,r=gInjectTab_InjectVolumeDirectives,s=gInjectTab_FontFamily,l=gInjectTab_TabFontSize,c=gInjectTab_MusicSpace,o=gInjectTab_StaffSep;parseInt(gInjectTab_TabLocation);for(var u=gInjectTab_StripChords,_="",g=0;g<n;++g){var p=d(a,g);switch(p=h(p),u&&(p=$(p)),p=t(p),p=f(p,"%%musicspace "+c),p=f(p,"%%staffsep "+o),p=f(p,"%%annotationfont "+s+" "+l),parseInt(gBambooFluteKey)){case 0:p=f(p,"%%text "),p=f(p,"%%text 1=C");break;case 1:p=f(p,"%%text "),p=f(p,"%%text 1=D");break;case 2:p=f(p,"%%text "),p=f(p,"%%text 1=G");break;case 3:p=f(p,"%%text "),p=f(p,"%%text 1=A")}r&&(p=f(p,"%%MIDI bassvol 0"),p=f(p,"%%MIDI chordvol 0")),_+=p}return _}(e)};
