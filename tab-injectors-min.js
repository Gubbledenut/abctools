var angloFingeringsGenerator=function(e,a){var n,r="",t=function(e,a,n,r){this.name=e,this.notes=a,this.cost=n,this.finger=r},s={L1a:new t("L1a",["E,","F,"],10,"l4"),L2a:new t("L2a",["A,","_B,"],10,"l4"),L3a:new t("L3a",["^C","_E"],10,"l3"),L4a:new t("L4a",["A","G"],10,"l2"),L5a:new t("L5a",["^G","_B"],10,"l1"),L1:new t("L1",["C,","G,"],1,"l4"),L2:new t("L2",["G,","B,"],1,"l4"),L3:new t("L3",["C","D"],1,"l3"),L4:new t("L4",["E","F"],1,"l2"),L5:new t("L5",["G","A"],1,"l1"),L6:new t("L6",["B,","A,"],1,"l4"),L7:new t("L7",["D","^F"],2,"l4"),L8:new t("L8",["G","A"],2,"l3"),L9:new t("L9",["B","c"],2,"l2"),L10:new t("L10",["d","e"],2,"l1"),R1:new t("R1",["c","B"],1,"r1"),R2:new t("R2",["e","d"],1,"r2"),R3:new t("R3",["g","f"],2,"r3"),R4:new t("R4",["c'","a"],2,"r4"),R5:new t("R5",["e'","b"],2,"r4"),R6:new t("R6",["g","^f"],1,"r1"),R7:new t("R7",["b","a"],1,"r2"),R8:new t("R8",["d'","c'"],1,"r3"),R9:new t("R9",["g'","e'"],1,"r4"),R10:new t("R10",["b'","^f'"],1,"r4")};new t("L1a",["E,","F,"],10,"l4"),new t("L2a",["A,","_B,"],10,"l4"),new t("L3a",["^C","_E"],10,"l3"),new t("L4a",["A","G"],10,"l2"),new t("L5a",["^G","_B"],10,"l1"),new t("L1",["C,","G,"],1,"l4"),new t("L2",["G,","B,"],1,"l4"),new t("L3",["C","D"],1,"l3"),new t("L4",["E","F"],1,"l2"),new t("L5",["G","A"],1,"l1"),new t("L6",["B,","A,"],1,"l4"),new t("L7",["D","^F"],2,"l4"),new t("L8",["G","A"],2,"l3"),new t("L9",["B","c"],2,"l2"),new t("L10",["d","e"],1,"l1"),new t("R1",["c","B"],1,"r1"),new t("R2",["e","d"],2,"r2"),new t("R3",["g","f"],2,"r3"),new t("R4",["c'","a"],2,"r4"),new t("R5",["e'","b"],2,"r4"),new t("R6",["g","^f"],1,"r1"),new t("R7",["b","a"],1,"r2"),new t("R8",["d'","c'"],1,"r3"),new t("R9",["g'","e'"],1,"r4"),new t("R10",["b'","^f'"],1,"r4");var l={L1a:new t("L1a",["E,","F,"],10,"l4"),L2a:new t("L2a",["A,","_B,"],10,"l4"),L3a:new t("L3a",["^C","_E"],10,"l3"),L4a:new t("L4a",["A","G"],10,"l2"),L5a:new t("L5a",["^G","_B"],10,"l1"),L1:new t("L1",["C,","G,"],1,"l4"),L2:new t("L2",["G,","B,"],1,"l4"),L3:new t("L3",["C","D"],1,"l3"),L4:new t("L4",["E","F"],1,"l2"),L5:new t("L5",["G","A"],1,"l1"),L6:new t("L6",["B,","A,"],1,"l4"),L7:new t("L7",["D","^F"],2,"l4"),L8:new t("L8",["G","A"],2,"l3"),L9:new t("L9",["B","z"],2,"l2"),L9a:new t("L9",["z","c"],1,"l2"),L10:new t("L10",["d","e"],1,"l1"),R1:new t("R1",["c","x"],2,"r1"),R1x:new t("R1",["x","B"],1,"r1"),R2:new t("R2",["e","d"],2,"r2"),R3:new t("R3",["g","f"],2,"r3"),R4:new t("R4",["c'","a"],2,"r4"),R5:new t("R5",["e'","b"],2,"r4"),R6:new t("R6",["g","^f"],1,"r1"),R7:new t("R7",["b","a"],1,"r2"),R8:new t("R8",["d'","c'"],1,"r3"),R9:new t("R9",["g'","e'"],1,"r4"),R10:new t("R10",["b'","^f'"],1,"r4")};new t("R1a",["^d","^c"],1,"r1"),new t("R2a",["^c","^d"],10,"r2"),new t("R3a",["^g","g"],10,"r3"),new t("R4a",["^c'","_b"],10,"r4"),new t("R5a",["a","d'"],10,"r4");var i={R1a:new t("R1a",["^d","^c"],10,"r1"),R2a:new t("R2a",["^c","^d"],1,"r2"),R3a:new t("R3a",["^g","g"],10,"r3"),R4a:new t("R4a",["^c'","_b"],10,"r4"),R5a:new t("R5a",["a","d'"],10,"r4")},c={R1a:new t("R1a",["^c","^d"],10,"r1"),R2a:new t("R2a",["a","g"],10,"r2"),R3a:new t("R3a",["^g","_b"],10,"r3"),R4a:new t("R4a",["^c'","_e'"],10,"r4"),R5a:new t("R5a",["a","f'"],10,"r4")},o=["1a","2a","3a","4a","5a","1a","2a","3a","4a","5a","1","2","3","4","5","1","2","3","4","5","6","7","8","9","10","6","7","8","9","10"],u=null,_=null,d=null,f=null,h=null,g=0;function $(e){}function p(e){if($("Got input:"+e),!function e(){var a,n,r=parseInt(gInjectTab_ConcertinaFingering);switch(u=[],_=[],r){case 0:for(var t in i)u[t]=i[t];for(var t in c)_[t]=c[t];for(var t in s)u[t]=s[t],_[t]=s[t];break;case 1:for(var t in i)u[t]=i[t];for(var t in c)_[t]=c[t];for(var t in l)u[t]=l[t];for(var t in l)_[t]=l[t]}d=(a=d=0==parseInt(gInjectTab_ConcertinaStyle)?u:_,n=gAngloButtonNames,gInjectTab_GaryCoover&&(gAngloButtonNames=o),a.L1a.name=gAngloButtonNames[0],a.L2a.name=gAngloButtonNames[1],a.L3a.name=gAngloButtonNames[2],a.L4a.name=gAngloButtonNames[3],a.L5a.name=gAngloButtonNames[4],a.R1a.name=gAngloButtonNames[5],a.R2a.name=gAngloButtonNames[6],a.R3a.name=gAngloButtonNames[7],a.R4a.name=gAngloButtonNames[8],a.R5a.name=gAngloButtonNames[9],a.L1.name=gAngloButtonNames[10],a.L2.name=gAngloButtonNames[11],a.L3.name=gAngloButtonNames[12],a.L4.name=gAngloButtonNames[13],a.L5.name=gAngloButtonNames[14],a.R1.name=gAngloButtonNames[15],a.R1x&&(a.R1x.name=gAngloButtonNames[15]),a.R2.name=gAngloButtonNames[16],a.R3.name=gAngloButtonNames[17],a.R4.name=gAngloButtonNames[18],a.R5.name=gAngloButtonNames[19],a.L6.name=gAngloButtonNames[20],a.L7.name=gAngloButtonNames[21],a.L8.name=gAngloButtonNames[22],a.L9.name=gAngloButtonNames[23],a.L9a&&(a.L9a.name=gAngloButtonNames[23]),a.L10.name=gAngloButtonNames[24],a.R6.name=gAngloButtonNames[25],a.R7.name=gAngloButtonNames[26],a.R8.name=gAngloButtonNames[27],a.R9.name=gAngloButtonNames[28],a.R10.name=gAngloButtonNames[29],gInjectTab_GaryCoover&&(gAngloButtonNames=n),a)}(),null==(f=function e(a){var n,r,t=null,s=a.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==s||s.length<3)return null;if($("Got base key of '"+(n=void 0==s[2]?s[1]:s[1]+s[2])+"' and extra of '"+(r=s[3].toLowerCase())+"'"),""==r||-1!=r.search("maj")||-1!=r.search("ion")?($("Mode: Ionian (major)"),t=G(n,0)):-1!=r.search("mix")?($("Mode: Mixolydian"),t=G(n,1)):-1!=r.search("dor")?($("Mode: Dorian"),t=G(n,2)):-1!=r.search("m")&&-1==r.search("mix")||-1!=r.search("min")||-1!=r.search("aeo")?($("Mode: Aeolian (minor)"),t=G(n,3)):-1!=r.search("phr")?($("Mode: Phrygian"),t=G(n,4)):-1!=r.search("loc")?($("Mode: Locrian"),t=G(n,5)):-1!=r.search("lyd")?($("Mode: Lydian"),t=G(n,-1)):-1!=r.search("exp")?($("(Accidentals to be explicitly specified)"),t=G("C",0)):($("Failed to determine key signature mode"),t=null),null==t)return t;var l=r.match(/_./g),i=r.match(/\^./g);for(note in l)t.flats+=l[note][1].toUpperCase();for(note in i)t.sharps+=i[note][1].toUpperCase();return t}(e)))return"ERROR: Unknown or unsupported key signature";var a,g=function e(a){for(var n,r,t=a,s=/^\w:.*$/mg;n=s.exec(a);)t=w(t,n.index,n[0].length);for(var l=/"[^"]*"/gm;r=l.exec(t);)for(var i=r.index,c=i+r[0].length,o=i;o<c;++o)t=t.substring(0,o)+"*"+t.substring(o+1);for(l=/\[[^\]|]*\]/g;r=l.exec(t);)for(var i=r.index,c=i+r[0].length,o=i;o<c;++o)t=t.substring(0,o)+"*"+t.substring(o+1);for(l=/^%%begintext((.|\n)*)%%endtext/gm;r=l.exec(t);)for(var i=r.index,c=i+r[0].length,o=i;o<c;++o)t=t.substring(0,o)+"*"+t.substring(o+1);for(l=/^%.*$/gm;r=l.exec(t);)for(var i=r.index,c=i+r[0].length,o=i;o<c;++o)t=t.substring(0,o)+"*"+t.substring(o+1);$("orginal input:\n"+a),$("sanitized input:\n"+t);for(var u=/([=^_]?[a-gA-G][',]?|\|)/g,_=[];r=u.exec(t);){var d=r[1];if("|"==d)f.accidentalFlats="",f.accidentalSharps="",f.accidentalNaturals="";else{var h=C(d);$("UnNormalized="+d+" normalized="+h),_.push(new m(r.index,d,h))}}return _}(e),p=function e(a){var n={};for(var r in a){var t=a[r].notes;if(null==t){$("Failed to find entry for button "+b);continue}t.forEach(function(e){null==n[e]?n[e]=[a[r]]:n[e].push(a[r]),null==n[e=y(e)]?n[e]=[a[r]]:n[e].push(a[r])})}return n}(d);!function e(a){for(var n in a)a[n].sort(function(e,a){return e.cost-a.cost})}(p);var D,L=(a=function e(a,n){for(var s=null,l=null,i=0;i<a.length;++i){var c=a[i],o=c.normalizedValue,u=n[o];if(null==u||u.length<1){$("Failed to find button for note "+o),$("Attempting respell...");var _=y(o);if($("Respelled as "+_),null==(u=n[_])||u.length<1)return $("Respelling as "+_+" failed to find a button."),r="ERROR:Failed to find button for note '"+o+"'",null}var d=[];u.forEach(function(e){d.push(new x(c,e,A(c,e)))}),null==s&&(s=d),null!=l&&l.forEach(function(e){e.nextStates=d}),l=d}var f=new x(null,new t("root",[],0,"none"));return f.nextStates=s,f}(g,p),n=1e8,h={},function e(a){if(0==a.nextStates.length)return $("Last state, note="+a.note.normalizedValue+" button="+a.button.name+". Popping up the stack"),new v([a],a.button.cost);var n=a.note,r=null,t=null;if(null!=n&&(r=n.unNormalizedValue,t=n.normalizedValue),$("Choosing: current note="+t+" button="+a.button.name),h[a])return $("Already visited state note="+a.note.normalizedValue+" button="+a.button.name),h[a];for(var s=new v([],1e7),l=0;l<a.nextStates.length;++l){var i=a.nextStates[l];$("Trying next ["+l+"/"+a.nextStates.length+"] note="+i.note.normalizedValue+" button="+i.button.name);var c=e(i);if(null==c)return $("Could not get fingerings"),null;var o=a.button.cost;if(0!=c.states.length){var u=c.states[0].button;c.states[0].button.finger,F(a.button,u)&&($("Penalizing finger hop for note "+t),o+=100)}if($("path had cost of "+c.cost+" my cost="+o),c.cost+o<s.cost){var _=c.states.slice(0);_.unshift(a),$("New best path for note["+t+"], cost="+(s=new v(_,c.cost+o)).cost)}}return h[a]=s,$("Done choosing: current note="+t+" button="+a.button.name+" best cost="+s.cost),s}(a));return null==L?($("No fingerings generated!"),r):r=function e(a,n,r){if(n.states.shift(),n.states.length!=r.length)return"ERROR: Internal error. Length mismatch";for(var t=a,s=0,l=parseInt(gInjectTab_TabLocation),i=0;i<n.states.length;++i){var c=r[i].index+s,o=n.states[i].button.name;if(gInjectTab_GaryCoover){if(0==n.states[i].button.finger.indexOf("l")){if(n.states[i].direction==R)o='"_ ;'+o+'"';else{for(var u=o.length,_="",d=0;d<u;++d)_+="_";var f=o;o=(o='"_'+_+";")+f+'"'}}else if(n.states[i].direction==R)o='"^'+o+'"';else{for(var u=o.length,_="",d=0;d<u;++d)_+="_";var f=o;o=(o='"^'+_+";")+f+'"'}}else if(gInjectTab_UseBarForDraw)switch(l){case 0:if(n.states[i].direction==R)o='"^'+o+'"';else{for(var u=o.length,_="",d=0;d<u;++d)_+="_";var f=o;o=(o='"^'+_+";")+f+'"'}break;case 1:if(n.states[i].direction==R)o='"_ ;'+o+'"';else{for(var u=o.length,_="",d=0;d<u;++d)_+="_";var f=o;o=(o='"_'+_+";")+f+'"'}}else switch(l){case 0:o=(o='"^'+o+";")+n.states[i].direction+'"';break;case 1:o=(o='"_'+o+";")+n.states[i].direction+'"'}var h=o.length;t=t.substr(0,c)+o+t.substr(c),s+=h}return t}(e,L,g)}var v=function(e,a){this.states=e,this.cost=a},m=function(e,a,n){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n},x=function(e,a,n){this.note=e,this.button=a,this.direction=n,this.nextStates=[],this.id=g++,this.toString=function(){var e="["+this.id+"] Note:";return this.note?e+=this.note.normalizedValue:e+="none",e+=" Button:"+this.button.name}};function G(e,a){var n="FCGDAEB",r={sharps:"",flats:""},t=n.indexOf(e[0])-1;if(-2==t)return $("Bad tonic: "+e),null;"b"==e.slice(1)?t-=7:"#"==e.slice(1)&&(t+=7);var s=t-a;return s>7?($("Too many sharps: "+s),null):s<-7?($("Too many flats: "+-1*s),null):(s>0?r.sharps=n.slice(0,s):s<0&&(r.flats=n.slice(s)),r.accidentalSharps="",r.accidentalFlats="",r.accidentalNaturals="",r)}function A(e,a){if(e.normalizedValue==a.notes[0])return R;if(e.normalizedValue==a.notes[1])return B;var n=function e(a){var n=a,r={"^A":"_B","^D":"_E","^G":"_A"};for(var t in r)n=(n=n.replace(t,r[t])).replace(t.toLowerCase(),r[t].toLowerCase());return n}(e.normalizedValue);return n==a.notes[0]?R:n==a.notes[1]?B:" "}function F(e,a){return e.finger==a.finger&&e.name!=a.name}function w(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function y(e){var a=e,n={_B:"^A","^B":"C",_C:"B",_D:"^C","^D":"_E",_E:"^D","^E":"F",_F:"E",_G:"^F","^G":"_A"};for(var r in n)a=(a=a.replace(r,n[r])).replace(r.toLowerCase(),n[r].toLowerCase());return a}function C(e){var a=e.search(/[A-G]/i);if(-1==a)return $("Failed to find basename for value!"),e;var n=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(f.accidentalFlats=f.accidentalFlats.replace(n,""),f.accidentalSharps=f.accidentalSharps.replace(n,""),f.accidentalNaturals+=n,e.substr(1)):"_"==e.substr(0,1)?(f.accidentalFlats+=n,f.accidentalSharps=f.accidentalSharps.replace(n,""),f.accidentalNaturals=f.accidentalNaturals.replace(n,""),e):"^"==e.substr(0,1)?(f.accidentalFlats=f.accidentalFlats.replace(n,""),f.accidentalNaturals=f.accidentalNaturals.replace(n,""),f.accidentalSharps+=n,e):-1!=f.accidentalNaturals.search(n)?e:-1!=f.sharps.search(n)||-1!=f.accidentalSharps.search(n)?"^"+e:-1!=f.flats.search(n)||-1!=f.accidentalFlats.search(n)?"_"+e:e}function D(e){return e.split(/^X:.*$/gm).length-1}function L(e,a){return"X:"+e.split(/^X:/gm)[a+1]}var R="↓",B="↑";return function e(a,n){var r=a.split(/^X:.*$/gm).length-1,t=gInjectTab_FontFamily,s=gInjectTab_TabFontSize,l=gInjectTab_MusicSpace,i=gInjectTab_StaffSep,c=parseInt(gInjectTab_TabLocation),o=gInjectTab_StripChords;R=gInjectTab_PushGlyph,B=gInjectTab_DrawGlyph;for(var u=FindPreTuneHeader(a),_=!1,d=[],f=0;f<r;++f){var h=L(a,f),g=h;if(isSectionHeader(h)){u+=h;continue}h=StripTabOne(h),(gInjectTab_GaryCoover||0==c||1==c&&o)&&(h=StripChordsOne(h));try{h=p(h)}catch($){u+=g;var v=getTuneTitle(g);d.push(v),_=!0;continue}h=InjectStringBelowTuneHeaderConditional(h,"%%staffsep "+i),h=InjectStringAboveTuneHeaderConditional(h,"%%annotationfont "+t+" "+s),h=InjectStringAboveTuneHeaderConditional(h,"%%musicspace "+l),u+=h}if(_){for(var m='<p style="text-align:center;font-size:18px;margin-bottom:18px">No Anglo Concertina tablature generated for one or more tunes:</p>',x=0;x<d.length;++x)m+='<p style="text-align:center;font-size:18px;">'+d[x]+"</p>";n(u,!0,m+='<p style="text-align:center;font-size:18px;line-height:24px;margin-top:18px">Some notes may be outside the range or not available on the selected style of Anglo concertina.</p>')}else n(u,!1,"")}(e,a)},boxTabGenerator=function(e){var a=null;function n(e){}function r(e){n("Got input:"+e);var r=parseInt(gInjectTab_BoxStyle);if(null==(a=function e(a){var r,t,l=null,i=a.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==i||i.length<3)return null;if(n("Got base key of '"+(r=void 0==i[2]?i[1]:i[1]+i[2])+"' and extra of '"+(t=i[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(n("Mode: Ionian (major)"),l=s(r,0)):-1!=t.search("mix")?(n("Mode: Mixolydian"),l=s(r,1)):-1!=t.search("dor")?(n("Mode: Dorian"),l=s(r,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(n("Mode: Aeolian (minor)"),l=s(r,3)):-1!=t.search("phr")?(n("Mode: Phrygian"),l=s(r,4)):-1!=t.search("loc")?(n("Mode: Locrian"),l=s(r,5)):-1!=t.search("lyd")?(n("Mode: Lydian"),l=s(r,-1)):-1!=t.search("exp")?(n("(Accidentals to be explicitly specified)"),l=s("C",0)):(n("Failed to determine key signature mode"),l=null),null==l)return l;var c=t.match(/_./g),o=t.match(/\^./g);for(note in c)l.flats+=c[note][1].toUpperCase();for(note in o)l.sharps+=o[note][1].toUpperCase();return l}(e)))return"ERROR: Unknown or unsupported key signature";var o=function e(r,s){for(var o,u,_=r,d=/^\w:.*$/mg;o=d.exec(r);)_=l(_,o.index,o[0].length);for(var f=/"[^"]*"/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/\[[^\]|]*\]/g;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%%begintext((.|\n)*)%%endtext/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%.*$/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);n("sanitized input:"+_);for(var p=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];u=p.exec(_);){var m=u[1];if("|"==m)a.accidentalFlats="",a.accidentalSharps="",a.accidentalNaturals="";else{var x=c(m);n("UnNormalized="+m+" normalized="+x);var G=i(x,s);v.push(new t(u.index,m,x,G))}}return v}(e,r);return function e(a,n){for(var r,t=a,s=0,l=parseInt(gInjectTab_TabLocation),i=0;i<n.length;++i){var c=n[i].index+s,o=n[i].glyph,u=o.length,d=o.substr(0,1),f=o.substr(1,u-1);if(0==o.indexOf("10")&&(d=o.substr(0,2),f=o.substr(2,u-1)),gInjectTab_UseBarForDraw)switch(l){case 0:if(f==_)r='"^'+d+'"';else{for(var h=d.length,g="",$=0;$<h;++$)g+="_";if(gIsChrome||gIsSafari)switch(d){case"①":case"②":case"③":case"④":case"⑤":case"⑥":case"⑦":case"⑧":case"⑨":case"⑩":case"⑪":g+="_"}r=(r='"^'+g+";")+d+'"'}break;case 1:if(f==_)r='"_ ;'+d+'"';else{for(var h=d.length,g="",$=0;$<h;++$)g+="_";if(gIsChrome||gIsSafari)switch(d){case"①":case"②":case"③":case"④":case"⑤":case"⑥":case"⑦":case"⑧":case"⑨":case"⑩":case"⑪":g+="_"}r=(r='"_'+g+";")+d+'"'}}else switch(l){case 0:r=(r='"^'+d+";")+f+'"';break;case 1:r=(r='"_'+d+";")+f+'"'}var p=r.length;t=t.substr(0,c)+r+t.substr(c),s+=p}return t}(e,o)}var t=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function s(e,a){var r="FCGDAEB",t={sharps:"",flats:""},s=r.indexOf(e[0])-1;if(-2==s)return n("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(n("Too many sharps: "+l),null):l<-7?(n("Too many flats: "+-1*l),null):(l>0?t.sharps=r.slice(0,l):l<0&&(t.flats=r.slice(l)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function l(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function i(e,a){switch(a){case 0:var n={"^D,":"①"+_,"_E,":"①"+_,"E,":"1"+_,"F,":"x ","^F,":"②"+_,"_G,":"②"+_,"G,":"2"+_,"^G,":"①"+d,"_A,":"①"+d,"A,":"1"+d,"^A,":"②"+d,"_B,":"②"+d,"B,":"2"+d,C:"3"+_,"^C":"③"+d,_D:"③"+d,D:"3"+d,"^D":"④"+_,_E:"④"+_,E:"4"+_,F:"4"+d,"^F":"⑤"+_,_G:"⑤"+_,G:"5"+_,"^G":"⑤"+d,_A:"⑤"+d,A:"5"+d,"^A":"⑥"+d,_B:"⑥"+d,B:"6"+d,c:"6"+_,"^c":"⑦"+d,_d:"⑦"+d,d:"7"+d,"^d":"⑦"+_,_e:"⑦"+_,e:"7"+_,f:"8"+d,"^f":"⑧"+_,_g:"⑧"+_,g:"8"+_,"^g":"⑨"+d,_a:"⑨"+d,a:"9"+d,"^a":"⑩"+d,_b:"⑩"+d,b:"10"+d,"c'":"9"+_,"^c'":"⑪"+d,"_d'":"⑪"+d,"d'":"x ","^d'":"⑩"+_,"_e'":"⑩"+_,"e'":"10"+_,"^f'":"⑪"+_,"_g'":"⑪"+_},r=n[e];if(!r)return"x ";break;case 1:var n={"F,":"①"+_,"^F,":"1"+_,"_G,":"1"+_,"G,":"x ","^G,":"②"+_,"_A,":"②"+_,"A,":"2"+_,"^A,":"①"+d,"_B,":"①"+d,"B,":"1"+d,C:"②"+d,"^C":"2"+d,_D:"2"+d,D:"3"+_,"^D":"③"+d,_E:"③"+d,E:"3"+d,F:"④"+_,"^F":"4"+_,_G:"4"+_,G:"4"+d,"^G":"⑤"+_,_A:"⑤"+_,A:"5"+_,"^A":"⑤"+d,_B:"⑤"+d,B:"5"+d,c:"⑥"+d,"^c":"6"+d,_d:"6"+d,d:"6"+_,"^d":"⑦"+d,_e:"⑦"+d,e:"7"+d,f:"⑦"+_,"^f":"7"+_,_g:"7"+_,g:"8"+d,"^g":"⑧"+_,_a:"⑧"+_,a:"8"+_,"^a":"⑨"+d,_b:"⑨"+d,b:"9"+d,"c'":"⑩"+d,"^c'":"10"+d,"_d'":"10"+d,"d'":"9"+_,"^d'":"⑪"+d,"_e'":"⑪"+d,"e'":"x ","f'":"⑩"+_,"^f'":"10"+_,"_g'":"10"+_,"g'":"x ","^g'":"⑪"+_,"_a'":"⑪"+_},r=n[e];if(!r)return"x "}return r}function c(e){var r=e.search(/[A-G]/i);if(-1==r)return n("Failed to find basename for value!"),e;var t=e.substr(r,1).toUpperCase();return"="==e.substr(0,1)?(a.accidentalFlats=a.accidentalFlats.replace(t,""),a.accidentalSharps=a.accidentalSharps.replace(t,""),a.accidentalNaturals+=t,e.substr(1)):"_"==e.substr(0,1)?(a.accidentalFlats+=t,a.accidentalSharps=a.accidentalSharps.replace(t,""),a.accidentalNaturals=a.accidentalNaturals.replace(t,""),e):"^"==e.substr(0,1)?(a.accidentalFlats=a.accidentalFlats.replace(t,""),a.accidentalNaturals=a.accidentalNaturals.replace(t,""),a.accidentalSharps+=t,e):-1!=a.accidentalNaturals.search(t)?e:-1!=a.sharps.search(t)||-1!=a.accidentalSharps.search(t)?"^"+e:-1!=a.flats.search(t)||-1!=a.accidentalFlats.search(t)?"_"+e:e}function o(e){return e.split(/^X:.*$/gm).length-1}function u(e,a){return"X:"+e.split(/^X:/gm)[a+1]}var _="↓",d="↑";return function e(a){var n=a.split(/^X:.*$/gm).length-1,t=gInjectTab_FontFamily,s=gInjectTab_TabFontSize,l=gInjectTab_MusicSpace,i=gInjectTab_StaffSep,c=parseInt(gInjectTab_TabLocation),o=gInjectTab_StripChords;_=gInjectTab_PushGlyph,d=gInjectTab_DrawGlyph;for(var f=FindPreTuneHeader(a),h=0;h<n;++h){var g=u(a,h);if(isSectionHeader(g)){f+=g;continue}g=StripTabOne(g),(0==c||1==c&&o)&&(g=StripChordsOne(g)),g=r(g),g=InjectStringBelowTuneHeaderConditional(g,"%%staffsep "+i),g=InjectStringAboveTuneHeaderConditional(g,"%%annotationfont "+t+" "+s),g=InjectStringAboveTuneHeaderConditional(g,"%%musicspace "+l),f+=g}return f}(e)},bambooFluteTabGenerator=function(e){var a="",n=null;function r(e){}function t(e){r("Got input:"+e);var t=parseInt(gBambooFluteKey);if(null==(n=function e(a){var n,t,s=null,i=a.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==i||i.length<3)return null;if(r("Got base key of '"+(n=void 0==i[2]?i[1]:i[1]+i[2])+"' and extra of '"+(t=i[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(r("Mode: Ionian (major)"),s=l(n,0)):-1!=t.search("mix")?(r("Mode: Mixolydian"),s=l(n,1)):-1!=t.search("dor")?(r("Mode: Dorian"),s=l(n,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(r("Mode: Aeolian (minor)"),s=l(n,3)):-1!=t.search("phr")?(r("Mode: Phrygian"),s=l(n,4)):-1!=t.search("loc")?(r("Mode: Locrian"),s=l(n,5)):-1!=t.search("lyd")?(r("Mode: Lydian"),s=l(n,-1)):-1!=t.search("exp")?(r("(Accidentals to be explicitly specified)"),s=l("C",0)):(r("Failed to determine key signature mode"),s=null),null==s)return s;var c=t.match(/_./g),o=t.match(/\^./g);for(note in c)s.flats+=c[note][1].toUpperCase();for(note in o)s.sharps+=o[note][1].toUpperCase();return s}(e)))return"ERROR: Unknown or unsupported key signature";var u=function e(a,t){for(var l,u,_=a,d=/^\w:.*$/mg;l=d.exec(a);)_=i(_,l.index,l[0].length);for(var f=/"[^"]*"/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/\[[^\]|]*\]/g;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%%begintext((.|\n)*)%%endtext/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%.*$/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);r("sanitized input:"+_);for(var p=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];u=p.exec(_);){var m=u[1];if("|"==m)n.accidentalFlats="",n.accidentalSharps="",n.accidentalNaturals="";else{var x=o(m);r("UnNormalized="+m+" normalized="+x);var G=c(x,t);v.push(new s(u.index,m,x,G))}}return v}(e,t);return a=function e(a,n){for(var r,t=a,s=0,l=0;l<n.length;++l){var i=n[l].index+s,c=n[l].glyph,o=c.length,u=c.substr(0,o-1),_=c.substr(o-1,o-1),d=(r="-"!=_?'"_'+_+";"+u+'"':'"_ ;'+u+';•"').length;t=t.substr(0,i)+r+t.substr(i),s+=d}return t}(e,u)}var s=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function l(e,a){var n="FCGDAEB",t={sharps:"",flats:""},s=n.indexOf(e[0])-1;if(-2==s)return r("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(r("Too many sharps: "+l),null):l<-7?(r("Too many flats: "+-1*l),null):(l>0?t.sharps=n.slice(0,l):l<0&&(t.flats=n.slice(l)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function i(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function c(e,a){var n="";switch(a){case 0:var r={"G,":"5-","^G,":"#5-","_A,":"#5-","A,":"6-","^A,":"#6-","_B,":"#6-","B,":"7-",C:"1 ","^C":"#1 ",_D:"#1 ",D:"2 ","^D":"#2 ",_E:"#2 ",E:"3 ",F:"4 ","^F":"#4 ",_G:"#4 ",G:"5 ","^G":"#5 ",_A:"#5 ",A:"6 ","^A":"#6 ",_B:"#6 ",B:"7 ",c:"1•","^c":"#1•",_d:"#1•",d:"2•","^d":"#2•",_e:"#2•",e:"3•",f:"4•","^f":"#4•",_g:"#4•",g:"5•","^g":"#5•",_a:"#5•",a:"6•","^a":"#6•",_b:"#6•",b:"7•"};if(!(n=r[e]))return"x ";break;case 1:var r={"G,":"4-","^G,":"#4-","_A,":"#4-","A,":"5-","^A,":"#5-","_B,":"#5-","B,":"6-",C:"#6-","^C":"7-",_D:"7-",D:"1 ","^D":"#1 ",_E:"#1 ",E:"2 ",F:"#2 ","^F":"3 ",_G:"3 ",G:"4 ","^G":"#4 ",_A:"#4 ",A:"5 ","^A":"#5 ",_B:"#5 ",B:"6 ",c:"#6 ","^c":"7 ",_d:"7 ",d:"1•","^d":"#1•",_e:"#1•",e:"2•",f:"#2•","^f":"3•",_g:"3•",g:"4•","^g":"#4•",_a:"#4•",a:"5•","^a":"#5•",_b:"#5•",b:"6•","c'":"#6•","^c'":"7•"};if(!(n=r[e]))return"x ";break;case 2:var r={"G,":"1-","^G,":"#1-","_A,":"#1-","A,":"2-","^A,":"#2-","_B,":"#2-","B,":"3-",C:"4-","^C":"#4-",_D:"#4-",D:"5-","^D":"#5-",_E:"#5-",E:"6-",F:"#6-","^F":"7-",G:"1 ","^G":"#1 ",_A:"#1 ",A:"2 ","^A":"#2 ",_B:"#2 ",B:"3 ",c:"4 ","^c":"#4 ",_d:"#4 ",d:"5 ","^d":"#5 ",_e:"#5 ",e:"6 ",f:"#6 ","^f":"7 ",_g:"7 ",g:"1•","^g":"#1•",_a:"#1•",a:"2•","^a":"#2•",_b:"#2•",b:"3•","c'":"4•","^c'":"#4•","_d'":"#4•","d'":"5•","^d'":"#5•","_e'":"#5•","e'":"6•","f'":"6#•","^f'":"7•","_g'":"7•"};if(!(n=r[e]))return"x ";break;case 3:var r={"A,":"1-","^A,":"#1-","_B,":"#1-","B,":"2-",C:"#2-","^C":"3-",_D:"3-",D:"4-","^D":"#4-",_E:"#4-",E:"5-",F:"#5-","^F":"6-",_G:"6-",G:"6#-","^G":"7-",_A:"7-",A:"1 ","^A":"#1 ",_B:"#1 ",B:"2 ",c:"#2 ","^c":"3 ",_d:"3 ",d:"4 ","^d":"#4 ",_e:"#4 ",e:"5 ",f:"#5 ","^f":"6 ",_g:"6 ",g:"6# ","^g":"7 ",_a:"7 ",a:"1•","^a":"#1•",_b:"#1•",b:"2•","c'":"#2•","^c'":"3•","_d'":"3•","d'":"4•","^d'":"#4•","_e'":"#4•","e'":"5•","f'":"#5•","^f'":"6•","_g'":"6•","g'":"6#•","^g'":"7•","_a'":"7•"};if(!(n=r[e]))return"x "}return n}function o(e){var a=e.search(/[A-G]/i);if(-1==a)return r("Failed to find basename for value!"),e;var t=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals+=t,e.substr(1)):"_"==e.substr(0,1)?(n.accidentalFlats+=t,n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),e):"^"==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),n.accidentalSharps+=t,e):-1!=n.accidentalNaturals.search(t)?e:-1!=n.sharps.search(t)||-1!=n.accidentalSharps.search(t)?"^"+e:-1!=n.flats.search(t)||-1!=n.accidentalFlats.search(t)?"_"+e:e}function u(e){return e.split(/^X:.*$/gm).length-1}function _(e,a){return"X:"+e.split(/^X:/gm)[a+1]}return function e(a){var n=a.split(/^X:.*$/gm).length-1,r=gInjectTab_FontFamily,s=gInjectTab_TabFontSize,l=gInjectTab_MusicSpace,i=gInjectTab_StaffSep;parseInt(gInjectTab_TabLocation);for(var c=gInjectTab_StripChords,o=FindPreTuneHeader(a),u=0;u<n;++u){var d=_(a,u);if(isSectionHeader(d)){o+=d;continue}switch(d=StripTabOne(d),c&&(d=StripChordsOne(d)),d=t(d),d=InjectStringBelowTuneHeaderConditional(d,"%%staffsep "+i),parseInt(gBambooFluteKey)){case 0:d=InjectStringBelowTuneHeaderConditional(d,"%%text 1=C"),d=InjectStringBelowTuneHeaderConditional(d,"%%text ");break;case 1:d=InjectStringBelowTuneHeaderConditional(d,"%%text 1=D"),d=InjectStringBelowTuneHeaderConditional(d,"%%text ");break;case 2:d=InjectStringBelowTuneHeaderConditional(d,"%%text 1=G"),d=InjectStringBelowTuneHeaderConditional(d,"%%text ");break;case 3:d=InjectStringBelowTuneHeaderConditional(d,"%%text 1=A"),d=InjectStringBelowTuneHeaderConditional(d,"%%text ")}d=InjectStringAboveTuneHeaderConditional(d,"%%annotationfont "+r+" "+s),d=InjectStringAboveTuneHeaderConditional(d,"%%musicspace "+l),o+=d}return o}(e)},ceoltasABCTransformer=function(e,a){var n="",r=null;function t(e){}function s(e,a){if(t("Got input:"+e),null==(r=function e(a){var n,r,s=null,l=a.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==l||l.length<3)return null;if(t("Got base key of '"+(n=void 0==l[2]?l[1]:l[1]+l[2])+"' and extra of '"+(r=l[3].toLowerCase())+"'"),""==r||-1!=r.search("maj")||-1!=r.search("ion")?(t("Mode: Ionian (major)"),s=i(n,0)):-1!=r.search("mix")?(t("Mode: Mixolydian"),s=i(n,1)):-1!=r.search("dor")?(t("Mode: Dorian"),s=i(n,2)):-1!=r.search("m")&&-1==r.search("mix")||-1!=r.search("min")||-1!=r.search("aeo")?(t("Mode: Aeolian (minor)"),s=i(n,3)):-1!=r.search("phr")?(t("Mode: Phrygian"),s=i(n,4)):-1!=r.search("loc")?(t("Mode: Locrian"),s=i(n,5)):-1!=r.search("lyd")?(t("Mode: Lydian"),s=i(n,-1)):-1!=r.search("exp")?(t("(Accidentals to be explicitly specified)"),s=i("C",0)):(t("Failed to determine key signature mode"),s=null),null==s)return s;var c=r.match(/_./g),o=r.match(/\^./g);for(note in c)s.flats+=c[note][1].toUpperCase();for(note in o)s.sharps+=o[note][1].toUpperCase();return s}(e)))return"ERROR: Unknown or unsupported key signature";var s=function e(a,n){for(var s,i,_=a,d=/^\w:.*$/mg;s=d.exec(a);)_=c(_,s.index,s[0].length);for(var f=/"[^"]*"/gm;i=f.exec(_);)for(var h=i.index,g=h+i[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/\[[^\]|]*\]/g;i=f.exec(_);)for(var h=i.index,g=h+i[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%%begintext((.|\n)*)%%endtext/gm;i=f.exec(_);)for(var h=i.index,g=h+i[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%.*$/gm;i=f.exec(_);)for(var h=i.index,g=h+i[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);t("sanitized input:"+_);for(var p=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];i=p.exec(_);){var m=i[1];if("|"==m)r.accidentalFlats="",r.accidentalSharps="",r.accidentalNaturals="";else{var x=u(m);t("UnNormalized="+m+" normalized="+x);var G=o(m,n);v.push(new l(i.index,m,x,G))}}return v}(e,a);return n=function e(a,n){for(var r,t,s,l,i,c=a,o=0,u=0;u<n.length;++u)r=n[u].index+o,t=n[u].glyph,s=n[u].unNormalizedValue,glyphLen=t.length,l=s.length,c=c.substr(0,r)+t+c.substr(r+l),o+=i=glyphLen-l;return c}(e,s)}var l=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function i(e,a){var n="FCGDAEB",r={sharps:"",flats:""},s=n.indexOf(e[0])-1;if(-2==s)return t("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(t("Too many sharps: "+l),null):l<-7?(t("Too many flats: "+-1*l),null):(l>0?r.sharps=n.slice(0,l):l<0&&(r.flats=n.slice(l)),r.accidentalSharps="",r.accidentalFlats="",r.accidentalNaturals="",r)}function c(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function o(e,a){if(a){var n={"D,":"D,","^D,":"^D,","E,":"E,","F,":"F,","^F,":"^F,","_G,":"_G,","G,":"G,","^G,":"^G,","_A,":"_A,","A,":"A,","^A,":"^A,","_B,":"_B,","B,":"B,",C:"C","^C":"^C",_D:"_D",D:"D","^D":"^D",_E:"_E",E:"E",F:"F","^F":"^F",_G:"_G",G:"G","^G":"^G",_A:"_A",A:"A","^A":"^A",_B:"_B",B:"B","C'":"c","^C'":"^c","_D'":"_d","D'":"d","^D'":"^d","_E'":"_e","E'":"e","F'":"f","^F'":"^f","_G'":"_g","G'":"g","^G'":"^g","_A'":"_a","A'":"a","^A'":"^a","_B'":"_b","B'":"b","C''":"c'","^C''":"^c'","_D''":"_d'","D''":"d'","^D''":"^d'","_E''":"_e'","E''":"e'","F''":"f'","^F''":"^f'","_G''":"_g'","G''":"g'","=D,":"=D,","=E,":"=E,","=F,":"=F,","=G,":"=G,","=A,":"=A,","=B,":"=B,","=C":"=C","=D":"=D","=E":"=E","=F":"=F","=G":"=G","=A":"=A","=B":"=B","=C'":"=c","=D'":"=d","=E'":"=e","=F'":"=f","=G'":"=g","=A'":"=a","=B'":"=b","=C''":"=c'","=D''":"=d'","=E''":"=e'","=F''":"=f'","=G''":"=g'",c:"c","^c":"^c",_d:"_d",d:"d","^d":"^d",_e:"_e",e:"e",f:"f","^f":"^f",_g:"_g",g:"g","^g":"^g",_a:"_a",a:"a","^a":"^a",_b:"_b",b:"b","c'":"c'","^c'":"^c'","_d'":"_d'","d'":"d'","^d'":"^d'","_e'":"_e'","e'":"e'","f'":"f'","^f'":"^f'","_g'":"_g'","g'":"g'","=c":"=c","=d":"=d","=e":"=e","=f":"=f","=g":"=g","=a":"=a","=b":"=b","=c'":"=c'","=d'":"=d'","=e'":"=e'","=f'":"=f'","=g'":"=g'"},r=n[e];return r||"x "}var n={"D,":"D,","^D,":"^D,","E,":"E,","F,":"F,","^F,":"^F,","_G,":"_G,","G,":"G,","^G,":"^G,","_A,":"_A,","A,":"A,","^A,":"^A,","_B,":"_B,","B,":"B,",C:"C","^C":"^C",_D:"_D",D:"D","^D":"^D",_E:"_E",E:"E",F:"F","^F":"^F",_G:"_G",G:"G","^G":"^G",_A:"_A",A:"A","^A":"^A",_B:"_B",B:"B",c:"C'","^c":"^C'",_d:"_D'",d:"D'","^d":"^D'",_e:"_E'",e:"E'",f:"F'","^f":"^F'",_g:"_G'",g:"G'","^g":"^G'",_a:"_A'",a:"A'","^a":"^A'",_b:"_B'",b:"B'","c'":"C''","^c'":"^C''","_d'":"_D''","d'":"D''","^d'":"^D''","_e'":"_E''","e'":"E''","f'":"F''","^f'":"^F''","_g'":"_G''","g'":"G''","=D,":"=D,","=E,":"=E,","=F,":"=F,","=G,":"=G,","=A,":"=A,","=B,":"=B,","=C":"=C","=D":"=D","=E":"=E","=F":"=F","=G":"=G","=A":"=A","=B":"=B","=c":"=C'","=d":"=D'","=e":"=E'","=f":"=F'","=g":"=G'","=a":"=A'","=b":"=B'","=c'":"=C''","=d'":"=D''","=e'":"=E''","=f'":"=F''","=g'":"=G''","C'":"C'","^C'":"^C'","_D'":"_D'","D'":"D'","^D'":"^D'","_E'":"_E'","E'":"E'","F'":"F'","^F'":"^F'","_G'":"_G'","G'":"G'","^G'":"^G'","_A'":"_A'","A'":"A'","^A'":"^A'","_B'":"_B'","B'":"B'","C''":"C''","^C''":"^C''","_D''":"_D''","D''":"D''","^D''":"^D''","_E''":"_E''","E''":"E''","F''":"F''","^F''":"^F''","_G''":"_G''","G''":"G''","=C'":"=C'","=D'":"=D'","=E'":"=E'","=F'":"=F'","=G'":"=G'","=A'":"=A'","=B'":"=B'","=C''":"=C''","=D''":"=D''","=E''":"=E''","=F''":"=F''","=G''":"=G''"},r=n[e];return r||"x "}function u(e){var a=e.search(/[A-G]/i);if(-1==a)return t("Failed to find basename for value!"),e;var n=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(r.accidentalFlats=r.accidentalFlats.replace(n,""),r.accidentalSharps=r.accidentalSharps.replace(n,""),r.accidentalNaturals+=n,e.substr(1)):"_"==e.substr(0,1)?(r.accidentalFlats+=n,r.accidentalSharps=r.accidentalSharps.replace(n,""),r.accidentalNaturals=r.accidentalNaturals.replace(n,""),e):"^"==e.substr(0,1)?(r.accidentalFlats=r.accidentalFlats.replace(n,""),r.accidentalNaturals=r.accidentalNaturals.replace(n,""),r.accidentalSharps+=n,e):-1!=r.accidentalNaturals.search(n)?e:-1!=r.sharps.search(n)||-1!=r.accidentalSharps.search(n)?"^"+e:-1!=r.flats.search(n)||-1!=r.accidentalFlats.search(n)?"_"+e:e}function _(e,a){return"X:"+e.split(/^X:/gm)[a+1]}return function e(a,n){for(var r,t=(r=a).split(/^X:.*$/gm).length-1,l=FindPreTuneHeader(a),i=0;i<t;++i){var c=_(a,i);c=s(c,n),l+=c}return l}(e,a)},fiddleFingeringsGenerator=function(e){var a="",n=null;function r(e){}function t(e){if(r("Got input:"+e),null==(n=function e(a){var n,t,s=null,i=a.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==i||i.length<3)return null;if(r("Got base key of '"+(n=void 0==i[2]?i[1]:i[1]+i[2])+"' and extra of '"+(t=i[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(r("Mode: Ionian (major)"),s=l(n,0)):-1!=t.search("mix")?(r("Mode: Mixolydian"),s=l(n,1)):-1!=t.search("dor")?(r("Mode: Dorian"),s=l(n,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(r("Mode: Aeolian (minor)"),s=l(n,3)):-1!=t.search("phr")?(r("Mode: Phrygian"),s=l(n,4)):-1!=t.search("loc")?(r("Mode: Locrian"),s=l(n,5)):-1!=t.search("lyd")?(r("Mode: Lydian"),s=l(n,-1)):-1!=t.search("exp")?(r("(Accidentals to be explicitly specified)"),s=l("C",0)):(r("Failed to determine key signature mode"),s=null),null==s)return s;var c=t.match(/_./g),o=t.match(/\^./g);for(note in c)s.flats+=c[note][1].toUpperCase();for(note in o)s.sharps+=o[note][1].toUpperCase();return s}(e)))return"ERROR: Unknown or unsupported key signature";var t=function e(a,t){for(var l,u,_=a,d=/^\w:.*$/mg;l=d.exec(a);)_=i(_,l.index,l[0].length);for(var f=/"[^"]*"/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/\[[^\]|]*\]/g;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%%begintext((.|\n)*)%%endtext/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%.*$/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);r("sanitized input:"+_);for(var p=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];u=p.exec(_);){var m=u[1];if("|"==m)n.accidentalFlats="",n.accidentalSharps="",n.accidentalNaturals="";else{var x=o(m);r("UnNormalized="+m+" normalized="+x);var G=c(x,void 0);v.push(new s(u.index,m,x,G))}}return v}(e);return a=function e(a,n){for(var r=a,t=0,s=parseInt(gInjectTab_TabLocation),l=0;l<n.length;++l){var i=n[l].index+t,c=n[l].glyph;switch(c.length,s){case 0:var o='"^'+c+'"';break;case 1:var o='"_'+c+'"'}var u=o.length;r=r.substr(0,i)+o+r.substr(i),t+=u}return r}(e,t)}var s=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function l(e,a){var n="FCGDAEB",t={sharps:"",flats:""},s=n.indexOf(e[0])-1;if(-2==s)return r("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(r("Too many sharps: "+l),null):l<-7?(r("Too many flats: "+-1*l),null):(l>0?t.sharps=n.slice(0,l):l<0&&(t.flats=n.slice(l)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function i(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function c(e){var a={"G,":"0","^G,":"1","_A,":"1","A,":"1","^A,":"2","_B,":"2","B,":"2",C:"3","^C":"3",_D:"3",D:"0","^D":"1",_E:"1",E:"1",F:"2","^F":"2",_G:"2",G:"3","^G":"3",_A:"3",A:"0","^A":"1",_B:"1",B:"1",c:"2","^c":"2",_d:"2",d:"3","^d":"3",_e:"3",e:"0",f:"1","^f":"1",_g:"1",g:"2","^g":"2",_a:"2",a:"3","^a":"3",_b:"3",b:"4","c'":"4","^c'":"4","_d'":"4","d'":"4"}[e];return a||"x "}function o(e){var a=e.search(/[A-G]/i);if(-1==a)return r("Failed to find basename for value!"),e;var t=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals+=t,e.substr(1)):"_"==e.substr(0,1)?(n.accidentalFlats+=t,n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),e):"^"==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),n.accidentalSharps+=t,e):-1!=n.accidentalNaturals.search(t)?e:-1!=n.sharps.search(t)||-1!=n.accidentalSharps.search(t)?"^"+e:-1!=n.flats.search(t)||-1!=n.accidentalFlats.search(t)?"_"+e:e}function u(e){return e.split(/^X:.*$/gm).length-1}function _(e,a){return"X:"+e.split(/^X:/gm)[a+1]}return function e(a){for(var n=a.split(/^X:.*$/gm).length-1,r=gInjectTab_FontFamily,s=gInjectTab_TabFontSize,l=gInjectTab_MusicSpace,i=gInjectTab_StaffSep,c=parseInt(gInjectTab_TabLocation),o=gInjectTab_StripChords,u=FindPreTuneHeader(a),d=0;d<n;++d){var f=_(a,d);if(isSectionHeader(f)){u+=f;continue}f=StripTabOne(f),(0==c||1==c&&o)&&(f=StripChordsOne(f)),f=t(f),f=InjectStringBelowTuneHeaderConditional(f,"%%staffsep "+i),f=InjectStringAboveTuneHeaderConditional(f,"%%annotationfont "+r+" "+s),f=InjectStringAboveTuneHeaderConditional(f,"%%musicspace "+l),u+=f}return u}(e)},MDTablatureGenerator=function(e){var a="",n=null;function r(e){}function t(e){r("Got input:"+e);var t=parseInt(gMDulcimerStyle);if(null==(n=function e(a){var n,t,s=null,i=a.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==i||i.length<3)return null;if(r("Got base key of '"+(n=void 0==i[2]?i[1]:i[1]+i[2])+"' and extra of '"+(t=i[3].toLowerCase())+"'"),""==t||-1!=t.search("maj")||-1!=t.search("ion")?(r("Mode: Ionian (major)"),s=l(n,0)):-1!=t.search("mix")?(r("Mode: Mixolydian"),s=l(n,1)):-1!=t.search("dor")?(r("Mode: Dorian"),s=l(n,2)):-1!=t.search("m")&&-1==t.search("mix")||-1!=t.search("min")||-1!=t.search("aeo")?(r("Mode: Aeolian (minor)"),s=l(n,3)):-1!=t.search("phr")?(r("Mode: Phrygian"),s=l(n,4)):-1!=t.search("loc")?(r("Mode: Locrian"),s=l(n,5)):-1!=t.search("lyd")?(r("Mode: Lydian"),s=l(n,-1)):-1!=t.search("exp")?(r("(Accidentals to be explicitly specified)"),s=l("C",0)):(r("Failed to determine key signature mode"),s=null),null==s)return s;var c=t.match(/_./g),o=t.match(/\^./g);for(note in c)s.flats+=c[note][1].toUpperCase();for(note in o)s.sharps+=o[note][1].toUpperCase();return s}(e)))return"ERROR: Unknown or unsupported key signature";var u=function e(a,t){for(var l,u,_=a,d=/^\w:.*$/mg;l=d.exec(a);)_=i(_,l.index,l[0].length);for(var f=/"[^"]*"/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/\[[^\]|]*\]/g;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%%begintext((.|\n)*)%%endtext/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);for(f=/^%.*$/gm;u=f.exec(_);)for(var h=u.index,g=h+u[0].length,$=h;$<g;++$)_=_.substring(0,$)+"*"+_.substring($+1);r("sanitized input:"+_);for(var p=/([=^_]?[a-gA-G][',]?|\|)/g,v=[];u=p.exec(_);){var m=u[1];if("|"==m)n.accidentalFlats="",n.accidentalSharps="",n.accidentalNaturals="";else{var x=o(m);r("UnNormalized="+m+" normalized="+x);var G=c(x,t);v.push(new s(u.index,m,x,G))}}return v}(e,t);return a=function e(a,n){for(var r,t=a,s=0,l=0;l<n.length;++l){var i=n[l].index+s,c=(r='"_'+n[l].glyph+'"').length;t=t.substr(0,i)+r+t.substr(i),s+=c}return t}(e,u)}var s=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function l(e,a){var n="FCGDAEB",t={sharps:"",flats:""},s=n.indexOf(e[0])-1;if(-2==s)return r("Bad tonic: "+e),null;"b"==e.slice(1)?s-=7:"#"==e.slice(1)&&(s+=7);var l=s-a;return l>7?(r("Too many sharps: "+l),null):l<-7?(r("Too many flats: "+-1*l),null):(l>0?t.sharps=n.slice(0,l):l<0&&(t.flats=n.slice(l)),t.accidentalSharps="",t.accidentalFlats="",t.accidentalNaturals="",t)}function i(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}function c(e,a){switch(a){case 0:var n={"D,":"-;-;0","E,":"-;-;1","^F,":"-;-;2","_G,":"-;-;2","G,":"-;-;3","^G,":"-;6+;-","_A,":"-;6+;-","A,":"-;-;4","B,":"-;-;5",C:"-;-;6","^C":"-;-;6+",_D:"-;-;6+",D:"-;-;0",E:"-;-;1","^F":"-;-;2",_G:"-;-;2",G:"-;-;3","^G":"-;6+;-",_A:"-;6+;-",A:"-;-;4",B:"-;-;5",c:"-;-;6","^c":"-;-;6+",_d:"-;-;6+",d:"-;-;7",e:"-;-;8","^f":"-;-;9",_g:"-;-;9",g:"-;-;10","^g":"-;6+;-",_a:"-;6+;-",a:"-;-;11",b:"-;-;12","c'":"-;-;6","^c'":"-;-;6+","_d'":"-;-;6+","d'":"-;-;7","e'":"-;-;8","^f'":"-;-;9","_g'":"-;-;9","g'":"-;-;10"}[e];if(!n)return"x;x;x";return n;case 1:var n={"D,":"0;-;-","E,":"1;-;-","^F,":"2;-;-","_G,":"2;;-","G,":"3;-;-","^G,":"-;6+;-","_A,":"-;6+;-","A,":"-;0;-","B,":"-;1;-",C:"6;-;-","^C":"-;2;-",_D:"-;2;-",D:"0;-;-",E:"1;-;-","^F":"2;-;-",_G:"2;-;-",G:"3;-;-","^G":"-;6+;-",_A:"-;6+;-",A:"-;0;-",B:"-;1;-",c:"6;-;-","^c":"-;2;-",_d:"-;2;-",d:"-;-;0",e:"-;-;1","^f":"-;-;2",_g:"-;-;2",g:"-;-;3","^g":"-;6+;-",_a:"-;6+;-",a:"-;-;4",b:"-;-;5","c'":"-;-;6","^c'":"-;-;6+","_d'":"-;-;6+","d'":"-;-;7","e'":"-;-;8","^f'":"-;-;9","_g'":"-;-;9","g'":"-;-;10"}[e];if(!n)return"x;x;x";return n;case 2:var n={"D,":"-;-;0","E,":"-;-;1","F,":"-;6;-","^F,":"-;-;2","_G,":"-;-;2","G,":"-;-;3","A,":"-;-;4","B,":"-;-;5",C:"-;3;-","^C":"-;-;6+",_D:"-;-;6+",D:"-;-;0",E:"-;-;1",F:"-;6;-","^F":"-;-;2",_G:"-;-;2",G:"-;-;3",A:"-;-;4",B:"-;-;5",c:"-;-;6","^c":"-;-;6+",_d:"-;-;6+",d:"-;-;7",e:"-;-;8",f:"-;6;-","^f":"-;-;9",_g:"-;-;9",g:"-;-;10",a:"-;-;11",b:"-;-;12","c'":"-;-;6","^c'":"-;-;6+","_d'":"-;-;6+","d'":"-;-;7","e'":"-;-;8","f'":"-;6;-","^f'":"-;-;9","_g'":"-;-;9","g'":"-;-;10"}[e];if(!n)return"x;x;x";return n;case 3:var n={"D,":"0;-;-","E,":"1;-;-","F,":"-;6;-","^F,":"2;-;-","_G,":"2;;-","G,":"-;0;-","A,":"-;1;-","B,":"-;2;-",C:"-;3;-","^C":"6+;-;-",_D:"6+;-;-",D:"0;-;-",E:"1;-;-",F:"-;6;-","^F":"2;-;-",_G:"2;-;-",G:"-;0;-",A:"-;1;-",B:"-;2;-",c:"-;3;-","^c":"6+;-;-",_d:"6+;-;-",d:"-;-;0",e:"-;-;1",f:"-;6;-","^f":"-;-;2",_g:"-;-;2",g:"-;-;3",a:"-;-;4",b:"-;-;5","c'":"-;-;6","^c'":"-;-;6+","_d'":"-;-;6+","d'":"-;-;7","e'":"-;-;8","f'":"-;6;-","^f'":"-;-;9","_g'":"-;-;9","g'":"-;-;10"}[e];if(!n)return"x;x;x";return n;case 4:var n={"G,":"3;-;-","^G,":"-;-;6+","_A,":"-;-;6+","A,":"-;-;0","B,":"-;-;1",C:"6;-;-","^C":"-;-;2",_D:"-;-;2",D:"0;-;-",E:"1;-;-","^F":"2;-;-",_G:"2;-;-",G:"3 ;-;","^G":"-;-;6+",_A:"-;-;6+",A:"-;-;0",B:"-;-;1",c:"6;-;-","^c":"-;-;2",_d:"-;-;2",d:"-;-;3",e:"-;-;4","^f":"-;-;5",_g:"-;-;5",g:"-;-;6","^g":"-;-;6+",_a:"-;-;6+",a:"-;-;7",b:"-;-;8","c'":"6;-;-","^c'":"-;-;9","_d'":"-;-;9","d'":"-;-;10","e'":"-;-;11","^f'":"-;-;12","_g'":"-;-;12"}[e];if(!n)return"x;x;x";return n}}function o(e){var a=e.search(/[A-G]/i);if(-1==a)return r("Failed to find basename for value!"),e;var t=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals+=t,e.substr(1)):"_"==e.substr(0,1)?(n.accidentalFlats+=t,n.accidentalSharps=n.accidentalSharps.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),e):"^"==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(t,""),n.accidentalNaturals=n.accidentalNaturals.replace(t,""),n.accidentalSharps+=t,e):-1!=n.accidentalNaturals.search(t)?e:-1!=n.sharps.search(t)||-1!=n.accidentalSharps.search(t)?"^"+e:-1!=n.flats.search(t)||-1!=n.accidentalFlats.search(t)?"_"+e:e}function u(e){return e.split(/^X:.*$/gm).length-1}function _(e,a){for(var n,r=e,t=function e(a){let n=a.replace(/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|:[A-Za-z]:)[^\r\n]*\r?\n?/gm,"");return n}(e=e.trim()),s=(t=t.trim()).split("\n"),l=s.length,i=!1,c=0;c<l;++c)if(0!=(n=s[c]).indexOf("%")){i=!0;var o=t.indexOf(n);t=t.substring(o);break}if(!i)return r;var u=e.indexOf(n);return e=e.substring(0,u),e+=a,e+="\n"+t+"\n\n"}function d(e,a){return"X:"+e.split(/^X:/gm)[a+1]}return function e(a){var n=a.split(/^X:.*$/gm).length-1,r=gInjectTab_FontFamily,s=gInjectTab_TabFontSize,l=gInjectTab_MusicSpace,i=gInjectTab_StaffSep;parseInt(gInjectTab_TabLocation);var c=gInjectTab_StripChords,o=FindPreTuneHeader(a);gExcludedFromMDSolution=[];for(var u=0;u<n;++u){var _=d(a,u);if(isSectionHeader(_)){o+=_;continue}if(_=StripOrnamentsOne(_),_=StripTabOne(_),c&&(_=StripChordsOne(_)),_=t(_),_=InjectStringBelowTuneHeaderConditional(_,"%%staffsep "+i),_=InjectStringAboveTuneHeaderConditional(_,"%%annotationfont "+r+" "+s),_=InjectStringAboveTuneHeaderConditional(_,"%%musicspace "+l),gMDulcimerStripBadTunes&&-1!=_.indexOf('"_x;x;x"')){var f=getTuneTitle(_);gExcludedFromMDSolution.push(f),_=""}o+=_}return o}(e)},shapeNoteGenerator=function(e){var a="",n=null,r=null,t="Major";function s(e){}function l(e){if(s("Got input:"+e),null==(n=function e(a){t="Major";var n,l,i=null,o=a.match(/[kK]: *([A-G])([b#])? *(.*?)$/m);if(null==o||o.length<3)return null;if(n=void 0==o[2]?o[1]:o[1]+o[2],l=o[3].toLowerCase(),r=(r=n).replace("#","s"),gNonMoveableSolfege=!1,s("Got base key of '"+n+"' and extra of '"+l+"'"),""==l||-1!=l.search("maj")||-1!=l.search("ion")?(s("Mode: Ionian (major)"),t="Major",i=c(n,0)):-1!=l.search("mix")?(s("Mode: Mixolydian"),t="Major",i=c(n,1)):-1!=l.search("dor")?(s("Mode: Dorian"),t="Minor",i=c(n,2)):-1!=l.search("m")&&-1==l.search("mix")||-1!=l.search("min")||-1!=l.search("aeo")?(s("Mode: Aeolian (minor)"),t="Minor",i=c(n,3)):-1!=l.search("phr")?(s("Mode: Phrygian"),t="Major",i=c(n,4)):-1!=l.search("loc")?(s("Mode: Locrian"),t="Major",i=c(n,5)):-1!=l.search("lyd")?(s("Mode: Lydian"),t="Major",i=c(n,-1)):-1!=l.search("exp")?(s("(Accidentals to be explicitly specified)"),t="Major",i=c("C",0)):(s("Failed to determine key signature mode"),i=null),null==i)return i;var u=l.match(/_./g),_=l.match(/\^./g);for(note in u)i.flats+=u[note][1].toUpperCase();for(note in _)i.sharps+=_[note][1].toUpperCase();return i}(e)))return"ERROR: Unknown or unsupported key signature";var l=function e(a){for(var r,t,l=a,c=/^\w:.*$/mg;r=c.exec(a);)l=o(l,r.index,r[0].length);for(var u=/"[^"]*"/gm;t=u.exec(l);)for(var _=t.index,d=_+t[0].length,f=_;f<d;++f)l=l.substring(0,f)+"*"+l.substring(f+1);for(u=/\[[^\]|]*\]/g;t=u.exec(l);)for(var _=t.index,d=_+t[0].length,f=_;f<d;++f)l=l.substring(0,f)+"*"+l.substring(f+1);for(u=/^%%begintext((.|\n)*)%%endtext/gm;t=u.exec(l);)for(var _=t.index,d=_+t[0].length,f=_;f<d;++f)l=l.substring(0,f)+"*"+l.substring(f+1);for(u=/^%.*$/gm;t=u.exec(l);)for(var _=t.index,d=_+t[0].length,f=_;f<d;++f)l=l.substring(0,f)+"*"+l.substring(f+1);s("sanitized input:"+l);for(var h=/([=^_]?[a-gA-G][',]?|\|)/g,p=[];t=h.exec(l);){var v=t[1];if("|"==v)n.accidentalFlats="",n.accidentalSharps="",n.accidentalNaturals="";else{var m=$(v);s("UnNormalized="+v+" normalized="+m);var x=g(m);p.push(new i(t.index,v,m,x))}}return p}(e);return a=function e(a,n){for(var r,t=a,s=0,l=0;l<n.length;++l){var i=n[l].index+s,c=n[l].glyph;r=c;var o=n[l].normalizedValue;o.toLowerCase()==o&&-1!=c.indexOf("!style=sn_fa_l!")&&(r=r.replace("!style=sn_fa_l!","!style=sn_fa_r!"));var u=r.length;t=t.substr(0,i)+r+t.substr(i),s+=u}return t}(e,l)}var i=function(e,a,n,r){this.index=e,this.unNormalizedValue=a,this.normalizedValue=n,this.glyph=r};function c(e,a){var n="FCGDAEB",r={sharps:"",flats:""},t=n.indexOf(e[0])-1;if(-2==t)return s("Bad tonic: "+e),null;"b"==e.slice(1)?t-=7:"#"==e.slice(1)&&(t+=7);var l=t-a;return l>7?(s("Too many sharps: "+l),null):l<-7?(s("Too many flats: "+-1*l),null):(l>0?r.sharps=n.slice(0,l):l<0&&(r.flats=n.slice(l)),r.accidentalSharps="",r.accidentalFlats="",r.accidentalNaturals="",r)}function o(e,a,n){for(var r="",t=0;t<n;++t)r+="*";return e.substr(0,a)+r+e.substr(a+n)}var u={c:0,"^c":1,d:2,"^d":3,e:4,f:5,"^f":6,g:7,"^g":8,a:9,"^a":10,b:11},_={c:0,_d:1,d:2,_e:3,e:4,f:5,_g:6,g:7,_a:8,a:9,_b:10,b:11},d={0:"c",1:"^c",2:"d",3:"^d",4:"e",5:"f",6:"^f",7:"g",8:"^g",9:"a",10:"^a",11:"b"},f={0:"c",1:"_d",2:"d",3:"_e",4:"e",5:"f",6:"_g",7:"g",8:"_a",9:"a",10:"_b",11:"b"},h={C:0,Cs:1,Db:1,D:2,Ds:3,Eb:3,E:4,F:5,Fs:6,Gb:6,G:7,Gs:8,Ab:8,A:9,As:10,Bb:10,B:11};function g(e){var a,s="";return(e=function e(a,r,t){a=(a=(a=a.toLowerCase()).replaceAll(",","")).replaceAll("'","");var s=!0;""!=n.flats&&(s=!1);var l=h[r];if(s){var i=u[a];"Minor"==t&&(i-=3)<0&&(i+=12),(i-=l)<0&&(i+=12),i%=12,a=d[i]}else{var i=_[a];"Minor"==t&&(i-=3)<0&&(i+=12),(i-=l)<0&&(i+=12),i%=12,a=f[i]}return a}(e,r,t),s=(a=gIncludeShapeNoteNames?{c:'"_fa"!style=sn_fa_l!',"^c":'"_fa"!style=sn_fa_l!',_d:'"_sol"!style=sn_so!',d:'"_sol"!style=sn_so!',"^d":'"_sol"!style=sn_so!',_e:'"_la"!style=sn_la!',e:'"_la"!style=sn_la!',f:'"_fa"!style=sn_fa_l!',"^f":'"_fa"!style=sn_fa_l!',_g:'"_sol"!style=sn_so!',g:'"_sol"!style=sn_so!',"^g":'"_sol"!style=sn_so!',_a:'"_la"!style=sn_la!',a:'"_la"!style=sn_la!',"^a":'"_la"!style=sn_la!',_b:'"_mi"!style=sn_mi!',b:'"_mi"!style=sn_mi!'}:{c:"!style=sn_fa_l!","^c":"!style=sn_fa_l!",_d:"!style=sn_so!",d:"!style=sn_so!","^d":"!style=sn_so!",_e:"!style=sn_la!",e:"!style=sn_la!",f:"!style=sn_fa_l!","^f":"!style=sn_fa_l!",_g:"!style=sn_so!",g:"!style=sn_so!","^g":"!style=sn_so!",_a:"!style=sn_la!",a:"!style=sn_la!","^a":"!style=sn_la!",_b:"!style=sn_mi!",b:"!style=sn_mi!"})[e])?s:"x "}function $(e){var a=e.search(/[A-G]/i);if(-1==a)return s("Failed to find basename for value!"),e;var r=e.substr(a,1).toUpperCase();return"="==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(r,""),n.accidentalSharps=n.accidentalSharps.replace(r,""),n.accidentalNaturals+=r,e.substr(1)):"_"==e.substr(0,1)?(n.accidentalFlats+=r,n.accidentalSharps=n.accidentalSharps.replace(r,""),n.accidentalNaturals=n.accidentalNaturals.replace(r,""),e):"^"==e.substr(0,1)?(n.accidentalFlats=n.accidentalFlats.replace(r,""),n.accidentalNaturals=n.accidentalNaturals.replace(r,""),n.accidentalSharps+=r,e):-1!=n.accidentalNaturals.search(r)?e:-1!=n.sharps.search(r)||-1!=n.accidentalSharps.search(r)?"^"+e:-1!=n.flats.search(r)||-1!=n.accidentalFlats.search(r)?"_"+e:e}function p(e,a){return"X:"+e.split(/^X:/gm)[a+1]}return function e(a){var s,i=gInjectTab_FontFamily,c=gInjectTab_TabFontSize,o=gInjectTab_MusicSpace,u=gInjectTab_StaffSep;n=null,r=null,t="Major";for(var _=(s=a).split(/^X:.*$/gm).length-1,d="",f=0;f<_;++f){var h=p(a,f);h=l(h),h=InjectStringBelowTuneHeaderConditional(h,"%%staffsep "+u),h=InjectStringAboveTuneHeaderConditional(h,"%%musicspace "+o),gIncludeShapeNoteNames&&(h=InjectStringAboveTuneHeaderConditional(h,"%%annotationfont "+i+" "+c)),d+=h,d+="\n"}return d.replaceAll("\n\n","\n")}(e)};