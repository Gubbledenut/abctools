var pdf,gShowAdvancedControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,STAFFSPACEMIN=0,STAFFSPACEDEFAULT=10,STAFFSPACEMAX=200,STAFFSPACEOFFSET=40,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,gIsIOS=!1,gIsIPad=!1,gIsIPhone=!1,gIsSafari=!1,gIsChrome=!1,gIsAndroid=!1,gRenderingPDF=!1,gTheQRCode=null,MAXQRCODEURLLENGTH=2300,ALLTITLESMAXLENGTH=70,HEADERFOOTERFONTSIZE=12,QRCODECAPTIONPDFFONTSIZE=12,gShowShareControls=!1,gAllowSave=!1,gAllowURLSave=!1,gAllowQRCodeSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gCapo=0,gIsMaximized=!1,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gDisplayedName="",gShowTabNames=!0,gAllowShowTabNames=!1,gWhistleFontPrepared=!1,gIsFirstRender=!0,DEBOUNCEMS=280,AUTOSCROLLDEBOUNCEMS=250,gLastAutoScrolledTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gLocalStorageAvailable=!1,gPDFQuality=.75,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gAddTOCLinkback=!1,gAddIndexLinkback=!1,gTuneHyperlinks=[],gAddTheSessionHyperlinks=!1,gAddPlaybackHyperlinks=!1,gPlaybackHyperlinkMelodyProgram="",gPlaybackHyperlinkBassChordProgram="",gAppendXValuesToTuneNames=!1,gFullScreenScaling=50,gAngloButtonNames=[],gRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tabnumberfont:"Arial 12",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"},gMP3Bitrate=224,gTheABC=document.getElementById("abc");function findTuneOffsetByIndex(e){if(0==e)return 0;for(var t=gTheABC.value.split(/^X:/gm),n=t[0].length,o=1;o<=e;++o)n+=t[o].length+2;return n}function findTuneByOffset(e){var t=gTheABC.value.split(/^X:/gm),n=t.length,o=0;for(i=1,o=t[0].length;i<n;++i)if(e<(o+=t[i].length+2))return i-1;return n-2}function getTuneByIndex(e){return"X:"+gTheABC.value.split(/^X:/gm)[e+1]}function getSelectedText(e){var t=document.getElementById(e),n=t.selectionStart,o=t.selectionEnd;return t.value.substring(n,o)}function findSelectedTune(){var e=gTheABC.value,t=gTheABC.selectionStart;if(0==t&&(t=e.indexOf("X:")+2),0==t)return"";var n=e.length;t==n&&(t=n-1);var o=e.split(/^X:/gm),a=o.length,r=0;for(i=1,r=o[0].length;i<a;++i)if(t<(r+=o[i].length+2)){var l="X:"+o[i];return l.trimEnd()}return""}function GetFirstTuneTitle(){var e="",t=gTheABC.value,n=(t=escape(t)).split("%0A");for(i=0;i<n.length;++i){n[i]=unescape(n[i]);var o=n[i].split("");if("T"==o[0]&&":"==o[1]){e=(e=(e=(e=(e=n[i].slice(2)).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\'/g,"_");break}}return e}function CountTunes(){var e=gTheABC.value.split(/^X:.*$/gm).length-1;return gTotalTunes=e,e}function GetAllTuneTitles(){var e=[],t=escape(gTheABC.value),n=t.split("%0D%0A");for(i=0,n=t.split("%0A");i<n.length;++i){n[i]=unescape(n[i]);var o=n[i].split("");if("T"==o[0]&&":"==o[1]){var a=n[i].slice(2);a=a.trim(),e.push(a)}}var r=e.length,l="";if(r>0)for(i=0;i<r;++i){if((l+=e[i]).length>ALLTITLESMAXLENGTH){var s=r-i-1;s>0&&(l=l+" + "+s+" more");break}i!=r-1&&(l+=" / ")}return l}function getTuneRangeForTranspose(){var e=gTheABC.value,t=gTheABC,n=t.selectionStart;0==n&&(n=e.indexOf("X:")+2);var o=t.selectionEnd;0==o&&(o=e.indexOf("X:")+2);var a=findTuneByOffset(n),r=findTuneByOffset(o);return{start:a,end:r}}function resetSelectionAfterTranspose(e,t){var n=findTuneOffsetByIndex(e),o=getTuneByIndex(t),a=findTuneOffsetByIndex(t)+(o.length-1);gTheABC.selectionStart=n,gTheABC.selectionEnd=a,gIsIOS||gIsAndroid?gTheABC.blur():gTheABC.focus()}function Transpose(e){if(!gRenderingPDF){var t=CountTunes(),n=getTuneRangeForTranspose();document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){for(var o,a=gTheABC.value,r=GetABCJSParams(),l=a.split(/^X:/gm),s=[],g=0;g<t;++g)o="notation"+g,s.push(o),document.getElementById(o).style.opacity=0;for(var d="",g=1;g<=t;++g){l[g]="X:"+l[g];var c=null;if(g-1>=n.start&&g-1<=n.end)try{c=ABCJS.renderAbc(s[g-1],l[g],r),d+=ABCJS.strTranspose(l[g],c,e)}catch(u){DayPilot.Modal.alert("Unable to tranpose one or more tunes.",{theme:"modal_flat",top:50,scrollWithPage:!1}),d+=l[g]}else d+=l[g]}gTheABC.value=d,resetSelectionAfterTranspose(n.start,n.end),RenderAsync(!0,null,function(){setTimeout(function(){for(var e=0;e<t;++e)document.getElementById(o).style.opacity=1},100)})},100)}}function TransposeUp(e){var t=1;e.shiftKey&&(t=2),e.altKey&&(t=12),Transpose(t)}function TransposeDown(e){var t=-1;e.shiftKey&&(t=-2),e.altKey&&(t=-12),Transpose(t)}function SortTunes(e){var t,n,o=gTheABC.value,a=o.split(/(^X:.*$)/gm),r=(a.length-1)/2;if(!(r<2)){var l=a[0];totalTunes=r;var s=GetTunebookIndexTitles(),g=[],d=0;for(t=0;t<r;++t)void 0!=a[2*t+1]&&(0==(n=s[d]).indexOf("The ")&&(n=n.substring(4,n.length)+", The"),e&&(0==n.indexOf("An ")&&(n=n.substring(3,n.length)+", An"),0==n.indexOf("A ")&&(n=n.substring(2,n.length)+", A")),d++,g.push({title:n,tune:a[2*t+1]+a[2*t+2]}));for(g.sort((e,t)=>{let n=e.title.toUpperCase(),o=t.title.toUpperCase();return n<o?-1:n>o?1:0}),o="",o+=l,t=0;t<d;++t)o+=g[t].tune;gTheABC.value=o,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}function SortABC(e){if(!gRenderingPDF){var t=!1;e.shiftKey&&(t=!0),document.getElementById("sortbutton").value="  Sorting  ",setTimeout(function(){SortTunes(t),document.getElementById("sortbutton").value="Rendering",RenderAsync(!0,null,function(){document.getElementById("sortbutton").value="  Sorted!  ",setTimeout(function(){document.getElementById("sortbutton").value="Sort ABC"},1500)})},750)}}function Clear(){!gRenderingPDF&&DayPilot.Modal.confirm("Are you sure you want to erase all the ABC and start over?",{top:100,theme:"modal_flat",scrollWithPage:!1}).then(function(e){e.canceled||(ClearNoRender(),RenderAsync(!0,null),gTheABC.focus())})}function ClearNoRender(){gTheABC.value="",gDisplayedName="No ABC file selected",gABCFromFile=!1,RestoreDefaults()}var PAGENUMBERTOP=296,PAGENUMBERTOPA4=313,PAGETOPOFFSET=32,PAGEBOTTOMOFFSET=32,PAGELEFTOFFSET=37,PAGELEFTOFFSETA4=29,PAGEHEIGHTLETTER=792,PAGEHEIGHTA4=842,BETWEENTUNESPACE=20,gBetweenTuneSpace=20,running_height=PAGETOPOFFSET,column_number=0,theCurrentPageNumber=1,isFirstPage=!0,tunesProcessed=0,totalTunes=0,thePageHeader="",thePageFooter="",thePageHeaderURL="",thePageFooterURL="",theRenderTime="",theHeaderFooterTuneNames="",thePageNumberVerticalOffset=0,gQRCodeRequested=!1,gQRCodeURLOverride="",gDoForceQRCodeURLOverride=!1,gQRCodeCaptionOverride="",gDoForceQRCodeCaptionOverride=!1,TunebookIndexRequested=!1,theTunebookIndexTitle="",TunebookSortedIndexRequested=!1,theTunebookSortedIndexTitle="",TunebookIndexHeaderRequested=!1,theTunebookIndexHeader="",TunebookTOCRequested=!1,theTunebookTOCTitle="",TunebookSortedTOCRequested=!1,theTunebookSortedTOCTitle="",TunebookTOCHeaderRequested=!1,theTunebookTOCHeader="",TunebookTPRequested=!1,theTunebookTP="",theTunebookTPURL="",TunebookTPSTRequested=!1,theTunebookTPST="",theTunebookTPSTURL="",theTunePageMap=[],PDFJPGQUALITY=.8,PDFSCALEFACTOR=1.55,theOffscreen=null,gPDFCancelRequested=!1,gPDFTabselected="noten";function GetTunebookIndexTitles(){var e,t=[];for(e=0;e<totalTunes;++e){var n=getTuneByIndex(e),o=escape(n),a=o.split("%0D%0A");for(j=0,a=o.split("%0A");j<a.length;++j){a[j]=unescape(a[j]);var r=a[j].split("");if("T"==r[0]&&":"==r[1]){titel=(titel=a[j].slice(2)).trim(),gAppendXValuesToTuneNames&&(titel=e+1+" - "+titel),t.push(titel);break}}}return t}var TPTITLESIZE=24,TPSTTITLESIZE=16,TPTOPOFFSET=435,TPSTOFFSET=24;function AppendTuneTitlePage(e,t,n,o){var a=0;if("a4"==t&&(a=20),e.setPage(1),""!=n){if(e.setFont("Times","","normal"),e.setFontSize(TPTITLESIZE),theTunebookTPURL&&""!=theTunebookTPURL){var r=e.getTextWidth(n);e.textWithLink(n,e.internal.pageSize.getWidth()/3.1-r/2,TPTOPOFFSET+a,{align:"center",url:theTunebookTPURL})}else e.text(n,e.internal.pageSize.getWidth()/3.1,TPTOPOFFSET+a,{align:"center"})}if(""!=o){if(e.setFont("Times","","normal"),e.setFontSize(TPSTTITLESIZE),theTunebookTPSTURL&&""!=theTunebookTPSTURL){var r=e.getTextWidth(o);e.textWithLink(o,e.internal.pageSize.getWidth()/3.1-r/2,TPTOPOFFSET+TPSTOFFSET+a,{align:"center",url:theTunebookTPSTURL})}else e.text(o,e.internal.pageSize.getWidth()/3.1,TPTOPOFFSET+TPSTOFFSET+a,{align:"center"})}}var TEXTINCIPITTOPOFFSET=330,TEXTINCIPITBOTTOMOFFSET=12,TEXTINCIPITLEFTMARGIN=65,TEXTINCIPITRIGHTMARGIN=190,TEXTINCIPITFONTSIZE=12,TEXTINCIPITLINESPACING=10;function GenerateTextIncipits(e,t,n,o,a,r,l){TEXTINCIPITLEFTMARGIN=65,TEXTINCIPITRIGHTMARGIN=190;var s=0;"a4"==a&&(TEXTINCIPITLEFTMARGIN=61,TEXTINCIPITRIGHTMARGIN=186,s=20);var g=e.internal.pageSize.getHeight(),d=e.internal.pageSize.getWidth()/1.55,c=g-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),u=TEXTINCIPITTOPOFFSET+s,A=GetTunebookIndexTitles();e.setFont("Times","","normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var p=[];for(m=0;m<totalTunes;++m){for(h=0,T=getTuneByIndex(m),T=StripChordsOne(T=StripTextAnnotationsOne(T=StripAnnotationsOne(T))),C=/^M:.*[\r\n]*/gm,E=(M=(T=escape(T=T.replace(C,""))).split("%0A")).length,R="";h<E&&-1==(R=unescape(M[h])).indexOf("K:");++h);for(h=0,R=(R=(R=(R=(R=(R=(R=(R=(R=(R=(R=R.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");h<E&&-1==(f=unescape(M[h])).indexOf("|");++h);for(h=0,I=(f=(f=f.replace(":","")).replace("[","")).split("|"),b=[],v=I.length;h<v;++h)""!=I[h]&&b.push(I[h]);for((v=b.length)>3&&(v=3),B="",h=0;h<v;++h)B+=b[h],h!=v-1&&(B+=" | ");0==(f=B).indexOf(" | ")&&(f=f.substring(3,f.length)),(S=A[m]).length>29?(S=(S=S.substring(0,29)).trim(),S+="..."):S=S.trim(),l&&0==S.indexOf("The ")&&(S=S.substring(4,S.length)+", The"),""!=R&&(S+=" ("+R+")"),p.push({title:S,incipit:f})}if(l){var m,h,T,f,I,b,C,M,E,v,B,S,R,F=[];for(m=0;m<totalTunes;++m)F.push({title:p[m].title,incipit:p[m].incipit});for(F.sort((e,t)=>{var n=e.title.toUpperCase(),o=t.title.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),m=0;m<totalTunes;++m)p[m].title=F[m].title,p[m].incipit=F[m].incipit}for(m=0;m<totalTunes;++m)S=p[m].title,f=p[m].incipit,r.push(theCurrentPageNumber),e.text(S,TEXTINCIPITLEFTMARGIN,u,{align:"left"}),e.text(f,d-TEXTINCIPITRIGHTMARGIN,u,{align:"left"}),u+=TEXTINCIPITLINESPACING,m!=totalTunes-1&&u>c&&(theCurrentPageNumber++,e.addPage(a),e.setFont("Times","","normal"),e.setFontSize(TEXTINCIPITFONTSIZE),u=TEXTINCIPITTOPOFFSET+s);return r}var INDEXTOPOFFSET=330,INDEXBOTTOMOFFSET=16,INDEXTITLEOFFSET=35,INDEXLEFTMARGIN=90,INDEXRIGHTMARGIN=105,INDEXTITLESIZE=18,INDEXFONTSIZE=13,INDEXLINESPACING=12;function AppendTunebookIndex(e,t,n,o,a,r,l,s,g,d){var c=0;"a4"==o&&(c=20),e.addPage(o),TunebookIndexHeaderRequested&&AddPageTextHeader(e,o,theTunebookIndexHeader),e.setFont("Times","","normal"),e.setFontSize(INDEXTITLESIZE),""!=r&&e.text(r,e.internal.pageSize.getWidth()/3.1,INDEXTOPOFFSET+c,{align:"center"});var u=GetTunebookIndexTitles(),A=pdf.internal.pageSize.getHeight(),p=pdf.internal.pageSize.getWidth()/1.55,m=A-(PAGETOPOFFSET+INDEXBOTTOMOFFSET),h=INDEXTOPOFFSET+INDEXTITLEOFFSET+c;e.setFont("Times","","normal"),e.setFontSize(INDEXFONTSIZE);var T=[];for(f=0;f<totalTunes;++f)T.push(a[f]);if(l){for(f=0;f<totalTunes;++f)0==(b=u[f]).indexOf("The ")&&(b=b.substring(4,b.length)+", The",u[f]=b);var f,I,b,C=[];for(f=0;f<totalTunes;++f)C.push({name:u[f],pageNumber:T[f]});for(C.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),f=0;f<totalTunes;++f)u[f]=C[f].name,s||(T[f]=C[f].pageNumber)}for(f=0;f<totalTunes;++f){var M=I=T[f];g&&(M+=d),g?e.textWithLink(u[f],INDEXLEFTMARGIN,h,{align:"left",pageNumber:M}):e.text(u[f],INDEXLEFTMARGIN,h,{align:"left"}),g?e.textWithLink(""+I,p-INDEXRIGHTMARGIN,h,{align:"left",pageNumber:M}):e.text(""+I,p-INDEXRIGHTMARGIN,h,{align:"left"}),h+=INDEXLINESPACING,f!=totalTunes-1&&h>m&&(theCurrentPageNumber++,e.addPage(o),TunebookIndexHeaderRequested&&AddPageTextHeader(e,o,theTunebookIndexHeader),e.setFont("Times","","normal"),e.setFontSize(INDEXFONTSIZE),h=INDEXTOPOFFSET+INDEXTITLEOFFSET+c)}theCurrentPageNumber++}function PostProcessHeadersAndFooters(e,t,n,o,a,r,l){for(var s=n;s<n+o;++s)e.setPage(s),AddPageHeaderFooter(e,t,s-n+1,a,r,l)}function GetAllTuneHyperlinks(e){var t,n=CountTunes();if(t=GetTunebookIndexTitles(),n!=e.length)return!1;for(i=0;i<n;++i){var o=getTuneByIndex(i),a="";if(gAddPlaybackHyperlinks){var r=o,l=/^X:.*[\r\n]*/gm;r=r.replace(l,"");var l=/^X:.*[\r\n]*/gm;r="X:1\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkBassChordProgram+"\n"+(r=r.replace(l,""));var s=FillUrlBoxWithAbcInLZW(r,!1);s+="&play=1",e[i].url=s}else gAddTheSessionHyperlinks&&(e[i].url="https://thesession.org/tunes/search?q="+encodeURIComponent(t[i]));var l=/^%add_link_to_thesession.*$/m,g=o.match(l);g&&g.length>0&&(e[i].url="https://thesession.org/tunes/search?q="+encodeURIComponent(t[i])),l=/^%add_playback_link.*$/m;var d=o.match(l);if(d&&d.length>0){var r=o,c=d[0].replace("%add_playback_link","").match(/\b(\w+)\b/g),u=gTheMelodyProgram,A=gTheChordProgram;gAddPlaybackHyperlinks&&(u=gPlaybackHyperlinkMelodyProgram,A=gPlaybackHyperlinkBassChordProgram),c&&c.length>0&&(c.length>=1&&(u=(u=c[0]).trim()),c.length>1&&(A=(A=c[1]).trim()));var l=/^X:.*[\r\n]*/gm;r="X:1\n%%MIDI program "+u+"\n%%MIDI chordprog "+A+"\n"+(r=r.replace(l,""));var s=FillUrlBoxWithAbcInLZW(r,!1);s+="&play=1",e[i].url=s}l=/^%hyperlink.*$/m;var p=o.match(l);p&&p.length>0&&(a=(a=p[0].replace("%hyperlink","")).trim(),e[i].url=a)}return!0}function PostProcessTuneHyperlinks(e,t,n,o){if(t){if(GetAllTuneHyperlinks(t)){e.internal.pageSize.getWidth(),e.internal.pageSize.getHeight(),e.setFont("Verdana","","normal"),e.setFontSize(18);for(var a=t.length,r=-1,l=0;l<a;++l){var s=t[l];if(""!=s.url){var g=s.page;g!=r&&(e.setPage(g+o-1),r=g);var d={left:s.x,top:s.y,width:s.width,height:s.height};d=pageRect2LinkRect(e,d,n),e.link(d.left,d.top,d.width,d.height,{url:s.url})}}}}}function PostProcessTOCAndIndexLinks(e,t,n,o,a,r,l){for(var s=t;s<=n;++s){e.setPage(s),e.setFont("Verdana","","normal"),e.setFontSize(18);var g=e.internal.pageSize.getWidth(),d=e.internal.pageSize.getHeight();if(o&&e.textWithLink("<<",5,d/1.55,{align:"left",pageNumber:a}),r){var c=e.getTextWidth(">>");e.textWithLink(">>",g/1.55-(c+5),d/1.55,{align:"left",pageNumber:l})}}}function AddPageTextHeader(e,t,n){var o=PAGENUMBERTOP;o="letter"==t?PAGENUMBERTOP:PAGENUMBERTOPA4,e.setFont("Times","","normal"),e.setFontSize(HEADERFOOTERFONTSIZE),e.text(n,e.internal.pageSize.getWidth()/3.1,o,{align:"center"})}var TOCTOPOFFSET=330,TOCBOTTOMOFFSET=16,TOCTITLEOFFSET=35,TOCLEFTMARGIN=90,TOCRIGHTMARGIN=105,TOCTITLESIZE=18,TOCFONTSIZE=13,TOCLINESPACING=12;function AppendTuneTOC(e,t,n,o,a,r,l,s,g,d,c){var u=c,A=0;"a4"==o&&(A=20),e.setPage(u),TunebookTOCHeaderRequested&&AddPageTextHeader(e,o,theTunebookTOCHeader),e.setFont("Times","","normal"),e.setFontSize(TOCTITLESIZE),""!=r&&e.text(r,e.internal.pageSize.getWidth()/3.1,TOCTOPOFFSET+A,{align:"center"});var p=GetTunebookIndexTitles(),m=pdf.internal.pageSize.getHeight(),h=pdf.internal.pageSize.getWidth()/1.55,T=m-(PAGETOPOFFSET+TOCBOTTOMOFFSET),f=TOCTOPOFFSET+TOCTITLEOFFSET+A;e.setFont("Times","","normal"),e.setFontSize(TOCFONTSIZE);var I=[];for(b=0;b<totalTunes;++b)I.push(a[b]);if(l){for(b=0;b<totalTunes;++b)0==(M=p[b]).indexOf("The ")&&(M=M.substring(4,M.length)+", The",p[b]=M);var b,C,M,E=[];for(b=0;b<totalTunes;++b)E.push({name:p[b],pageNumber:I[b]});for(E.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),b=0;b<totalTunes;++b)p[b]=E[b].name,s||(I[b]=E[b].pageNumber)}for(b=0;b<totalTunes;++b)C=I[b],g?e.textWithLink(p[b],TOCLEFTMARGIN,f,{align:"left",pageNumber:C+d}):e.text(p[b],TOCLEFTMARGIN,f,{align:"left"}),g?e.textWithLink(""+C,h-TOCRIGHTMARGIN,f,{align:"left",pageNumber:C+d}):e.text(""+C,h-TOCRIGHTMARGIN,f,{align:"left"}),f+=TOCLINESPACING,b!=totalTunes-1&&f>T&&(u++,e.setPage(u),TunebookTOCHeaderRequested&&AddPageTextHeader(e,o,theTunebookTOCHeader),e.setFont("Times","","normal"),e.setFontSize(TOCFONTSIZE),f=TOCTOPOFFSET+TOCTITLEOFFSET+A)}function DryRunAddTuneTOC(e,t,n,o,a,r,l,s){var g=0;"a4"==o&&(g=20),e.addPage(o);var d=GetTunebookIndexTitles(),c=pdf.internal.pageSize.getHeight();pdf.internal.pageSize.getWidth();var u=c-(PAGETOPOFFSET+TOCBOTTOMOFFSET),A=TOCTOPOFFSET+TOCTITLEOFFSET+g,p=[];for(m=0;m<totalTunes;++m)p.push(a[m]);if(l){for(m=0;m<totalTunes;++m)0==(h=d[m]).indexOf("The ")&&(h=h.substring(4,h.length)+", The",d[m]=h);var m,h,T=[];for(m=0;m<totalTunes;++m)T.push({name:d[m],pageNumber:p[m]});for(T.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),m=0;m<totalTunes;++m)d[m]=T[m].name,s||(p[m]=T[m].pageNumber)}for(m=0;m<totalTunes;++m)A+=TOCLINESPACING,m!=totalTunes-1&&A>u&&(theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1),A=TOCTOPOFFSET+TOCTITLEOFFSET+g,e.addPage(o));theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1)}function pageRect2LinkRect(e,t,n){var o=26;return"a4"==n&&(o=27),t.left=t.left/1.55,t.top=e.internal.pageSize.getHeight()/3.1+o+t.top/1.55,t.width=t.width/1.55,t.height=t.height/1.55,t}function pageVOffset2LinkVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),e.internal.pageSize.getHeight()/3.1+o+t/1.55}function linkVOffset2PageVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),t-=e.internal.pageSize.getHeight()/3.1+o,t*=1.55}function AppendQRCode(e,t,n){var o;if(gDoForceQRCodeURLOverride)o=gQRCodeURLOverride;else if(o=FillUrlBoxWithAbcInLZW(null,!1),!gAllowQRCodeSave){n(!1);return}null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:o,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(o)),setTimeout(function(){var a=document.querySelectorAll('div[id="qrcode"] > img');if(a&&a[0]){e.addPage(t);var r=e.internal.pageSize.getWidth()/3.1-18,l=(a=a[0]).src;e.addImage(l,"PNG",r,150,256,256);var s={left:r,top:150,width:256,height:256};s=pageRect2LinkRect(e,s,t),e.link(s.left,s.top,s.width,s.height,{url:o}),e.setFont("Times","","normal"),e.setFontSize(QRCODECAPTIONPDFFONTSIZE);var g=558;"a4"==t&&(g=575);var d=theHeaderFooterTuneNames;gDoForceQRCodeCaptionOverride&&(d=gQRCodeCaptionOverride);var c=e.internal.pageSize.getWidth(),u=e.getTextWidth(d);e.textWithLink(d,c/3.1-u/2,g,{align:"left",url:o}),gTheQRCode.clear(),n(!0)}else gTheQRCode.clear(),n(!1)},1e3)}function getDescriptiveFileName(e,t){var n="";if(gABCFromFile?n=(n=(n=(n=(n=gDisplayedName).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\..+$/,""):(n=GetFirstTuneTitle(),e>1&&(n+="_Set")),t){var o=GetRadioValue("notenodertab"),a="";switch(o){case"noten":a="";break;case"notenames":a="_Note_Names";break;case"mandolin":a="_Mandolin";break;case"gdad":a="_GDAD";break;case"mandola":a="_Mandola";break;case"guitare":a="_Guitar";break;case"guitard":a="_DADGAD";break;case"bass":a="_Bass";break;case"whistle":a="_Whistle"}switch(n+=a,a="",o){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":case"bass":gCapo>0&&(a="_Capo_"+gCapo)}n+=a}return n}function ProcessTunesForContinuousLayout(e,t,n){var o=e.length;if(o<=1)return e;var a=[];for(r=0;r<o;++r){g=(s=document.getElementById("notation"+r)).offsetHeight/PDFSCALEFACTOR;var r,l,s,g,d,c,u=[],A=s.children,p=A.length,m=1;n&&(p>2&&(p=2),m=2);var h=0;for(l=0;l<p;++l)d=(c=A.item(l)).offsetHeight/PDFSCALEFACTOR,u.push(d/=m),h+=d;n&&(g=h);var T={theElement:s,height:g,staffHeights:u};a.push(T)}var f=t-(PAGETOPOFFSET+PAGEBOTTOMOFFSET),I=f,b=!0;for(r=0;r<o;++r)if(!e[r]){var C=a[r].height+a[r].staffHeights.length/m;if(C>I){if(0!=r&&(e[r-1]=!0),I=f,C>f){var C,M,E,v=a[r].staffHeights.length;for(l=0;l<v;++l)(M=I-(E=a[r].staffHeights[l]+1))<0&&(I=f),I-=E;I-=BETWEENTUNESPACE/m,b=!1}else I=f,I-=C,I-=BETWEENTUNESPACE/m,b=!0}else b&&(b=!1),I-=C,I-=BETWEENTUNESPACE/m}return e}function scanTunesForPageBreaks(e,t,n){var o=PAGEHEIGHTLETTER;"a4"==t&&(o=PAGEHEIGHTA4);var a=[],r=gTheABC.value.split(/^X:.*$/gm),l=r.length-1;if(0==l)return a;if(n)for(var s=1;s<=l;++s)a.push(!1);else for(var s=1;s<=l;++s)-1!=r[s].indexOf("%%newpage")?a.push(!0):a.push(!1);return ProcessTunesForContinuousLayout(a,o,n)}function formatDate(e){var t=new Date,n=""+(t.getMonth()+1),o=""+t.getDate(),a=t.getFullYear();return(n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),0==e)?[n,o,a].join("-"):[a,n,o].join("-")}function formatTime(){if(""!=theRenderTime)return theRenderTime;var e=new Date,t=e.getHours(),n=e.getMinutes(),o=" AM";0==t&&(t=12),t>12&&(t-=12,o=" PM"),t=""+t,(n=""+n).length<2&&(n="0"+n);var a=[t,n].join(":");return a+=o,theRenderTime=a,a}function ParseCommentCommands(e){thePageHeader="",thePageFooter="";var t=/^%pageheader.*$/m,n=e.match(t);n&&n.length>0&&(thePageHeader=(thePageHeader=n[0].replace("%pageheader","")).trim()),t=/^%pagefooter.*$/m;var o=e.match(t);o&&o.length>0&&(thePageFooter=(thePageFooter=o[0].replace("%pagefooter","")).trim()),gQRCodeRequested=!1,gDoForceQRCodeURLOverride=!1,gQRCodeURLOverride="",t=/^%qrcode.*$/m;var a=e.match(t);a&&a.length>0&&(gQRCodeRequested=!0,""!=(gQRCodeURLOverride=(gQRCodeURLOverride=a[0].replace("%qrcode","")).trim())&&(gDoForceQRCodeURLOverride=!0)),gDoForceQRCodeCaptionOverride=!1,gQRCodeCaptionOverride="",t=/^%caption_for_qrcode.*$/m;var r=e.match(t);r&&r.length>0&&""!=(gQRCodeCaptionOverride=(gQRCodeCaptionOverride=r[0].replace("%caption_for_qrcode","")).trim())&&(gDoForceQRCodeCaptionOverride=!0),theTunebookIndexTitle="",TunebookIndexRequested=!1,t=/^%addindex.*$/m;var l=e.match(t);l&&l.length>0&&(TunebookIndexRequested=!0,theTunebookIndexTitle=(theTunebookIndexTitle=l[0].replace("%addindex","")).trim()),theTunebookSortedIndexTitle="",TunebookSortedIndexRequested=!1,t=/^%addsortedindex.*$/m;var s=e.match(t);s&&s.length>0&&(TunebookSortedIndexRequested=!0,theTunebookSortedIndexTitle=(theTunebookSortedIndexTitle=s[0].replace("%addsortedindex","")).trim()),theTunebookTOCTitle="",TunebookTOCRequested=!1,t=/^%addtoc.*$/m;var g=e.match(t);g&&g.length>0&&(TunebookTOCRequested=!0,theTunebookTOCTitle=(theTunebookTOCTitle=g[0].replace("%addtoc","")).trim()),theTunebookSortedTOCTitle="",TunebookSortedTOCRequested=!1,t=/^%addsortedtoc.*$/m;var d=e.match(t);d&&d.length>0&&(TunebookSortedTOCRequested=!0,theTunebookSortedTOCTitle=(theTunebookSortedTOCTitle=d[0].replace("%addsortedtoc","")).trim()),theTunebookTP="",TunebookTPRequested=!1,t=/^%addtitle.*$/m;var c=e.match(t);c&&c.length>0&&(TunebookTPRequested=!0,theTunebookTP=(theTunebookTP=c[0].replace("%addtitle","")).trim()),theTunebookTPST="",TunebookTPSTRequested=!1,t=/^%addsubtitle.*$/m;var u=e.match(t);u&&u.length>0&&(TunebookTPSTRequested=!0,theTunebookTPST=(theTunebookTPST=u[0].replace("%addsubtitle","")).trim()),INDEXFONTSIZE=13,t=/^%indexfontsize.*$/m;var A=e.match(t);if(A&&A.length>0){var p=A[0].replace("%indexfontsize",""),m=parseInt(p=p.trim());!isNaN(m)&&m>0&&(INDEXFONTSIZE=m)}INDEXLINESPACING=12,t=/^%indexlinespacing.*$/m;var h=e.match(t);if(h&&h.length>0){var T=h[0].replace("%indexlinespacing",""),f=parseInt(T=T.trim());!isNaN(f)&&f>=0&&(INDEXLINESPACING=f)}INDEXTITLESIZE=18,t=/^%indextitlefontsize.*$/m;var I=e.match(t);if(I&&I.length>0){var p=I[0].replace("%indextitlefontsize",""),m=parseInt(p=p.trim());!isNaN(m)&&m>0&&(INDEXTITLESIZE=m)}INDEXTITLEOFFSET=35,t=/^%indextitleoffset.*$/m;var b=e.match(t);if(b&&b.length>0){var C=b[0].replace("%indextitleoffset",""),M=parseInt(C=C.trim());!isNaN(M)&&M>=0&&(INDEXTITLEOFFSET=M)}INDEXTOPOFFSET=330,t=/^%indextopoffset.*$/m;var E=e.match(t);if(E&&E.length>0){var v=E[0].replace("%indextopoffset",""),B=parseInt(v=v.trim());!isNaN(B)&&B>=0&&(INDEXTOPOFFSET=B+300)}TOCFONTSIZE=13,t=/^%tocfontsize.*$/m;var S=e.match(t);if(S&&S.length>0){var p=S[0].replace("%tocfontsize",""),m=parseInt(p=p.trim());!isNaN(m)&&m>0&&(TOCFONTSIZE=m)}TOCLINESPACING=12,t=/^%toclinespacing.*$/m;var R=e.match(t);if(R&&R.length>0){var T=R[0].replace("%toclinespacing",""),f=parseInt(T=T.trim());!isNaN(f)&&f>=0&&(TOCLINESPACING=f)}TOCTITLESIZE=18,t=/^%toctitlefontsize.*$/m;var F=e.match(t);if(F&&F.length>0){var p=F[0].replace("%toctitlefontsize",""),m=parseInt(p=p.trim());!isNaN(m)&&m>0&&(TOCTITLESIZE=m)}TOCTITLEOFFSET=35,t=/^%toctitleoffset.*$/m;var _=e.match(t);if(_&&_.length>0){var C=_[0].replace("%toctitleoffset",""),M=parseInt(C=C.trim());!isNaN(M)&&M>=0&&(TOCTITLEOFFSET=M)}TOCTOPOFFSET=330,t=/^%toctopoffset.*$/m;var L=e.match(t);if(L&&L.length>0){var v=L[0].replace("%toctopoffset",""),B=parseInt(v=v.trim());!isNaN(B)&&B>=0&&(TOCTOPOFFSET=B+300)}gPDFQuality=.75,t=/^%pdfquality.*$/m;var P=e.match(t);if(P&&P.length>0){var N=P[0].replace("%pdfquality",""),w=parseFloat(N=N.trim());!isNaN(w)&&w>=0&&(gPDFQuality=w)}gIncludePageLinks=!0,t=/^%no_toc_or_index_links.*$/m;var H=e.match(t);H&&H.length>0&&(gIncludePageLinks=!1),gForcePDFFilename="",gDoForcePDFFilename=!1,t=/^%pdfname.*$/m;var D=e.match(t);D&&D.length>0&&(gDoForcePDFFilename=!0,""==(gForcePDFFilename=(gForcePDFFilename=D[0].replace("%pdfname","")).trim())&&(gDoForcePDFFilename=!1)),thePageHeaderURL="",thePageFooterURL="",t=/^%urlpageheader.*$/m;var k=e.match(t);if(k&&k.length>0){var O=k[0].replace("%urlpageheader ",""),z=(O=O.trim()).split(" ");z.length>1&&(thePageHeaderURL=z[0],thePageHeader=(thePageHeader=O.replace(thePageHeaderURL,"")).trim())}t=/^%urlpagefooter.*$/m;var U=e.match(t);if(U&&U.length>0){var G=U[0].replace("%urlpagefooter ",""),z=(G=G.trim()).split(" ");z.length>1&&(thePageFooterURL=z[0],thePageFooter=(thePageFooter=G.replace(thePageFooterURL,"")).trim())}theTunebookTPURL="",theTunebookTPSTURL="",t=/^%urladdtitle.*$/m;var Y=e.match(t);if(Y&&Y.length>0){var Q=Y[0].replace("%urladdtitle ","");theTunebookTP=Q.trim();var z=Q.split(" ");z.length>1&&(theTunebookTPURL=z[0],theTunebookTP=(theTunebookTP=Q.replace(theTunebookTPURL,"")).trim(),TunebookTPRequested=!0)}t=/^%urladdsubtitle.*$/m;var W=e.match(t);if(W&&W.length>0){var V=W[0].replace("%urladdsubtitle ","");theTunebookTPST=V.trim();var z=V.split(" ");z.length>1&&(theTunebookTPSTURL=z[0],theTunebookTPST=(theTunebookTPST=V.replace(theTunebookTPSTURL,"")).trim(),TunebookTPSTRequested=!0)}gAddTOCLinkback=!1,t=/^%addlinkbacktotoc.*$/m;var J=e.match(t);J&&J.length>0&&(gAddTOCLinkback=!0),gAddIndexLinkback=!1,t=/^%addlinkbacktoindex.*$/m;var X=e.match(t);X&&X.length>0&&(gAddIndexLinkback=!0),gAddTheSessionHyperlinks=!1,t=/^%add_all_links_to_thesession.*$/m;var q=e.match(t);q&&q.length>0&&(gAddTheSessionHyperlinks=!0),t=/^%addlinkstothesession.*$/m,(q=e.match(t))&&q.length>0&&(gAddTheSessionHyperlinks=!0),gAddPlaybackHyperlinks=!1,t=/^%add_all_playback_links.*$/m;var Z=e.match(t);if(Z&&Z.length>0){gAddPlaybackHyperlinks=!0;var K=Z[0].replace("%add_all_playback_links",""),ee=(K=K.trim()).match(/\b(\w+)\b/g);gPlaybackHyperlinkMelodyProgram=gTheMelodyProgram,gPlaybackHyperlinkBassChordProgram=gTheChordProgram,ee&&ee.length>0&&(ee.length>=1&&(gPlaybackHyperlinkMelodyProgram=(gPlaybackHyperlinkMelodyProgram=ee[0]).trim()),ee.length>1&&(gPlaybackHyperlinkBassChordProgram=(gPlaybackHyperlinkBassChordProgram=ee[1]).trim()))}gAppendXValuesToTuneNames=!1,t=/^%append_x_values_to_names.*$/m;var et=e.match(t);et&&et.length>0&&(gAppendXValuesToTuneNames=!0),theTunebookTOCHeader="",TunebookTOCHeaderRequested=!1,t=/^%tocheader.*$/m;var en=e.match(t);en&&en.length>0&&(TunebookTOCHeaderRequested=!0,theTunebookTOCHeader=(theTunebookTOCHeader=en[0].replace("%tocheader","")).trim()),theTunebookIndexHeader="",TunebookTOCIndexHeaderRequested=!1,t=/^%indexheader.*$/m;var eo=e.match(t);eo&&eo.length>0&&(TunebookIndexHeaderRequested=!0,theTunebookIndexHeader=(theTunebookIndexHeader=eo[0].replace("%indexheader","")).trim()),t=/^%pdf_between_tune_space.*$/m,gBetweenTuneSpace=20;var ea=e.match(t);if(ea&&ea.length>0){var ea=ea[0].replace("%pdf_between_tune_space",""),ei=parseInt(ea=ea.trim());!isNaN(ei)&&ei>=0&&(gBetweenTuneSpace=ei)}}function ProcessHeaderFooter(e,t,n){var o=getDescriptiveFileName(n,!0);if(gDoForcePDFFilename){var a=o;""==(o=(o=(o=gForcePDFFilename).trim()).replace(".pdf",""))&&(o=a)}var r=e.replace("$PDFNAME",o+".pdf");r=(r=(r=r.replace("$PAGENUMBER",t)).replace("$TUNECOUNT",totalTunes)).replace("$TUNENAMES",theHeaderFooterTuneNames);var l=formatDate(0),s=formatDate(1);r=(r=r.replace("$DATEMDY",l)).replace("$DATEYMD",s);var g=formatTime();return r.replace("$TIME",g)}function calcPageNumberVerticalOffset(e){thePageNumberVerticalOffset=e.internal.pageSize.getHeight()-9}function AddPageHeaderFooter(e,t,n,o,a,r){var l=PAGENUMBERTOP;l="letter"==r?PAGENUMBERTOP:PAGENUMBERTOPA4,e.setFont("Times","","normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var s=!1;if(thePageHeader&&""!=thePageHeader){var g=ProcessHeaderFooter(thePageHeader,n,totalTunes);if(thePageHeaderURL&&""!=thePageHeaderURL){var d=e.getTextWidth(g);e.textWithLink(g,e.internal.pageSize.getWidth()/3.1-d/2,l,{align:"left",url:thePageHeaderURL})}else e.text(g,e.internal.pageSize.getWidth()/3.1,l,{align:"center"});s=!0}var c=!1;if(thePageFooter&&""!=thePageFooter){var u=ProcessHeaderFooter(thePageFooter,n,totalTunes);if(thePageFooterURL&&""!=thePageFooterURL){var d=e.getTextWidth(u);e.textWithLink(u,e.internal.pageSize.getWidth()/3.1-d/2,thePageNumberVerticalOffset,{align:"center",url:thePageFooterURL})}else e.text(u,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});c=!0}if(t&&(!a||1!=n)){e.setFont("Times","","normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var A=""+n;switch(o){case"tl":e.text(A,13,l,{align:"center"});break;case"tc":s||e.text(A,e.internal.pageSize.getWidth()/3.1,l,{align:"center"});break;case"tr":e.text(A,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"});break;case"bl":e.text(A,13,thePageNumberVerticalOffset,{align:"center"});break;case"bc":c||e.text(A,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});break;case"br":e.text(A,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"tlr":n%2==1?e.text(A,13,l,{align:"center"}):e.text(A,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"});break;case"trl":n%2==1?e.text(A,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"}):e.text(A,13,l,{align:"center"});break;case"blr":n%2==1?e.text(A,13,thePageNumberVerticalOffset,{align:"center"}):e.text(A,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"brl":n%2==1?e.text(A,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"}):e.text(A,13,thePageNumberVerticalOffset,{align:"center"})}}}function PrimeWhistleRender(e,t){if(e.length<2){t();return}qualitaet=1200;var n=e[0].querySelector("svg");theOffscreen.innerHTML="<div>"+n.outerHTML+"</div>",(n=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(n,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(n){var o=e[1].querySelector("svg");theOffscreen.innerHTML="<div>"+o.outerHTML+"</div>",(o=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(o,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(n){var o,a=(o=e.length<3?e[1]:e[2]).querySelector("svg");theOffscreen.innerHTML="<div>"+a.outerHTML+"</div>",(a=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(a,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(e){t()})})})}function RenderPDFBlock(e,t,n,o,a,r,l,s,g,d){if(null!=e&&void 0!=e){var c=1;if(g){var u=e.id+".block";if(-1==u.indexOf("_0.block")&&-1==u.indexOf("_1.block")){d();return}c=2}var A=e.querySelector("svg");theOffscreen.innerHTML="<div>"+A.outerHTML+"</div>",(A=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(A,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(t){var a=PAGELEFTOFFSET;"a4"==s&&(a=PAGELEFTOFFSETA4);var r=a,l=a+267.5;1==column_number&&(a=l);var u=PAGEHEIGHTLETTER;"a4"==s&&(u=PAGEHEIGHTA4),pdf.internal.scaleFactor=PDFSCALEFACTOR;var A=t.toDataURL("image/jpeg",PDFJPGQUALITY),p=e.id+".block",m=!1;-1!=p.indexOf("_0.block")&&(m=!0,isFirstPage?(isFirstPage=!1,calcPageNumberVerticalOffset(pdf)):n?(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):o[tunesProcessed-1]?g?0==column_number?(running_height=PAGETOPOFFSET,column_number=1,a=l):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",column_number=0,a=r):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):running_height+=BETWEENTUNESPACE/c,theTunePageMap[tunesProcessed]=theCurrentPageNumber,++tunesProcessed<totalTunes&&(document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">'+(tunesProcessed+1)+'</font> of  <font color="red">'+totalTunes+"</font>")),height=parseInt(535*t.height/t.width),running_height+(height/=c)<=u-PAGEBOTTOMOFFSET?(m&&gTuneHyperlinks.push({page:theCurrentPageNumber,x:a,y:running_height,width:535/c,height:height,url:""}),pdf.addImage(A,"JPG",a,running_height,535/c,height)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,m&&(gTuneHyperlinks.push({page:theCurrentPageNumber,x:a,y:running_height,width:535/c,height:height,url:""}),theTunePageMap[tunesProcessed-1]=theCurrentPageNumber),pdf.addPage(s),pdf.addImage(A,"JPG",a,running_height,535/c,height),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),running_height=running_height+height+1/c,d(!0)})}}function promptForPDFFilename(e,t){if(ParseCommentCommands(gTheABC.value),gDoForcePDFFilename){var n=e;""==(e=(e=(e=gForcePDFFilename).trim()).replace(".pdf",""))&&(e=n)}DayPilot.Modal.prompt("Please enter a filename for your PDF file:",e+".pdf",{theme:"modal_flat",top:194,autoFocus:!1,scrollWithPage:!1}).then(function(e){var n=e.result;null==n||(0!=(n=n.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length?gIsAndroid||gIsIOS?(n=n.replace(/\..+$/,""),n+=".pdf"):n.endsWith(".pdf")||(n=n.replace(/\..+$/,""),n+=".pdf"):n=null),t(n)})}function ExportPDF(){if(!gRenderingPDF&&gAllowPDF){var e=document.getElementById("pdfformat"),t=e.options[e.selectedIndex].value;totalTunes=CountTunes();var n=getDescriptiveFileName(totalTunes,!0);if("incipits_abc"==t||"incipits_a4_abc"==t||"incipits_abc_sort"==t||"incipits_a4_abc_sort"==t)promptForPDFFilename(n+="_Incipits",function(e){e?ExportTextIncipitsPDF(e):gAppendXValuesToTuneNames=!1});else{var e=document.getElementById("pdfformat"),t=e.options[e.selectedIndex].value;("incipits"==t||"incipits_a4"==t)&&(n+="_Incipits"),promptForPDFFilename(n,function(e){e&&ExportNotationPDF(e)})}}}function ExportTextIncipitsPDF(e){gPDFCancelRequested=!1;var t=document.getElementById("pdfformat"),n=t.options[t.selectedIndex].value;document.getElementById("pdf-controls").style.display="block";var o=(t=document.getElementById("pagenumbers")).options[t.selectedIndex].value,a="none"!=o,r="letter";("incipits_a4_abc"==n||"incipits_a4_abc_sort"==n)&&(r="a4");var l=!1;("incipits_abc_sort"==n||"incipits_a4_abc_sort"==n)&&(l=!0);var s=!1;"no"==(t=document.getElementById("firstpage")).options[t.selectedIndex].value&&(s=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,totalTunes=CountTunes(),isFirstPage=!0,document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;",gRenderingPDF=!0,(pdf=new jsPDF("p","pt",r)).setDisplayMode("fullpage","single","UseNone"),pdf.internal.scaleFactor=PDFSCALEFACTOR,calcPageNumberVerticalOffset(pdf),setTimeout(function(){var t=[];t=GenerateTextIncipits(pdf,a,o,s,r,t,l),document.getElementById("statustunecount").innerHTML="ABC Incipits Added!";var n=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(r),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var g=theCurrentPageNumber,d=1,c=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,o,s,r,t,theTunebookSortedTOCTitle,!1,l),c=theCurrentPageNumber-g,c++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,o,s,r,t,theTunebookSortedTOCTitle,!0,l),theTOCDelta=theCurrentPageNumber-g,theCurrentPageNumber=g,TunebookTPRequested&&(d++,c++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,o,s,r,t,theTunebookTOCTitle,l,l,gIncludePageLinks,theTOCDelta,d),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,o,s,r,t,theTunebookSortedTOCTitle,!0,l,gIncludePageLinks,theTOCDelta,c),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,r,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),g=theCurrentPageNumber-g,TunebookTPRequested&&g++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(g=theTOCDelta),PostProcessHeadersAndFooters(pdf,a,g+1,n,o,s,r),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,o,s,r,t,theTunebookIndexTitle,l,l,gIncludePageLinks,g),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,o,s,r,t,theTunebookSortedIndexTitle,!0,l,gIncludePageLinks,g),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var u=!1,A=1,p=!1,m=1,h=theTOCDelta+1,T=theTOCDelta+n;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(u=!0,TunebookTPRequested&&(A=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(p=!0,m=n+theTOCDelta+1),(u||p)&&PostProcessTOCAndIndexLinks(pdf,h,T,u,A,p,m),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding QR Code",AppendQRCode(pdf,r,function e(t){t?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var n=1e3;t||(n=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",f()},n)});else{f();return}function f(){document.getElementById("statuspdfname").innerHTML='<font color="red">Rendering Complete!</font>',setTimeout(function(){document.getElementById("statuspdfname").innerHTML='Saving <font color="red">'+e+"</font>",setTimeout(function(){if(gIsAndroid||gIsIOS){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gAppendXValuesToTuneNames=!1,gRenderingPDF=!1},1500)},2e3)}},250)}function ExportNotationPDF(e){gPDFCancelRequested=!1,gPDFTabselected=GetRadioValue("notenodertab"),document.getElementById("pdf-controls").style.display="block";var t=document.getElementById("pdfformat"),n=t.options[t.selectedIndex].value,o=(t=document.getElementById("pagenumbers")).options[t.selectedIndex].value,a="one"==n||"one_a4"==n,r="none"!=o,l="letter";("one_a4"==n||"multi_a4"==n||"incipits_a4"==n)&&(l="a4");var s="incipits"==n||"incipits_a4"==n,g=!1;"no"==(t=document.getElementById("firstpage")).options[t.selectedIndex].value&&(g=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,tunesProcessed=0,column_number=0,theTunePageMap=[],totalTunes=CountTunes(),isFirstPage=!0;var d=0,c=[],u=null,A=0,p=null,m=!1;function h(){running_height=PAGETOPOFFSET,qualitaet=1200,document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing notation for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",theOffscreen=document.getElementById("offscreenrender"),PrepareSVGDivsForRasterization(),document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">1</font> of  <font color="red">'+totalTunes+"</font>",theTunePageMap[0]=theCurrentPageNumber,gRenderingPDF=!0,(pdf=new jsPDF("p","pt",l)).setDisplayMode("fullpage","single","UseNone"),c=[],a||(c=scanTunesForPageBreaks(pdf,l,s)),A=(u=document.querySelectorAll('div[class="block"]')).length,p=u[0],"whistle"==gPDFTabselected?PrimeWhistleRender(u,T):T()}function T(){setTimeout(function(){RenderPDFBlock(p,0,a,c,r,o,g,l,s,t);function t(){if(gPDFCancelRequested){(gRenderingPDF=!1,pdf=null,u=null,m)?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up incipit generation</font>',gAppendXValuesToTuneNames=!1,RenderAsync(!0,null,function(){document.getElementById("pdf-controls").style.display="none",document.getElementById("offscreenrender").innerHTML=""})):(document.getElementById("pdf-controls").style.display="none",RestoreSVGDivsAfterRasterization());return}if(++d==A){var n=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(l),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var h=theCurrentPageNumber,T=1,f=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookTOCTitle,!1,!1),f=theCurrentPageNumber-h,f++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1),theTOCDelta=theCurrentPageNumber-h,theCurrentPageNumber=h,TunebookTPRequested&&(T++,f++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookTOCTitle,!1,!1,gIncludePageLinks,theTOCDelta,T),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1,gIncludePageLinks,theTOCDelta,f),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,l,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),h=theCurrentPageNumber-h,TunebookTPRequested&&h++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(h=theTOCDelta),PostProcessHeadersAndFooters(pdf,r,h+1,n,o,g,l),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,o,g,l,theTunePageMap,theTunebookIndexTitle,!1,!1,gIncludePageLinks,h),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,o,g,l,theTunePageMap,theTunebookSortedIndexTitle,!0,!1,gIncludePageLinks,h),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var I=!1,b=1,C=!1,M=1,E=theTOCDelta+1,v=theTOCDelta+n;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(I=!0,TunebookTPRequested&&(b=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(C=!0,M=n+theTOCDelta+1),(I||C)&&PostProcessTOCAndIndexLinks(pdf,E,v,I,b,C,M),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,l,E),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding QR Code",AppendQRCode(pdf,l,function e(t){t?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var n=1e3;t||(n=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",B()},n)});else{B();return}function B(){document.getElementById("statuspdfname").innerHTML='<font color="red">Rendering Complete!</font>',setTimeout(function(){e&&(document.getElementById("statuspdfname").innerHTML='Saving <font color="red">'+e+"</font>"),setTimeout(function(){if(gIsAndroid||gIsIOS){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);function a(){document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none"}m?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after incipit generation</font>',setTimeout(function(){gRenderingPDF=!1,gAppendXValuesToTuneNames=!1,Render(!0,null),document.getElementById("offscreenrender").innerHTML="",a()},100)):(RestoreSVGDivsAfterRasterization(),a(),gRenderingPDF=!1)},1500)},2e3)}}else{if(d>u.length)return;d>0&&(u[d-1]=null),(p=u[d])&&RenderPDFBlock(p,d,a,c,r,o,g,l,s,t)}}},250)}gTuneHyperlinks=[],BETWEENTUNESPACE=gBetweenTuneSpace,s?(BETWEENTUNESPACE=0,IdleAdvancedControls(!1),IdleAllowShowTabNames(),gAllowFilterAnnotations&&!gStripAnnotations||gAllowFilterText&&!gStripTextAnnotations||gAllowShowTabNames&&gShowTabNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing incipits for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var e=gStripAnnotations;gStripAnnotations=!0;var t=gStripTextAnnotations;gStripTextAnnotations=!0;var n=gShowTabNames;gAllowShowTabNames&&(gShowTabNames=!1),Render(!0,null),gStripAnnotations=e,gStripTextAnnotations=t,gAllowShowTabNames&&(gShowTabNames=n),m=!0,h()},100)):h()):gAppendXValuesToTuneNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing tune numbering for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var e=gTheABC.value;e=processXTuneNameValues(e);var t=GetRadioValue("notenodertab");RenderTheNotes(e,t,!0,0),m=!0,h()},100)):h()}function CancelPDF(){gPDFCancelRequested=!0}function getNextSiblings(e,t){for(var n=[];e=e.nextSibling;)(!t||t(e))&&n.push(e);return n}function getStyleProp(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle?e.currentStyle[t]:void 0}function GetABCJSParams(e){var t,n="",o="";if(e&&gShowTabNames)switch(gCapo>0&&(n=" (Capo "+gCapo+")"),e){case"noten":break;case"notenames":case"whistle":o=" ";break;case"mandolin":o="Mandolin"+n;break;case"gdad":o="GDAD"+n;break;case"mandola":o="CGDA"+n;break;case"guitare":o="Guitar"+n;break;case"guitard":o="DADGAD"+n;break;case"bass":o="Bass"+n}var a=gRenderingFonts;return e?"noten"==e?t={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"mandolin"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"gdad"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","D","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"mandola"==e?t={tablature:[{instrument:"violin",label:o,tuning:["C","G","d","a"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"guitare"==e?t={tablature:[{instrument:"guitar",label:o,tuning:["E,","A,","D","G","B","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"guitard"==e?t={tablature:[{instrument:"guitar",label:o,tuning:["D,","A,","D","G","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"bass"==e?t={tablature:[{instrument:"violin",label:o,tuning:["E","A","d","g"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}:"notenames"==e?(a.tabnumberfont="Arial 12",t={tablature:[{instrument:"violin",label:o,tuning:["G,,,","G,,","G,"],highestNote:"b'"}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}):"whistle"==e&&(t={tablature:[{instrument:"violin",label:o,tuning:["G,"],highestNote:"^a'"}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}):(t={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a},e=""),t}function UpdateLocalStorage(){if(gLocalStorageAvailable){var e=GetRadioValue("notenodertab");localStorage.abcTab=e;var t=gCapo;localStorage.abcCapo=t;var n=gStaffSpacing-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=n;var o=document.getElementById("pdfformat").value;localStorage.abcTunesPerPage=o;var a=document.getElementById("pagenumbers").value;localStorage.abcPageNumberLocation=a;var r=document.getElementById("firstpage").value;localStorage.abcPageNumberOnPageOne=r,gTopBarShowing?localStorage.abcHideTopBar="false":localStorage.abcHideTopBar="true",gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false"}}function RecalcShareURLPDF(){UpdateLocalStorage()}function PrepareSVGDivsForRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,r=document.querySelectorAll('div[id="'+a+'"] > div'),l=r.length;for(n=0;n<l;++n)(o=r.item(n)).classList.add("block"),o.id="block_"+t+"_"+n}}function RestoreSVGDivsAfterRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,r=document.querySelectorAll('div[id="'+a+'"] > div'),l=r.length;for(n=0;n<l;++n)(o=r.item(n)).removeAttribute("class"),o.removeAttribute("id")}}function RenderTheNotes(e,t,n,o){var a=GetABCJSParams(t),r=[],l=0,s=0,g=0;if(n){g=l=CountTunes();for(var d=0;d<l;++d)r.push("notation"+d)}else l=1,s=o,g=o+1,r.push("notation"+o);if(0!=l){ABCJS.renderAbc(r,e,a);for(var c=s;c<g;++c)postProcessTab("notation"+c,t,!1)}}function SetRadioValue(e,t){let n=document.querySelectorAll('input[name="'+e+'"]');for(let o of n)o.value==t?o.checked=!0:o.checked=!1}function GetRadioValue(e){let t=document.querySelectorAll('input[name="'+e+'"]'),n;for(let o of t)if(o.checked){n=o.value;break}return n}function StripAnnotations(){var e=gTheABC.value;e=StripAnnotationsOne(e),gTheABC.value=e}function StripAnnotationsOne(e){var t=/^Q:.*[\r\n]*/gm;return e=e.replace(t,""),t=/^Z:.*[\r\n]*/gm,e=e.replace(t,""),t=/^R:.*[\r\n]*/gm,e=e.replace(t,""),t=/^S:.*[\r\n]*/gm,e=e.replace(t,""),t=/^N:.*[\r\n]*/gm,e=e.replace(t,""),t=/^D:.*[\r\n]*/gm,e=e.replace(t,""),t=/^H:.*[\r\n]*/gm,e=e.replace(t,""),t=/^B:.*[\r\n]*/gm,e=e.replace(t,""),t=/^C:.*[\r\n]*/gm,e=e.replace(t,""),t=/^O:.*[\r\n]*/gm,e=e.replace(t,"")}function StripTextAnnotations(){var e=gTheABC.value;e=StripTextAnnotationsOne(e),gTheABC.value=e}function StripTextAnnotationsOne(e){var t=/%%text.*[\r\n]*/gm;return e=e.replace(t,""),t=/%%center.*[\r\n]*/gm,e=e.replace(t,"")}function StripChords(){var e=gTheABC.value;e=StripChordsOne(e),gTheABC.value=e}function StripChordsOne(e){return e=e.replace(/"[^"]*"/gm,"")}function processXTuneNameValues(e){for(var t="",n=e.split(/^X:.*$/gm),o=n.length-1,n=e.split(/^X:/gm),a="",r="",l=0;l<o;++l)t+=a="X:"+(r=(r=n[l+1]).replace("T:","T:"+(l+1)+". "));return t}function RenderAsync(e,t,n){!gRenderingPDF&&(document.getElementById("loading-bar-spinner").style.display="none",e?(document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){Render(e,t),document.getElementById("loading-bar-spinner").style.display="none",MakeTuneVisible(!0),n&&void 0!=n&&n()},100)):(Render(e,t),n&&void 0!=n&&n()))}function Render(e,t){if(!gRenderingPDF){var n=CountTunes();if(""!=gTheABC.value&&n>0){var o,a=document.getElementById("abc-selected");1==n?a.innerText=gDisplayedName+"  ("+n+" Tune)":a.innerText=gDisplayedName+"  ("+n+" Tunes)";var r=window.pageYOffset;UpdateLocalStorage(),document.getElementById("notation-placeholder").style.display="none",gIsIOS||gIsAndroid?gIsMaximized?document.getElementById("notation-holder").style.display="flex":document.getElementById("notation-holder").style.display="block":gIsMaximized?document.getElementById("notation-holder").style.display="flex":document.getElementById("notation-holder").style.display="inline",document.getElementById("zoombutton").style.display="block",gShowAllControls?(document.getElementById("notenrechts").style.display="inline-block",gIsFirstRender&&(UpdateNotationTopPosition(),gIsFirstRender=!1)):document.getElementById("notenrechts").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfiledisabled"),document.getElementById("saveabcfile").classList.add("saveabcfile"),gAllowSave=!0,document.getElementById("toggleallcontrols").classList.remove("toggleallcontrolsdisabled"),document.getElementById("toggleallcontrols").classList.add("toggleallcontrols"),gAllowControlToggle=!0,document.getElementById("saveaspdf").classList.remove("saveaspdfdisabled"),document.getElementById("saveaspdf").classList.add("saveaspdf"),gAllowPDF=!0,document.getElementById("copybutton").classList.remove("copybuttondisabled"),document.getElementById("copybutton").classList.add("copybutton"),document.getElementById("playbutton").classList.remove("playbuttondisabled"),document.getElementById("playbutton").classList.add("playbutton"),gAllowCopy=!0;var l=GetRadioValue("notenodertab");e?(GenerateRenderingDivs(n),o=gTheABC.value):o=getTuneByIndex(t);var s="";gStripAnnotations&&(s=/^Q:.*$/gm,o=o.replace(s,"% comment"),s=/^Z:.*$/gm,o=o.replace(s,"% comment"),s=/^R:.*$/gm,o=o.replace(s,"% comment"),s=/^S:.*$/gm,o=o.replace(s,"% comment"),s=/^N:.*$/gm,o=o.replace(s,"% comment"),s=/^D:.*$/gm,o=o.replace(s,"% comment"),s=/^H:.*$/gm,o=o.replace(s,"% comment"),s=/^B:.*$/gm,o=o.replace(s,"% comment"),s=/^C:.*$/gm,o=o.replace(s,"% comment"),s=/^O:.*$/gm,o=o.replace(s,"% comment")),gStripTextAnnotations&&(s=/%%text.*$/gm,o=o.replace(s,"% comment"),s=/%%center.*$/gm,o=o.replace(s,"% comment")),gStripChords&&(s=/"[^"]*"/gm,o=o.replace(s,"")),s=/%%center$/gm,o=o.replace(s,"%%vskip 12\n%%center"),s=/^X:.*$/gm,o=o.replace(s,"X:1\n%%musicspace 10\n%%staffsep "+gStaffSpacing),gAppendXValuesToTuneNames&&(o=processXTuneNameValues(o)),RenderTheNotes(o,l,e,t),window.scrollTo(0,r)}else{document.getElementById("notenrechts").style.display="none",document.getElementById("notation-holder").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfile"),document.getElementById("saveabcfile").classList.add("saveabcfiledisabled"),gAllowSave=!1,document.getElementById("saveaspdf").classList.remove("saveaspdf"),document.getElementById("saveaspdf").classList.add("saveaspdfdisabled"),gAllowPDF=!1,document.getElementById("toggleallcontrols").classList.remove("toggleallcontrols"),document.getElementById("toggleallcontrols").classList.add("toggleallcontrolsdisabled"),gAllowControlToggle=!1,document.getElementById("copybutton").classList.remove("copybutton"),document.getElementById("copybutton").classList.add("copybuttondisabled"),document.getElementById("playbutton").classList.remove("playbutton"),document.getElementById("playbutton").classList.add("playbuttondisabled"),gAllowCopy=!1,document.getElementById("notation-placeholder").style.display="block",document.getElementById("zoombutton").style.display="none",document.getElementById("loading-bar-spinner").style.display="none";var a=document.getElementById("abc-selected");a.innerText="No ABC file selected",gDisplayedName="No ABC file selected",gABCFromFile=!1,UpdateNotationTopPosition()}}}function ensureABCFile(e){var t="";return e.lastIndexOf(".")>0&&(t=e.substring(e.lastIndexOf(".")+1,e.length)),"abc"==t.toLowerCase()||"txt"==t.toLowerCase()||"xml"==t.toLowerCase()||"musicxml"==t.toLowerCase()||"mxl"==t.toLowerCase()||(DayPilot.Modal.alert("You must select a .abc, .txt, .xml, .musicxml, or .mxl file to open.",{theme:"modal_flat",top:50,scrollWithPage:!1}),!1)}function IdleAdvancedControls(e){var t=gTheABC.value,n="",o=!1,a=!1,r=!1,l=!1;n=/^Q:.*$/gm,(l=-1!=t.search(n))||(n=/^Z:.*$/gm,l=-1!=t.search(n)),l||(n=/^R:.*$/gm,l=-1!=t.search(n)),l||(n=/^S:.*$/gm,l=-1!=t.search(n)),l||(n=/^N:.*$/gm,l=-1!=t.search(n)),l||(n=/^D:.*$/gm,l=-1!=t.search(n)),l||(n=/^H:.*$/gm,l=-1!=t.search(n)),l||(n=/^B:.*$/gm,l=-1!=t.search(n)),l||(n=/^C:.*$/gm,l=-1!=t.search(n)),l||(n=/^O:.*$/gm,l=-1!=t.search(n)),o=l,l=!1,n=/%%text.*$/gm,(l=-1!=t.search(n))||(n=/%%center.*$/gm,l=-1!=t.search(n)),a=l,l=!1,n=/"[^"]*"/gm,r=l=-1!=t.search(n),o?(gAllowFilterAnnotations=!0,e&&(document.getElementById("toggleannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleannotations").classList.add("advancedcontrols"),document.getElementById("stripannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.add("advancedcontrols"))):(gAllowFilterAnnotations=!1,e&&(document.getElementById("toggleannotations").classList.remove("advancedcontrols"),document.getElementById("toggleannotations").classList.add("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.remove("advancedcontrols"),document.getElementById("stripannotations").classList.add("advancedcontrolsdisabled"))),a?(gAllowFilterText=!0,e&&(document.getElementById("toggletext").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletext").classList.add("advancedcontrols"),document.getElementById("striptext").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptext").classList.add("advancedcontrols"))):(gAllowFilterText=!1,e&&(document.getElementById("toggletext").classList.remove("advancedcontrols"),document.getElementById("toggletext").classList.add("advancedcontrolsdisabled"),document.getElementById("striptext").classList.remove("advancedcontrols"),document.getElementById("striptext").classList.add("advancedcontrolsdisabled"))),r?(gAllowFilterChords=!0,e&&(document.getElementById("togglechords").classList.remove("advancedcontrolsdisabled"),document.getElementById("togglechords").classList.add("advancedcontrols"),document.getElementById("stripchords").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.add("advancedcontrols"))):(gAllowFilterChords=!1,e&&(document.getElementById("togglechords").classList.remove("advancedcontrols"),document.getElementById("togglechords").classList.add("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.remove("advancedcontrols"),document.getElementById("stripchords").classList.add("advancedcontrolsdisabled"))),e&&(gStripAnnotations?document.getElementById("toggleannotations").value="Show Annotations":document.getElementById("toggleannotations").value="Hide Annotations",gStripTextAnnotations?document.getElementById("toggletext").value="Show Text":document.getElementById("toggletext").value="Hide Text",gStripChords?document.getElementById("togglechords").value="Show Chords + Injected Tab":document.getElementById("togglechords").value="Hide Chords + Injected Tab")}function SetStaffSpacing(e){gStaffSpacing=e+STAFFSPACEOFFSET,RenderAsync(!0,null,function(){})}function UpdateNotationTopPosition(){var e=document.getElementById("noscroller").offsetHeight;document.getElementById("notation-spacer").style.height=e+"px"}function RestoreDefaults(){gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gTotalTunes=0,gCurrentTune=0,gForceFullRender=!1,gLastAutoScrolledTune=-1;document.getElementById("selectabcfile").value="",clearQRCode(),UpdateNotationTopPosition()}function ToggleAnnotations(e){if(gAllowFilterAnnotations){if(e){StripAnnotations(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripAnnotations=!gStripAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleTextAnnotations(e){if(gAllowFilterText){if(e){StripTextAnnotations(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripTextAnnotations=!gStripTextAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleChords(e){if(gAllowFilterChords){if(e){StripChords(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripChords=!gStripChords,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function AddABC(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:50px;">Add New Example ABC Templates&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#getting_started" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>';e+='<div id="add-new-tune-dialog">',e+='<p style="text-align:center;margin-top:36px;">',e+='<input id="addnewreel" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleReel();" type="button" value="Add an Example Reel" title="Adds an example reel (Cooley\'s) to the end of the ABC">',e+='<input id="addnewjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleJig();" type="button" value="Add an Example Jig" title="Adds an example jig (The Kesh) to the end of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:32px;">',e+='<input id="addjsbach" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendJSBach();" type="button" value="Add J.S. Bach Two-Part Invention #1" title="Adds the J.S. Bach 2-Part Invention #1 to the top of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:32px;">',e+='<input id="addnewsong" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleSong();" type="button" value="Add an Example Song" title="Adds an example song to the end of the ABC">',e+='<input id="addsongtemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSongTemplate();" type="button" value="Add a Song Template" title="Adds a minimal song template to the end of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:32px;">',e+='<input id="addboxfingeringtemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendBoxFingeringTemplate();" type="button" value="Add Box Fingering Symbols Template" title="Adds a template with symbols for annotating box fingerings and tablature to the top of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:32px;">',e+='<input id="addtunebookheaders" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectPDFHeaders(false);" type="button" value="Add PDF Tunebook Annotations" title="Adds common useful PDF tunebook annotations to the top of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:32px;">',e+="</p>",e+="</div>",DayPilot.Modal.alert(e,{theme:"modal_flat",top:20,width:600,scrollWithPage:!1}).then(function(){})}function AppendSampleReel(){var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Cooley's\n",e+="R: Reel\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="K: Edor\n",e+="C: Traditional\n",e+="%\n",e+="% Use an Accordion sound when playing the melody:\n",e+="%%MIDI program 21\n",e+="%\n",e+="% Use an Accordion sound when playing the chords:\n",e+="%%MIDI chordprog 21\n",e+="%\n",e+="% ABC for the tune, both melody and chords:\n",e+="%\n",e+='|:"Em"EBBA B2 EB|"Em"B2 AB dBAG|"D"F/E/D AD BDAD|"D"F/E/D AD BAGF|\n',e+='"Em"EBBA B2 EB|"Em"B2 AB defg|"D"afge dBAF|1 "D"DEFD "Em"E3D:|2 "D"DEFD "Em"E2gf||\n',e+='|:"Em"eB (3BBB eBgf|"Em"eBB2 gedB|"D"A/A/A FA DAFA|"D"A/A/A FA defg|\n',ProcessAddTune(e+='"Em"eB (3BBB eBgf|"Em"eBBB defg|"D"afge dBAF|1 "D"DEFD "Em"E2gf:|2 "D"DEFD "Em"E4|]\n')}function AppendSampleJig(){var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: The Kesh\n",e+="R: Jig\n",e+="M: 6/8\n",e+="L: 1/8\n",e+="K: Gmaj\n",e+="C: Traditional\n",e+="%\n",e+="% Use an Accordion sound when playing the melody:\n",e+="%%MIDI program 21\n",e+="%\n",e+="% Use an Accordion sound when playing the chords:\n",e+="%%MIDI chordprog 21\n",e+="%\n",e+="% ABC for the tune, both melody and chords:\n",e+="%\n",e+='|:"G"GAG GAB|"D"ABA ABd|"G"edd gdd|"C"edB "D"dBA|\n',e+='"G"GAG GAB|"D"ABA ABd|"G"edd gdB|"D"AGF "G"G3:|\n',e+='|:"G"BAB dBd|"C"ege "D"dBA|"G"BAB dBG|"D"ABA AGA|\n',ProcessAddTune(e+='"G"BAB dBd|"C"ege "G"dBd|"C"gfg "D"aga|"G"bgf g3:|\n')}function AppendSongTemplate(){var e="";CountTunes()>0&&(e+="\n"),e+="% Stripped-down self-documenting song in ABC, by Linda Eskin\n",e+="% Replace the WORDS IN UPPER-CASE with your own information.\n",e+="% You can remove all these comments with single % signs.\n",e+="%\n",e+="X: 1\n",e+="%\n",e+="% *** THIS HEADER CONVEYS INFORMATION ABOUT THE SONG ***\n",e+="%\n",e+="% These text elements appear above the music:\n",e+="T: TITLE OF THE SONG\n",e+="T: ALTERNATE TITLE\n",e+="C: COMPOSER/SONGWRITER\n",e+="O: ORIGIN/GEOGRAPHIC\n",e+="%%text GENERAL PURPOSE TEXT\n",e+="%\n",e+="% These appear below the music and lyrics:\n",e+="S: SOURCE OF THE SONG\n",e+="D: DISCOGRAPHY - CD, LP, ETC.\n",e+="N: NOTES (TEXT)\n",e+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS\n",e+="H: HISTORY OF THE SONG\n",e+="H: This self-documenting ABC song template was created by Linda Eskin.\n",e+="%\n",e+="% This appears in your ABC file only, for reference.\n",e+="F: FILE URL - WHERE TO FIND THIS ONLINE\n",e+="%\n",e+="% These appear above the music AND control how it is played:\n",e+="R: RHYTHM, E.G. JIG, WALTZ\n",e+="M: 4/4\n",e+="L: 1/4\n",e+="Q: 1/4=120\n",e+="K: C\n",e+="% The K (key) tag should be the last thing in the header.\n",e+="%\n",e+="% *** THE SONG ITSELF STARTS HERE - REPLACE THIS WITH YOUR SONG ***\n",e+="%\n",e+="P: PART - VERSE, CHORUS, ETC.\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',e+="w: The words to the act-u-al tune go here\n",e+="w: You can put more ver-ses here is you like\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',e+="w: This tune is a scale. See how the notes work!\n",e+="w: This line is for the se-cond verse. Ta-da!\n",e+="%\n",e+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",e+="%\n",e+="W: Write your extra verses here, verses here, verses here.\n",e+="W: Write your extra verses here, or the whole song if you like.\n",e+="W:\n",e+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",e+="W: --- Indent it with dashes if you like, but spaces will not work.\n",e+="W:\n",e+="W: Here we have another verse, another verse, another verse.\n",e+="W: Now we have reached the end - this is the last verse of this song.\n",e+="%\n",ProcessAddTune(e+="% That should get you started. Go play!\n")}function AppendSampleSong(){var e="";CountTunes()>0&&(e+="\n"),e+="% A simple, self-documenting song in ABC, by Linda Eskin\n",e+="%\n",e+="% ABC is a plain-text format for conveying musical information.\n",e+="% Use this as an example to learn how ABC is written.\n",e+="% You can use it as a template to create your own ABC song.\n",e+="% Examples are in UPPER-CASE so you can see and replace them easily.\n",e+="%\n",e+="% Comments (like this one) start with a single percent symbol.\n",e+="%\n",e+="X: 1 \n",e+="% Each tune must start with an X: tag, and a number.\n",e+="%\n",e+="% *** THIS IS THE HEADER - INFO ABOUT THE TUNE/SONG ***\n",e+="%\n",e+="% These text elements appear above the music:\n",e+="%\n",e+="T: TITLE OF THE SONG\n",e+="T: ALTERNATE TITLE\n",e+="%\n",e+="C: COMPOSER\n",e+='% Songwriter, source, "Traditional", "Child Ballad," etc.\n',e+="%\n",e+="O: ORIGIN\n",e+="% Where is the tune from? Country, culture, ...\n",e+="%\n",e+="%%text GENERAL PURPOSE TEXT\n",e+="% There are many more options that use the double percentage symbols.\n",e+="% Note that lines starting with %% are *not* comments.\n",e+="%\n",e+="% These text elements appear below the music and lyrics:\n",e+="%\n",e+="% For S:, D:, H:, N:, and Z: the first line with the tag adds a label.\n",e+="% Additional lines with the same tag do not.\n",e+="%\n",e+="% S:, D:, H:, N:, and Z: lines do not word wrap.\n",e+="% Add more lines if you have more than will fit across the page.\n",e+="%\n",e+="S: SOURCE\n",e+='% "Learned from Morgan at Folk Festival," "Child Ballad," etc.\n',e+="%\n",e+="D: DISCOGRAPHY\n",e+="% On which CD/LP? Appears at the bottom of the page.\n",e+="%\n",e+="N: THESE NOTES APPEAR NEAR THE BOTTOM OF THE PAGE.\n",e+="%\n",e+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS.\n",e+="% Transcriber info appears at the bottom, right below the Notes.\n",e+="%\n",e+="H: HISTORY OF THE SONG\n",e+="H: This self-documenting ABC example song was created by Linda Eskin.\n",e+="% Real-life event? Written for a movie? Appears at the bottom of the page.\n",e+="%\n",e+="F: FILE URL\n",e+="% If you want people to find your file online, put the URL here.\n",e+="%\n",e+="% These appear above the music AND control how it is played:\n",e+="%\n",e+="R: RHYTHM\n",e+="% Reel, Waltz, Jig, Hornpipe, etc.\n",e+="%\n",e+="M: 4/4\n",e+="% Meter, such as 3/4, 4/4, 9/8. Appears in the key signature.\n",e+="%\n",e+="L: 1/4\n",e+="% Length of base note unit. Here a 1/4 note = 1.\n",e+="% Use multiplier numbers to get longer notes: C2, a3, F4\n",e+="%\n",e+="Q: 1/4=120\n",e+="% Tempo. e.g. 120 beats per minute (BPM). (Mnemonic: Q=Quickness.)\n",e+="%\n",e+="%%staffsep 80\n",e+="% Sets the spacing between the staffs. Bigger numbers = more space.\n",e+="%\n",e+="K: C\n",e+="% Key signature - G, D, Edor, Amix, etc.\n",e+="% The K (key) tag should be the last thing in the header.\n",e+="%\n",e+="% *** THE TUNE ITSELF STARTS HERE ***\n",e+="%\n",e+="P: PART GOES HERE\n",e+="% Intro, Verse, Chorus, Refrain, etc.\n",e+="%\n",e+="% This is the actual music and words.\n",e+="% ABC apps *play* the music you write. Don't just make stuff up!\n",e+="% Follow the ABC standard so your tune and chords play correctly:\n",e+="% http://abcnotation.com/wiki/abc:standard:v2.1\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',e+="w: The words to the act-u-al tune go here\n",e+="w: You can put more ver-ses here is you like\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',e+="w: This tune is a scale. See how the notes work!\n",e+="w: This line is for the se-cond verse. Ta-da!\n",e+="%\n",e+="% Chord names, in quotes, appear above the black-dots notation.\n",e+="%\n",e+="% The other letters are the notes. Lower-case for higher octave.\n",e+='% The base unit note length ("L", above) is assumed to equal 1.\n',e+="% For longer notes use a multiplier: G3, e2, C4 etc.\n",e+="%\n",e+='% w (lower-case "w") = words, or inline lyrics - the lyrics that appear right in the sheet music, below the black-dots notation.\n',e+="%\n",e+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",e+="%\n",e+="% W = Words. More lyrics, if you want them.\n",e+='% Note upper-case "W:" used below:\n',e+="%\n",e+="W: Write your extra verses here, verses here, verses here.\n",e+="W: Write your extra verses here, or the whole song if you like.\n",e+="W:\n",e+='% You can leave a "W" line blank, to leave some space.\n',e+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",e+="W: --- Indent it with dashes if you like, but spaces won't work.\n",e+="W:\n",e+="W: Here we have another verse, another verse, another verse.\n",e+="W: Now we have reached the end - this is the last verse of this song.\n",e+="%\n",ProcessAddTune(e+="% That should get you started. Go play!\n")}function AppendBoxFingeringTemplate(){var e=gTheABC.value,t="";t+="%\n",t+="% Danny Flynn's symbols for box fingering transcriptions\n",t+="%\n",t+="% Copy and paste these as chord annotations before the notes:\n",t+="%\n",t+='% Finger 1: "1" "①"\n',t+='% Finger 2: "2" "②"\n',t+='% Finger 3: "3" "③"\n',t+='% Finger 4: "4" "④"\n',t+='% Slide down: "➘"\n',t+='% Slide up: "➚"\n',t+='% Slide straight down: "↓"\n',t+='% Cross over/under: "x"\n',t+='% Push: "⮐"\n',t+='% Draw: "⮑"\n',t+="%\n",t+="% Additional symbols for button numbering tablature:\n",t+="%\n",t+='% "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "↑" "↓"\n',t+='% "①" "②" "③" "④" "⑤" "⑥" "⑦" "⑧" "⑨" "⑩" "⑪"\n',t+="%\n",t+="\n",t+=e,gTheABC.value=t,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}function AppendJSBach(){var e="";CountTunes()>0&&(e+="\n"),e+="%\n",e+="% Example J.S. Bach transcription originally imported from MusicXML\n",e+="%\n",e+='% Click "Player" to play\n',e+="%\n",e+="X:1\n",e+="T:Two-Part Invention #1\n",e+="C:J.S. Bach\n",e+="L:1/16\n",e+="Q:1/4=84\n",e+="M:4/4\n",e+="K:C\n",e+="V:1 treble\n",e+="%%staffsep 40\n",e+="%%MIDI program 6\n",e+="V:2 bass\n",e+="%%MIDI program 6\n",e+="V:1\n",e+="z CDE FDEC G2c2 B/A/Bc2 | dGAB cABG d2g2 f/e/fg2 |\n",e+="eagf egfa gfed cedf | edcB AcBd cBAG ^FAGB |\n",e+="A2D2 c/B/c2d BAG^F EGFA | GBAc Bdce dB/c/dg B/c/BAG |\n",e+=".G4 z4 z GAB cABG | .^F4 z4 z ABc dBcA |\n",e+=".B4 z4 z dcB AcBd | .c4 z4 z edc Bd^ce |\n",e+="d2^c2d2e2 f2A2B2c2 | d2^F2^G2A2 B2c2 d4 |\n",e+="z E^F^G AFGE edce dcBd | ca^gb aefd ^Gfed c/d/cBA |\n",e+="Aagf egfa g8- | gefg afge f8 |\n",e+="z gfe dfeg f8- | fdef gefd e8- |\n",e+="ecde fdec defg afge | fgab c'abg [Q:78]c'2g2 [Q:70]e/f/edc|\n",e+="c_BAG [Q:62]FAGB [Q:54]A=BcE [Q:46]Dc[Q:28]FB | [EGc]16|]\n",e+="V:2\n",e+="z8 z C,D,E, F,D,E,C, | G,2G,,2 z4 z G,A,B, CA,B,G, |\n",e+="C2B,2C2D2 E2G,2A,2B,2 | C2E,2^F,2G,2 A,2B,2 C4- |\n",e+="CD,E,^F, G,E,F,D, G,2B,,2C,2D,2 | E,2^F,2G,2E,2 B,,2>C,2 D,2D,,2 |\n",e+="z G,,A,,B,, C,A,,B,,G,, D,2G,2^F,2G,2 | A,D,E,^F, G,E,F,D, A,2D2C2D2 |\n",e+="G,GFE DFEG F2E2F2D2 | EAGF EGFA G2F2G2E2 |\n",e+="F_BAG FAGB AGFE DFEG | FEDC B,DCE DCB,A, ^G,B,A,C |\n",e+="B,2E,2D/C/.D3 CB,A,G, ^F,A,^G,B, | A,CB,D CEDF E2A,2E2E,2 |\n",e+="A,2A,,2 z4 z EDC B,D^CE | D8- DA,B,C DB,CA, |\n",e+="B,8- B,DCB, A,CB,D | C8- CG,A,_B, CA,B,G, |\n",e+="A,2_B,2A,2G,2 F,2D2C2B,2 | A,2F2E2D2 ED,E,F, G,E,F,D, |\n",ProcessAddTune(e+="E,2C,2D,2E,2 F,D,E,F, [Q:46]G,2[Q:28]G,,2 | [C,,C,]16 |]\n")}function ProcessAddTune(e){var t=gTheABC.value.length;gTheABC.value=gTheABC.value+e,"No ABC file selected"!=gDisplayedName&&-1==gDisplayedName.indexOf("+ added tunes")&&(gDisplayedName+=" + added tunes"),RenderAsync(!0,null,function(){if(UpdateNotationTopPosition(),!gIsIOS&&!gIsAndroid){var e=CountTunes(),n=getTuneByIndex(e-1),o=t+n.length/2;gIsMaximized||(gTheABC.selectionEnd=gTheABC.selectionStart=o,gTheABC.blur(),gTheABC.focus()),MakeTuneVisible(!0)}})}function RenderDivClickHandler(e){if(!gRenderingPDF){var t=this.id;if(t&&""!=t&&0==t.indexOf("notation")){var n=this.id.replace("notation","");if(""!=n){var o=parseInt(n),a=findTuneOffsetByIndex(o),r=getTuneByIndex(o);a+=r.length/2,gIsMaximized?(gGotRenderDivClick=!0,gRenderDivClickOffset=a):(gTheABC.selectionEnd=gTheABC.selectionStart=a,gTheABC.blur(),gTheABC.focus())}}}}function GenerateRenderingDivs(e){var t=document.getElementById("notation-holder");t.innerHTML="";for(var n=0;n<e;++n){var o=document.createElement("div");o.id="notation"+n,o.classList.add("tunespacer"),o.classList.add("pagebreak"),gIsIOS||gIsAndroid||(o.onclick=RenderDivClickHandler),t.appendChild(o)}}function getUrlWithoutParams(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function FillUrlBoxWithAbcInLZW(e,t){var n="";n=e||gTheABC.value;var o=LZString.compressToEncodedURIComponent(n),a=GetRadioValue("notenodertab"),r=gCapo,l=gStaffSpacing-STAFFSPACEOFFSET,s=document.getElementById("pdfformat").value,g=document.getElementById("pagenumbers").value,d=document.getElementById("firstpage").value,c=getUrlWithoutParams()+"?lzw="+o+"&format="+a+"&ssp="+l+"&pdf="+s+"&pn="+g+"&fp="+d;gTopBarShowing||(c+="&hide=1");var u="";switch(a){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":case"bass":u="&capo="+r,gShowTabNames?u+="&stn=true":u+="&stn=false"}if(c+=u,e)return c;var A=CountTunes(),p=getDescriptiveFileName(A,!1);if(c+="&name="+p,document.getElementById("qrcode").style.display="none",gAllowURLSave=!1,gAllowQRCodeSave=!1,c.length<8100&&(gAllowURLSave=!0,c.length<MAXQRCODEURLLENGTH&&(gAllowQRCodeSave=!0)),t){var m=document.getElementById("urltextbox");gAllowURLSave?(document.getElementById("testurl").classList.remove("urlcontrolsdisabled"),document.getElementById("testurl").classList.add("urlcontrols"),document.getElementById("saveurl").classList.remove("urlcontrolsdisabled"),document.getElementById("saveurl").classList.add("urlcontrols"),document.getElementById("copyurl").classList.remove("urlcontrolsdisabled"),document.getElementById("copyurl").classList.add("urlcontrols"),document.getElementById("shortenurl").classList.remove("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.add("urlcontrols"),gAllowQRCodeSave?(document.getElementById("generateqrcode").classList.remove("urlcontrolsdisabled"),document.getElementById("generateqrcode").classList.add("urlcontrols")):(document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"))):(c=" *** The URL link would be too long to share. Please try sharing fewer tunes. ***",document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.remove("urlcontrols"),document.getElementById("shortenurl").classList.add("urlcontrolsdisabled"),document.getElementById("testurl").classList.remove("urlcontrols"),document.getElementById("testurl").classList.add("urlcontrolsdisabled"),document.getElementById("copyurl").classList.remove("urlcontrols"),document.getElementById("copyurl").classList.add("urlcontrolsdisabled"),document.getElementById("saveurl").classList.remove("urlcontrols"),document.getElementById("saveurl").classList.add("urlcontrolsdisabled")),m.value=c}return c}function CreateURLfromHTML(){FillUrlBoxWithAbcInLZW(null,!0),(urltextbox=document.getElementById("urltextbox")).focus(),urltextbox.setSelectionRange(0,0),clearQRCode()}function clearQRCode(){gTheQRCode&&gTheQRCode.clear()}function GenerateQRCode(e){var t=!1,n=document.getElementById("urltextbox").value;if(e.shiftKey){if(n.length>MAXQRCODEURLLENGTH){DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:14pt;">Share URL text is too long to generate a QR Code</p>',{theme:"modal_flat",top:50,scrollWithPage:!1});return}t=!0}else if(!gAllowQRCodeSave)return;null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:n,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(n)),document.getElementById("qrcode").style.display="inline-block";var o="Custom QR Code",a="custom_qr_code";if((theQRCodeImage=document.querySelectorAll('div[id="qrcode"] > img'))&&theQRCodeImage.length>0){if(!t){o=GetAllTuneTitles();var r=GetRadioValue("notenodertab"),l="";switch(r){case"noten":l="<br/><br/>(Standard Notation)";break;case"notenames":l="<br/><br/>(Note Names Tab)";break;case"mandolin":l="<br/><br/>(Mandolin Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"gdad":l="<br/><br/>(Bouzouki GDAD Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"mandola":l="<br/><br/>(Mandola Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"guitare":l="<br/><br/>(Standard Guitar Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"guitard":l="<br/><br/>(DADGAD Guitar Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"bass":l="<br/><br/>(Bass Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"whistle":l="<br/><br/>(Whistle Tab)"}o+=l;var s=CountTunes();a=getDescriptiveFileName(s,!0)}theQRCodeImage=theQRCodeImage[0];var g=window.open("");setTimeout(function(){var e=theQRCodeImage.src,t=theQRCodeImage.outerHTML.replace("display: block;",""),n='<div style="text-align:center;padding:24px;margin-top:0px;margin-bottom:0px;">';n+=t,n+='<p style="font-family:times;font-size:15pt;margin-top:18px;margin-bottom:0px;">'+o+"</p>",n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Get Your QR Code</strong></p>',n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><a href="'+e+'" download="'+a+'.png" style="text-decoration:none;color:darkblue">Click here to download&nbsp;'+a+".png&nbsp;to your system.</a></p>",n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Use Your QR Code</strong></p>',n+='<p style="font-family:times;font-size:15pt;margin-top:30px;margin-bottom:0px;">Share QR Codes on social media or email them to friends like any other photo.</p>',n+='<p style="font-family:times;font-size:15pt;margin-top:24px;margin-bottom:0px;">Scanning the code with the Camera app on any iOS or Android phone will load the</p>',n+='<p style="font-family:times;font-size:15pt;margin-top:6px;margin-bottom:0px;">ABC Transcription Tool with your tune set into the browser on the device.</p>',n+="</div>",g.document.write(n),setTimeout(function(){g.document.title="ABC Tools Tune Sharing QR Code"},100)},1e3)}}function saveABCFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:194,autoFocus:!1,scrollWithPage:!1}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;gIsAndroid||gIsIOS?(t=t.replace(/\..+$/,""),t+=".txt"):t.endsWith(".abc")||t.endsWith(".txt")||t.endsWith(".ABC")||t.endsWith(".TXT")||(t=t.replace(/\..+$/,""),t+=".abc");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3),gDisplayedName=t,gABCFromFile=!0,document.getElementById("abc-selected").innerText=t})}function saveShareURLFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:194,autoFocus:!1,scrollWithPage:!1}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;gIsAndroid||gIsIOS?(t=t.replace(/\..+$/,""),t+=".txt"):t.endsWith(".txt")||t.endsWith(".TXT")||(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)})}function CopyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);{let t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((e,n)=>{document.execCommand("copy")?e():n(),t.remove()})}}catch(n){console.log("CopyToClipboard error: "+n)}}function InjectOneTuneMIDIProgram(e,t,n){var o=escape(e).split("%0A"),a="",r="";for(i=0;i<o.length;++i){var l=(r=unescape(o[i])).split("");"|"!=l[0]&&"["!=l[0]&&":"==l[1]?(a+=r+"\n","X"==l[0]&&(n?a+="%%MIDI chordprog "+t+"\n":a+="%%MIDI program "+t+"\n")):(a+=r,i!=o.length-1&&(a+="\n"))}return a}function OverrideOneTuneMIDIParams(e,t,n,o,a){var r=e,l=/^%%MIDI program.*$/gm,s=e.match(l);if(s&&s.length>0)for(var g=0;g<s.length;++g)r=r.replace(s[0],"%%MIDI program "+t);l=/^%%MIDI chordprog.*$/gm;var d=e.match(l);if(d&&d.length>0)for(var g=0;g<d.length;++g)r=r.replace(d[g],"%%MIDI chordprog "+n);l=/^%%MIDI bassvol.*$/gm;var c=e.match(l);if(c&&c.length>0)for(var g=0;g<c.length;++g)r=r.replace(c[g],"%%MIDI bassvol "+o);l=/^%%MIDI chordvol.*$/gm;var u=e.match(l);if(u&&u.length>0)for(var g=0;g<u.length;++g)r=r.replace(u[g],"%%MIDI chordvol "+a);return r}function InjectOneTuneMIDIVolume(e,t,n){var o=escape(e).split("%0A"),a="",r="";for(i=0;i<o.length;++i){var l=(r=unescape(o[i])).split("");"|"!=l[0]&&"["!=l[0]&&":"==l[1]?(a+=r+"\n","X"==l[0]&&(n?a+="%%MIDI chordvol "+t+"\n":a+="%%MIDI bassvol "+t+"\n")):(a+=r,i!=o.length-1&&(a+="\n"))}return a}function InjectMIDIInstrument(e){if(!gRenderingPDF){var t=" melody",n="21";e&&(t=" chords",n="34");var o='<p style="font-size:14pt;line-height:19pt;font-family:helvetica"><strong>MIDI instrument program number to inject for the'+t+'?</strong></p><p style="font-size:14pt;font-family:helvetica">Suggested values:</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica">Piano: 0,  Hammered Dulcimer: 15,  Accordion: 21, Fingered Bass: 33,  Flute: 73,  Whistle: 78,  Fiddle: 110,  Uilleann Pipes: 129,  Scottish Smallpipes (D): 130,  Scottish Smallpipes (A): 131,  S\xe4ckpipa: 132,  Concertina: 133,  Melodica: 134, Cajun Accordion: 135</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px"><strong>Shortcut:</strong> Entering a negative value will inject the same value for both the melody and chord instrument program numbers.</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="http://michaeleskin.com/documents/general_midi_extended.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>';e&&(o='<p style="font-size:14pt;line-height:19pt;font-family:helvetica"><strong>MIDI instrument program number to inject for the'+t+'?</strong></p><p style="font-size:14pt;font-family:helvetica">Suggested values:</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica">Piano: 0,  Electric Piano: 5,  Organ: 19,  Accordion: 21,  Guitar: 25,  Bass: 34,  Synth Bass: 38</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px"><strong>Shortcut:</strong> Entering a negative value will inject the same value for both the melody and chord instrument program numbers.</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="http://michaeleskin.com/documents/general_midi_extended.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'),DayPilot.Modal.prompt(o,n,{theme:"modal_flat",top:194,autoFocus:!1,scrollWithPage:!1}).then(function(t){var n=t.result;if(null!=n){var o=parseInt(n);if(!isNaN(o)&&void 0!=o){var a=!1;if(o<0&&(a=!0,o=-o),!(o<0)&&!(o>135)){var r=CountTunes();if(a){for(var l=gTheABC.value,s=l.split(/^X:/gm),g="",d=1;d<=r;++d)s[d]="X:"+s[d],g+=InjectOneTuneMIDIProgram(s[d],o,!0);s=g.split(/^X:/gm);for(var g="",d=1;d<=r;++d)s[d]="X:"+s[d],g+=InjectOneTuneMIDIProgram(s[d],o,!1)}else for(var l=gTheABC.value,s=l.split(/^X:/gm),g="",d=1;d<=r;++d)s[d]="X:"+s[d],g+=InjectOneTuneMIDIProgram(s[d],o,e);gTheABC.value=g,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}}})}}function PlayABC(e){if(gAllowCopy){var t=findSelectedTune();""!=t&&(t=PreProcessPlayABC(t),PlayABCDialog(t))}}function CopyABC(){gAllowCopy&&(CopyToClipboard(gTheABC.value),document.getElementById("copybutton").value="Copied!",setTimeout(function(){document.getElementById("copybutton").value="Copy All"},750))}function ShortenURLFallback(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("shortenurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("shortenurl").value="Launching TinyURL",setTimeout(function(){window.open("https://tinyurl.com"),document.getElementById("shortenurl").value="Shorten URL"},1e3)},2e3))}function ShortenURL(){if(gAllowURLSave){var e;fetch("https://api.tinyurl.com/create",{method:"POST",headers:{accept:"application/json",authorization:gTinyURLAPIKey,"content-type":"application/json"},body:JSON.stringify({url:document.getElementById("urltextbox").value})}).then(e=>{if(200!=e.status){ShortenURLFallback();return}return e.json()}).then(e=>{CopyToClipboard(e.data.tiny_url);var t='<p style="text-align:center;font-size:16pt;font-family:helvetica">Shortened URL Copied to the Clipboard</p>';t+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica">Short URL:</p>',t+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica"><a href="'+e.data.tiny_url+'" target="_blank">'+e.data.tiny_url+"</a></p>",DayPilot.Modal.alert(t,{theme:"modal_flat",top:50,scrollWithPage:!1})}).catch(e=>{ShortenURLFallback()})}}function CopyShareURL(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("copyurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("copyurl").value="Copy Share URL"},750))}function SaveABC(){if(gAllowSave){var e=gTheABC.value;if(0!=e.length){var t=CountTunes(),n=getDescriptiveFileName(t,!1);gIsAndroid||gIsIOS?saveABCFile("Please enter a filename for your ABC file:",n+=".txt",e):saveABCFile("Please enter a filename for your ABC file:",n+=".abc",e)}}}function SaveShareURL(){if(gAllowURLSave){var e=urltextbox.value;if(0!=e.length){var t=CountTunes(),n=getDescriptiveFileName(t,!1);saveShareURLFile("Please enter a filename for your Share URL file:",n+"_Share_URL.txt",e)}}}function TestShareURL(){if(gAllowURLSave){var e=document.getElementById("urltextbox").value;window.open(e)}}function SetAbcText(e){gTheABC.value=e}function ShowAllControls(){document.getElementById("notenrechts").style.display="inline-block",document.getElementById("toggleallcontrols").value="Hide Controls",gShowAllControls=!0}function HideAllControls(){document.getElementById("notenrechts").style.display="none",document.getElementById("toggleallcontrols").value="Show Controls",gShowAllControls=!1}function ToggleAllControls(){gAllowControlToggle&&(gShowAllControls?HideAllControls():ShowAllControls(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0))}function ShowMaximizeButton(){document.getElementById("zoombutton").style.display="block"}function HideMaximizeButton(){document.getElementById("zoombutton").style.display="none"}function DoMaximize(){document.getElementById("noscroller").style.display="none",document.getElementById("notation-spacer").style.display="none",document.getElementById("notation-holder").style.display="flex",document.getElementById("notation-holder").style.float="none",document.getElementById("zoombutton").src="img/zoomin.png",gIsMaximized=!0,HandleWindowResize(),gIsIOS||gIsAndroid||(gGotRenderDivClick=!1,gRenderDivClickOffset=-1)}function DoMinimize(){document.getElementById("noscroller").style.display="block",document.getElementById("notation-spacer").style.display="block",document.getElementById("zoombutton").src="img/zoomout.png",gIsIOS||gIsAndroid||(document.getElementById("notation-holder").style.display="inline",document.getElementById("notation-holder").style.float="left"),gIsMaximized=!1,HandleWindowResize(),!(gIsIOS||gIsAndroid)&&gGotRenderDivClick&&(-1!=gRenderDivClickOffset&&(gTheABC.selectionEnd=gTheABC.selectionStart=gRenderDivClickOffset,gTheABC.blur(),gTheABC.focus()),gGotRenderDivClick=!1,gRenderDivClickOffset=-1)}function ToggleMaximize(){if(gIsMaximized)DoMinimize(),gIsAndroid||gIsIOS?document.getElementById("notation-holder").style.width="820px":document.getElementById("notation-holder").style.width="855px";else if(DoMaximize(),gIsAndroid||gIsIOS){var e=window.innerWidth;e*gFullScreenScaling/100>820&&(document.getElementById("notation-holder").style.width=gFullScreenScaling+"%")}else{var e=window.innerWidth;e*gFullScreenScaling/100>850&&(document.getElementById("notation-holder").style.width=gFullScreenScaling+"%")}}function IdleAllowShowTabNames(){var e=GetRadioValue("notenodertab"),t=!1;switch(e){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":case"bass":t=!0}gAllowShowTabNames=!!t}function utf8tob64(e){var t;try{t=btoa(escape(e))}catch(n){t=""}return t}function b64toutf8(e){var t;try{t=unescape(atob(e))}catch(n){t=""}return t}function processShareLink(){var e=!1;let t=new URLSearchParams(window.location.search);if(t.has("base64")){let n=t.get("base64"),o=b64toutf8(n);o.length>0&&(SetAbcText(o),RestoreDefaults(),e=!0)}if(t.has("lzw")){var a=t.get("lzw");a=LZString.decompressFromEncodedURIComponent(a);let r=a;r.length>0&&(SetAbcText(r),RestoreDefaults(),e=!0)}if(t.has("format")){var l=t.get("format");("bc"==l||"cd"==l)&&(l="noten"),SetRadioValue("notenodertab",l),"whistle"==l&&PrepareWhistleFont(),gCurrentTab=l}if(t.has("capo")&&(gCapo=parseInt(t.get("capo"))),gStaffSpacing=t.has("ssp")?STAFFSPACEOFFSET+parseInt(t.get("ssp")):STAFFSPACEOFFSET+STAFFSPACEDEFAULT,t.has("stn")&&(gShowTabNames="true"==t.get("stn")),t.has("pdf")){var s=t.get("pdf");document.getElementById("pdfformat").value=s}else document.getElementById("pdfformat").value="one";if(t.has("pn")){var g=t.get("pn");document.getElementById("pagenumbers").value=g}else document.getElementById("pagenumbers").value="none";if(t.has("fp")){var d=t.get("fp");document.getElementById("firstpage").value=d}else document.getElementById("firstpage").value="yes";t.has("hide")&&"1"==t.get("hide")&&HideTopBar();var c=!1;if(t.has("play")&&"1"==t.get("play")&&(c=!0),e){var u="";if(t.has("name"))u=t.get("name");else{var A=CountTunes();u=getDescriptiveFileName(A,!1)}if(gABCFromFile=!0,gDisplayedName=u,document.getElementById("notenrechts").style.display="none",document.getElementById("toggleallcontrols").value="Show Controls",UpdateNotationTopPosition(),gShowAllControls=!1,FocusABC(),RenderAsync(!0,null,function(){if(c){var e=PreProcessPlayABC(gTheABC.value);PlayABCDialog(e)}}),gIsAndroid||gIsIOS){var p=window.innerWidth;p*gFullScreenScaling/100>820&&(document.getElementById("notation-holder").style.width=gFullScreenScaling+"%")}else{var p=window.innerWidth;p*gFullScreenScaling/100>850&&(document.getElementById("notation-holder").style.width=gFullScreenScaling+"%")}return!0}return!1}function TextBoxResizeHandler(){UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function findSelectedTuneIndex(){var e=gTheABC.value,t=e.split(/^X:/gm),n=CountTunes();if(n<2)return 0;var o=gTheABC.selectionStart;if(0==o&&(o=e.indexOf("X:")+2),0==o)return -1;var a=0;for(i=1,a=t[0].length;i<=n;++i)if(o<(a+=t[i].length+2))return i-1;return -1}function MakeTuneVisible(e){if(gAllowCopy){var t=findSelectedTuneIndex();if(gCurrentTune=t,(e||!gIsIOS&&!gIsAndroid)&&-1!=t){var n=document.getElementById("notation"+t),o=n.offsetTop,a=n.offsetHeight,r=document.getElementById("notation-spacer").offsetHeight;gIsOneColumn?o+=r:r=0;var l=window.innerHeight,s=window.scrollY,g=l-r,d=o-s-r,c=d+a;if(t!=gLastAutoScrolledTune||e){var u=o-r;window.scrollTo(0,u),gLastAutoScrolledTune=t}else if(!(d>=0&&d<g||c>0&&c<g||d<0&&d+a>g)){var u=o-r;window.scrollTo(0,u),gLastAutoScrolledTune=t}}}}function debounce(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(function(){e.apply(this,o)},t)}}function OnABCTextChange(){var e=gTotalTunes,t=CountTunes();e!=t?RenderAsync(!0,null):Render(!1,gCurrentTune)}function PrepareWhistleFont(){if(!gWhistleFontPrepared){var e=document.querySelectorAll('div[id="fontholder"] > svg > style');e[0].innerHTML+="@font-face { font-family: 'TinWhistleFingering'; src: url(data:font/truetype;charset=utf-8;base64,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) format('truetype'); font-weight: normal; font-style: normal; }",gWhistleFontPrepared=!0}}function InjectPDFHeaders(e){if(!gRenderingPDF){if(e){var t=gTheABC.value,n="";n+="%\n",n+="% Here are all available custom annotations:\n",n+="%\n",n+="%pdfquality .75\n",n+="%pdf_between_tune_space 20\n",n+="%pdfname your_pdf_filename\n",n+="%addtitle Title Page Title\n",n+="%addsubtitle Title Page Subtitle\n",n+="%urladdtitle http://michaeleskin.com Title Page Title as Hyperlink\n",n+="%urladdsubtitle http://michaeleskin.com Title Page Subtitle as Hyperlink\n",n+="%addtoc Table of Contents\n",n+="%addsortedtoc Table of Contents Sorted by Tune Name\n",n+="%addlinkbacktotoc\n",n+="%tocheader Page Header Text for Table of Contents Pages\n",n+="%toctopoffset 30\n",n+="%toctitleoffset 35\n",n+="%toctitlefontsize 18\n",n+="%tocfontsize 13\n",n+="%toclinespacing 12\n",n+="%addindex Unsorted Index\n",n+="%addsortedindex Index Sorted by Tune Name\n",n+="%addlinkbacktoindex\n",n+="%indexheader Page Header Text for Index Pages\n",n+="%indextopoffset 30\n",n+="%indextitleoffset 35\n",n+="%indextitlefontsize 18\n",n+="%indexfontsize 13\n",n+="%indexlinespacing 12\n",n+="%no_toc_or_index_links\n",n+="%pageheader Page Header\n",n+="%pagefooter Page Footer\n",n+="%urlpageheader http://michaeleskin.com Page Header as Hyperlink\n",n+="%urlpagefooter http://michaeleskin.com Page Footer as Hyperlink\n",n+="%add_all_links_to_thesession\n",n+="%add_all_playback_links 0 0\n",n+="%qrcode\n",n+="%qrcode http://michaeleskin.com\n",n+="%caption_for_qrcode Caption for the QR code\n",n+="%\n",n+="% These directives can be added to each tune:\n",n+="%hyperlink http://michaeleskin.com\n",n+="%add_link_to_thesession\n",n+="%add_playback_link 0 0\n",n+="\n",n+=t,gTheABC.value=n,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus();return}if(!gRenderingPDF){var t=gTheABC.value,n="";n+="%\n",n+="% Here is a useful template of annotations for a PDF tunebook:\n",n+="%\n",n+="%pdfquality .75\n",n+="%pdf_between_tune_space 20\n",n+="%addtitle Tunebook Title\n",n+="%addsubtitle Tunebook Subtitle\n",n+="%addtoc Table of Contents\n",n+="%addlinkbacktotoc\n",n+="%addsortedindex Index\n",n+="%addlinkbacktoindex\n",n+="%pageheader This is the Page Header\n",n+="%pagefooter This is the Page Footer\n",n+="%add_all_playback_links 0 0\n",n+="%qrcode http://michaeleskin.com\n",n+="%caption_for_qrcode Click or Scan to Visit my Home Page\n",n+="\n",n+=t,gTheABC.value=n,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}}function InjectOneTuneABCNoteNameLyrics(e){var t=escape(e).split("%0A"),n="",o="";for(i=0;i<t.length;++i){var a=(o=unescape(t[i])).split("");if("|"!=a[0]&&"["!=a[0]&&":"==a[1])n+=o+"\n","X"==a[0]&&(n+="%%vocalfont Times-Roman 13.5\n");else if("%"==a[0])n+=o+"\n";else if(""!=(o=o.trim())){n+=o+"\n";var r=/"[^"]*"/gm;o=o.replace(r,"");var r=/{[^{]*}/gm;o=o.replace(r,""),r=/[^ABCDEFGabcdefg|]*/gm,o=(a=(o=o.replace(r,"")).split("")).join(" "),r=/\| \|/gm,n+="w: "+(o=o.replace(r,"|"))+"\n"}else n+=o}return n+"\n"}function InjectABCNoteNameLyrics(){if(!gRenderingPDF){for(var e=CountTunes(),t=gTheABC.value.split(/^X:/gm),n="",o=1;o<=e;++o)t[o]="X:"+t[o],n+=InjectOneTuneABCNoteNameLyrics(t[o]);gTheABC.value=n,RenderAsync(!0,null),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}function DoInjectABCNoteNameLyrics(){InjectABCNoteNameLyrics(),RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_BC(){SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="0",gTheABC.value=boxTabGenerator(gTheABC.value),gStripChords=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_CsD(){SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="1",gTheABC.value=boxTabGenerator(gTheABC.value),gStripChords=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_Anglo(){SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=angloFingeringsGenerator(gTheABC.value),gStripChords=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_Bamboo_Flute(){let e={configure_bamboo_flute_key:gBambooFluteKey};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:50px;">Inject Bamboo Flute Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://en.m.wikipedia.org/wiki/Numbered_musical_notation" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:14pt;font-family:helvetica">This will inject numeric notation tablature for a bamboo flute in the key selected below into all of the tunes in the ABC text area:</p>'},{name:"Bamboo flute key:",id:"configure_bamboo_flute_key",type:"select",options:[{name:"  C",id:"0"},{name:"  D",id:"1"},{name:"  G",id:"2"},{name:"  A",id:"3"},],cssClass:"configure_box_settings_select"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:14pt;font-family:helvetica">&nbsp;</p>'},],e,{theme:"modal_flat",top:200,width:500,scrollWithPage:!1}).then(function(e){e.canceled||(gBambooFluteKey=e.result.configure_bamboo_flute_key,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=bambooFluteTabGenerator(gTheABC.value),gStripChords=!1,RenderAsync(!0,null),IdleAdvancedControls(!0))})}function ChangeTab(){var e=GetRadioValue("notenodertab");"whistle"==e&&PrepareWhistleFont(),e!=gCurrentTab&&RenderAsync(!0,null),gCurrentTab=e}function FocusABC(){gTheABC.focus(),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.scrollTo(0,0)}function fadeOutAndHide(e,t){var n=setInterval(function(){e.style.opacity||(e.style.opacity=1),e.style.opacity>0?e.style.opacity-=.1:(clearInterval(n),e.style.display="none",t())},100)}function ShowTopBar(){var e=document.getElementById("topbar");e.style.display="block",e.style.opacity=1,gTopBarShowing=!0;var e=document.getElementById("abc-selected");e.style.marginTop="15px",e.style.marginBottom="1px",(e=document.getElementById("toggletopbar")).value="▲"}function HideTopBar(){var e=document.getElementById("topbar");e.style.display="none",gTopBarShowing=!1;var e=document.getElementById("abc-selected");gIsIPhone||gIsAndroid?(e.style.marginTop="18px",e.style.marginBottom="38px"):e.style.marginTop="4px",(e=document.getElementById("toggletopbar")).value="▼"}function ToggleTopBar(){gTopBarShowing?HideTopBar():ShowTopBar(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0),UpdateLocalStorage()}function HandleWindowResize(){if(!(gIsIOS||gIsAndroid)){if(gIsMaximized){var e=document.getElementById("app-container");e.style.marginLeft="0px"}else{var t=window.innerWidth;if(t<1798){var n=(t-850)/2,e=document.getElementById("app-container");e.style.marginLeft=n+"px",gTheABC.rows=12,gIsOneColumn=!0}else{var e=document.getElementById("app-container"),n=(t-1700)/2;e.style.marginLeft=n+"px";var o=window.innerHeight,a=(o-=540)/30;a<12&&(a=12),gTheABC.rows=a,gIsOneColumn=!1}}}}function isIOS(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isIPhone(){return!!/iPad|iPhone|iPod/.test(navigator.platform)}function isIPad(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isAndroid(){return!!/Android/i.test(navigator.userAgent)}function isSafari(){return!!(/Safari/i.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))}function isChrome(){return!!/chrome|chromium|crios/i.test(navigator.userAgent)}function isFirstRun(){return!localStorage.abcTab&&!localStorage.abcTunesPerPage&&!localStorage.abcPageNumberLocation&&!localStorage.abcPageNumberOnPageOne&&!localStorage.abcStaffSpacing&&!localStorage.abcHideTopBar}function restoreStateFromLocalStorage(){var e=isFirstRun(),t=localStorage.abcTab;t&&(SetRadioValue("notenodertab",t),"whistle"==t&&PrepareWhistleFont(),gCurrentTab=t);var n=localStorage.abcTunesPerPage;n&&(document.getElementById("pdfformat").value=n);var o=localStorage.abcPageNumberLocation;o&&(document.getElementById("pagenumbers").value=o);var a=localStorage.abcPageNumberOnPageOne;a&&(document.getElementById("firstpage").value=a);var r=localStorage.abcCapo;r&&(gCapo=parseInt(r));var l=localStorage.abcStaffSpacing;l&&(gStaffSpacing=STAFFSPACEOFFSET+parseInt(l));var s=localStorage.abcHideTopBar;s&&"true"==s&&HideTopBar(),e&&(UpdateLocalStorage(),showWelcomeScreen())}function showWelcomeScreen(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"><strong>Read the <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> for instructions and demo videos.</strong></p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">To begin, type or paste tunes in ABC format into the text area.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Each ABC tune <strong>must</strong> begin with an X: tag.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Notation updates instantly as you make changes.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click <strong>Add</strong> to add a new ABC tune template.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click <strong>Open</strong> to open and import an ABC text file from your system.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click <strong>Settings</strong> to set common tools settings and select the default instrument sounds and volumes to use when playing tunes.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"><strong>Once ABC has been entered and notation is displayed:</strong></p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">• Click the <strong>Zoom-Out</strong> arrows at the upper-right to view notation fullscreen.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">• Click <strong>Save</strong> to save all the ABC text to an ABC text file.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">• Click <strong>Export PDF</strong> to export your tunebook in PDF format.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">• Click <strong>Copy All</strong> to copy all the ABC text to the clipboard.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">• Click <strong>Player</strong> to play the tune currently being edited.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">If you find this tool useful, please <strong><a href="donate.html" target="_blank" title="Michael likes beer!">Buy Michael a Beer!</a></strong></p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:!1})}function showZoomInstructionsScreen(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Since this is your first time using the tool, here is some useful information:</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">If you would like to edit or create a PDF tunebook from the notation:</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click the <strong>Zoom-In</strong> arrows at the upper-right to open the ABC editor.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">In the ABC editor, click the <strong>Zoom-Out</strong> arrows to view notation fullscreen.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">All controls in the ABC editor have helpful tooltips.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Read the <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> for instructions and demo videos.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:!1})}var gMIDIbuffer=null,gPlayerABC=null;function GetTuneAudioDownloadName(e,t){var n=escape(e),o=n.split("%0D%0A");o=n.split("%0A");for(var a=0;a<o.length;++a){o[a]=unescape(o[a]);var r=o[a].split("");if("T"==r[0]&&":"==r[1]){var l=o[a].slice(2);return(l=(l=(l=l.trim()).replace(/[ ]+/ig,"_")).replace(/[^a-zA-Z0-9_\-.]+/ig,""))+t}}return"output"+t}function isJigWithNoTiming(e,t){var n=escape(e),o=n.split("%0D%0A");o=n.split("%0A");for(var a=!1,r=!1,l=!1,s=!1,g=t,d=0;d<o.length;++d){o[d]=unescape(o[d]);var c=o[d].split("");if("Q"==c[0]&&":"==c[1]&&(a=!0),"M"==c[0]&&":"==c[1]){var u=o[d].replace("M:","");-1!=(u=u.trim()).indexOf("12/8")&&(s=!0,g=2e3),-1!=u.indexOf("6/8")&&(r=!0,g=1e3),-1!=u.indexOf("9/8")&&(l=!0,g=1500)}}return(r||l||s)&&!a?g:t}function DownloadWave(){gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure);var e=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=e,gMIDIbuffer.prime().then(function(e){var t=gMIDIbuffer.download(),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("style","display: none;"),n.href=t,n.download=GetTuneAudioDownloadName(gPlayerABC,".wav"),n.click(),window.URL.revokeObjectURL(t),document.body.removeChild(n)}).catch(function(e){DayPilot.Modal.alert("A problem occured when exporting the .wav file.",{theme:"modal_flat",top:50,scrollWithPage:!1})})}var gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;function getTuneTitle(e){var t=escape(e),n=t.split("%0D%0A");n=t.split("%0A");for(var o="",a=0;a<n.length;++a){n[a]=unescape(n[a]);var r=n[a].split("");if("T"==r[0]&&":"==r[1]){o=(o=n[a].slice(2)).trim();break}}return o}function BatchMP3Export(){if(gIsIOS||gIsAndroid){DayPilot.Modal.alert("Batch export to .MP3 not supported on iOS or Android at this time.",{theme:"modal_flat",top:400,scrollWithPage:!1,okText:"Ok"});return}function e(e){o--,e.click(),gBatchMP3ExportCancelRequested||(0!=o?setTimeout(function(){var e=getTuneByIndex(++a);e=PreProcessPlayABC(e);var o=getTuneTitle(e);gTheBatchMP3ExportStatusText.innerText="Exporting .MP3 for tune "+(a+1)+" of "+n+": "+o,PlayABCDialog(e,t,a)},1e3):(gTheBatchMP3ExportOKButton.click(),gBatchMP3ExportCancelRequested=!1))}function t(t,n){DownloadMP3(e,n)}var n,o=CountTunes();if(0!=o){n=o;var a=0;gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null,DayPilot.Modal.alert("Exporting .MP3 for tune "+(a+1)+" of "+n,{theme:"modal_flat",top:400,scrollWithPage:!1,okText:"Cancel"}).then(function(e){gBatchMP3ExportCancelRequested=!0});var r=document.getElementsByClassName("modal_flat_main");r[r.length-1].style.zIndex=100001;var l=document.getElementsByClassName("modal_flat_ok"),s=null;for(i=0;i<l.length;++i)if("Cancel"==(s=l[i]).innerText){gTheBatchMP3ExportOKButton=s;break}var g=document.getElementsByClassName("modal_flat_content");(gTheBatchMP3ExportStatusText=g[g.length-1]).style.textAlign="center";var d=getTuneByIndex(a);d=PreProcessPlayABC(d);var c=getTuneTitle(d);return gTheBatchMP3ExportStatusText.innerText="Exporting .MP3 for tune "+(a+1)+" of "+n+": "+c,PlayABCDialog(d,t,a),!0}}var gInDownloadMP3=!1;function DownloadMP3(e,t){if(gInDownloadMP3)return!1;gInDownloadMP3=!0,gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure);var n=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=n,gMIDIbuffer.prime().then(function(n){document.getElementById("abcplayer_mp3button").value="Encoding .MP3",document.getElementById("loading-bar-spinner").style.display="block",setTimeout(async function(){var n=await fetch(gMIDIbuffer.download()).then(e=>e.blob()),o=new FileReader;o.onload=function(n){var o=function e(t){var n,o=function e(t){function n(e,n){for(var o=0,a=0;n;)o+=t[e]<<a,a+=8,e++,n--;return o}return{sampleRate:n(24,4),bitsPerSample:n(34,2),samples:t.subarray(44)}}(new Uint8Array(t)),a=o.samples.length,r=a/4,l=o.sampleRate,s=new lamejs.Mp3Encoder(2,l,gMP3Bitrate),g=[],d=new Int16Array(o.samples.buffer);for(let c=0;c<882;c++)d[c]=0;let u=Math.ceil(a/2);var A=new Int16Array(u),p=new Int16Array(a-u);for(let m=0;m<2*r;m++)m%2==0?A[m/2]=d[m]:p[(m-1)/2]=d[m];for(var h=0;h<r;h+=1152){var T=A.subarray(h,h+1152),f=p.subarray(h,h+1152),I=s.encodeBuffer(T,f);I.length>0&&g.push(I)}var I=s.flush();return I.length>0&&g.push(I),g}(n.target.result),a=new Blob(o,{type:"audio/mp3"}),r=window.URL.createObjectURL(a),l=document.createElement("a");document.body.appendChild(l),l.setAttribute("style","display: none;"),l.href=r,l.download=GetTuneAudioDownloadName(gPlayerABC,".mp3"),l.click(),window.URL.revokeObjectURL(r),document.body.removeChild(l),document.getElementById("abcplayer_mp3button").value="Download .MP3",document.getElementById("loading-bar-spinner").style.display="none",gInDownloadMP3=!1,e&&e(t)},o.readAsArrayBuffer(n)},100)}).catch(function(e){DayPilot.Modal.alert("A problem occured when exporting the .mp3 file.",{theme:"modal_flat",top:50,scrollWithPage:!1}),document.getElementById("abcplayer_mp3button").value="Download .MP3",document.getElementById("loading-bar-spinner").style.display="none",gInDownloadMP3=!1})}function DownloadMIDI(){var e=ABCJS.synth.getMidiFile(gPlayerABC,{midiOutputType:"link"})[0];e=e.replace("<a download",'<a id="downloadmidilink" download');var t=document.createElement("div");t.innerHTML=e,t.setAttribute("style","display: none;"),document.body.appendChild(t),document.getElementById("downloadmidilink").click(),document.body.removeChild(t)}function computeFade(e){var t=200,n=/^%%MIDI program.*$/m,o=e.match(n);if(o&&o.length>0){var a=o[0].replace("%%MIDI program",""),r=(a=a.trim()).split(" ");if(r&&r.length>0){var l=r[0];switch(l){case"15":t=4e3;break;case"21":case"73":case"78":case"129":case"130":case"131":case"132":case"133":case"134":case"135":t=100}}}n=/^%%MIDI chordprog.*$/m;var s=e.match(n);if(s&&s.length>0){var a=s[0].replace("%%MIDI chordprog",""),r=(a=a.trim()).split(" ");if(r&&r.length>0){var l=r[0];"15"===l&&(t=4e3)}}return t}function postProcessTab(e,t,n){if("whistle"==t){for(x=0,o=n?document.querySelectorAll('div[id="'+e+'"] > svg > g > g > [class="abcjs-top-line"]'):document.querySelectorAll('div[id="'+e+'"] > div > svg > g > g > [class="abcjs-top-line"]');x<o.length;x++)if(x%2!=0){o[x].setAttribute("class","tabstrich");var o,a,r=getNextSiblings(o[x]);for(y=0;y<r.length;y++)r[y].setAttribute("class","tabstrich")}for(x=0,a=n?document.querySelectorAll('div[id="'+e+'"] > svg > g > g[data-name="tabNumber"] > text > tspan'):document.querySelectorAll('div[id="'+e+'"] > div > svg > g > g[data-name="tabNumber"] > text > tspan');x<a.length;x++)a[x].setAttribute("class","whistle"),a[x].setAttribute("dy","-7"),"0"==a[x].innerHTML?a[x].innerHTML="g":"1"==a[x].innerHTML?a[x].innerHTML="m":"2"==a[x].innerHTML?a[x].innerHTML="a":"3"==a[x].innerHTML?a[x].innerHTML="i":"4"==a[x].innerHTML?a[x].innerHTML="b":"5"==a[x].innerHTML?a[x].innerHTML="c":"6"==a[x].innerHTML?a[x].innerHTML="j":"7"==a[x].innerHTML?a[x].innerHTML="d":"8"==a[x].innerHTML?a[x].innerHTML="k":"9"==a[x].innerHTML?a[x].innerHTML="e":"10"==a[x].innerHTML?a[x].innerHTML="f":"11"==a[x].innerHTML?a[x].innerHTML="l":"12"==a[x].innerHTML?a[x].innerHTML="g":"13"==a[x].innerHTML?a[x].innerHTML="m":"14"==a[x].innerHTML?a[x].innerHTML="a":"15"==a[x].innerHTML?a[x].innerHTML="i":"16"==a[x].innerHTML?a[x].innerHTML="b":"17"==a[x].innerHTML?a[x].innerHTML="c":"18"==a[x].innerHTML?a[x].innerHTML="j":"19"==a[x].innerHTML?a[x].innerHTML="D":"20"==a[x].innerHTML?a[x].innerHTML="K":"21"==a[x].innerHTML?a[x].innerHTML="E":"22"==a[x].innerHTML?a[x].innerHTML="F":"23"==a[x].innerHTML?a[x].innerHTML="L":"24"==a[x].innerHTML?a[x].innerHTML="G":"25"==a[x].innerHTML?a[x].innerHTML="M":"26"==a[x].innerHTML?a[x].innerHTML="A":"27"==a[x].innerHTML?a[x].innerHTML="I":"28"==a[x].innerHTML?a[x].innerHTML="B":"29"==a[x].innerHTML?a[x].innerHTML="C":"30"==a[x].innerHTML?a[x].innerHTML="J":"31"==a[x].innerHTML?a[x].innerHTML="D":"32"==a[x].innerHTML?a[x].innerHTML="K":"33"==a[x].innerHTML?a[x].innerHTML="E":"34"==a[x].innerHTML?a[x].innerHTML="F":"35"==a[x].innerHTML?a[x].innerHTML="L":"36"==a[x].innerHTML?a[x].innerHTML="G":"37"==a[x].innerHTML?a[x].innerHTML="M":"38"==a[x].innerHTML&&(a[x].innerHTML="A")}if("notenames"==t){var o,l=!0;for(x=0,o=n?document.querySelectorAll('div[id="'+e+'"] > svg > g > g > [class="abcjs-top-line"]'):document.querySelectorAll('div[id="'+e+'"] > div > svg > g > g > [class="abcjs-top-line"]');x<o.length;x++)if(x%2!=0){o[x].setAttribute("class","tabstrich");var r=getNextSiblings(o[x]);for(y=0;y<r.length;y++)r[y].setAttribute("class","tabstrich")}Svgs=n?document.querySelectorAll('div[id="'+e+'"] > svg'):document.querySelectorAll('div[id="'+e+'"] > div > svg');var s=1;if(n&&(s=0),Svgs&&Svgs.length>s)for(var g=s;g<Svgs.length;++g){l=!0;var d=Svgs[g],c=d.querySelectorAll('g[data-name="staff-extra key-signature"]');c&&c.length>=1&&-1!=c[0].innerHTML.indexOf("accidentals.flat")&&(l=!1);var a=d.querySelectorAll('g[data-name="tabNumber"] > text > tspan');if(l)for(x=0;x<a.length;x++)"0"==a[x].innerHTML?a[x].innerHTML="G,":"1"==a[x].innerHTML?a[x].innerHTML="G♯,":"2"==a[x].innerHTML?a[x].innerHTML="A,":"3"==a[x].innerHTML?a[x].innerHTML="A♯,":"4"==a[x].innerHTML?a[x].innerHTML="B,":"5"==a[x].innerHTML?a[x].innerHTML="C":"6"==a[x].innerHTML?a[x].innerHTML="C♯":"7"==a[x].innerHTML?a[x].innerHTML="D":"8"==a[x].innerHTML?a[x].innerHTML="D♯":"9"==a[x].innerHTML?a[x].innerHTML="E":"10"==a[x].innerHTML?a[x].innerHTML="F":"11"==a[x].innerHTML?a[x].innerHTML="F♯":"12"==a[x].innerHTML?a[x].innerHTML="G":"13"==a[x].innerHTML?a[x].innerHTML="G♯":"14"==a[x].innerHTML?a[x].innerHTML="A":"15"==a[x].innerHTML?a[x].innerHTML="A♯":"16"==a[x].innerHTML?a[x].innerHTML="B":"17"==a[x].innerHTML?a[x].innerHTML="c":"18"==a[x].innerHTML?a[x].innerHTML="c♯":"19"==a[x].innerHTML?a[x].innerHTML="d":"20"==a[x].innerHTML?a[x].innerHTML="d♯":"21"==a[x].innerHTML?a[x].innerHTML="e":"22"==a[x].innerHTML?a[x].innerHTML="f":"23"==a[x].innerHTML?a[x].innerHTML="f♯":"24"==a[x].innerHTML?a[x].innerHTML="g":"25"==a[x].innerHTML?a[x].innerHTML="g♯":"26"==a[x].innerHTML?a[x].innerHTML="a":"27"==a[x].innerHTML?a[x].innerHTML="a♯":"28"==a[x].innerHTML?a[x].innerHTML="b":"29"==a[x].innerHTML?a[x].innerHTML="c'":"30"==a[x].innerHTML?a[x].innerHTML="c♯'":"31"==a[x].innerHTML?a[x].innerHTML="d'":"32"==a[x].innerHTML?a[x].innerHTML="d♯'":"33"==a[x].innerHTML?a[x].innerHTML="e'":"34"==a[x].innerHTML?a[x].innerHTML="f'":"35"==a[x].innerHTML?a[x].innerHTML="f♯'":"36"==a[x].innerHTML?a[x].innerHTML="g'":"37"==a[x].innerHTML?a[x].innerHTML="g♯'":"38"==a[x].innerHTML?a[x].innerHTML="a'":"39"==a[x].innerHTML?a[x].innerHTML="a♯'":"40"==a[x].innerHTML?a[x].innerHTML="b'":a[x].innerHTML="?";else for(x=0;x<a.length;x++)"0"==a[x].innerHTML?a[x].innerHTML="G,":"1"==a[x].innerHTML?a[x].innerHTML="A♭,":"2"==a[x].innerHTML?a[x].innerHTML="A,":"3"==a[x].innerHTML?a[x].innerHTML="B♭,":"4"==a[x].innerHTML?a[x].innerHTML="B,":"5"==a[x].innerHTML?a[x].innerHTML="C":"6"==a[x].innerHTML?a[x].innerHTML="D♭":"7"==a[x].innerHTML?a[x].innerHTML="D":"8"==a[x].innerHTML?a[x].innerHTML="E♭":"9"==a[x].innerHTML?a[x].innerHTML="E":"10"==a[x].innerHTML?a[x].innerHTML="F":"11"==a[x].innerHTML?a[x].innerHTML="G♭":"12"==a[x].innerHTML?a[x].innerHTML="G":"13"==a[x].innerHTML?a[x].innerHTML="A♭":"14"==a[x].innerHTML?a[x].innerHTML="A":"15"==a[x].innerHTML?a[x].innerHTML="B♭":"16"==a[x].innerHTML?a[x].innerHTML="B":"17"==a[x].innerHTML?a[x].innerHTML="c":"18"==a[x].innerHTML?a[x].innerHTML="d♭":"19"==a[x].innerHTML?a[x].innerHTML="d":"20"==a[x].innerHTML?a[x].innerHTML="e♭":"21"==a[x].innerHTML?a[x].innerHTML="e":"22"==a[x].innerHTML?a[x].innerHTML="f":"23"==a[x].innerHTML?a[x].innerHTML="g♭":"24"==a[x].innerHTML?a[x].innerHTML="g":"25"==a[x].innerHTML?a[x].innerHTML="a♭":"26"==a[x].innerHTML?a[x].innerHTML="a":"27"==a[x].innerHTML?a[x].innerHTML="b♭":"28"==a[x].innerHTML?a[x].innerHTML="b":"29"==a[x].innerHTML?a[x].innerHTML="c'":"30"==a[x].innerHTML?a[x].innerHTML="d♭'":"31"==a[x].innerHTML?a[x].innerHTML="d'":"32"==a[x].innerHTML?a[x].innerHTML="e♭'":"33"==a[x].innerHTML?a[x].innerHTML="e'":"34"==a[x].innerHTML?a[x].innerHTML="f'":"35"==a[x].innerHTML?a[x].innerHTML="g♭'":"36"==a[x].innerHTML?a[x].innerHTML="g'":"37"==a[x].innerHTML?a[x].innerHTML="a♭'":"38"==a[x].innerHTML?a[x].innerHTML="a'":"39"==a[x].innerHTML?a[x].innerHTML="b♭'":"40"==a[x].innerHTML?a[x].innerHTML="b'":a[x].innerHTML="?"}}}function PlayABCDialog(e,t,n){gMIDIbuffer=null,gPlayerABC=e,gTheOKButton=null;var o,a=GetRadioValue("notenodertab"),r=GetABCJSParams(a);function l(){o&&(o.destroy(),o=null)}r.oneSvgPerLine=!1,"noten"!=a&&r.tablature&&r.tablature.length>0&&(r.tablature[0].label="");var s=new function e(){var t=this;t.onReady=function(){},t.onStart=function(){var e=document.querySelector("#playback-paper svg"),t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("class","abcjs-cursor"),t.setAttributeNS(null,"x1",0),t.setAttributeNS(null,"y1",0),t.setAttributeNS(null,"x2",0),t.setAttributeNS(null,"y2",0),e.appendChild(t)},t.beatSubdivisions=2,t.onBeat=function(e,t,n){},t.onEvent=function(e){if(!e.measureStart||null!==e.left){for(var t=document.querySelectorAll("#playback-paper svg .highlight"),n=0;n<t.length;n++)t[n].classList.remove("highlight");for(var o=0;o<e.elements.length;o++)for(var a=e.elements[o],r=0;r<a.length;r++)a[r].classList.add("highlight");var l=document.querySelector("#playback-paper svg .abcjs-cursor");l&&(l.setAttribute("x1",e.left-2),l.setAttribute("x2",e.left-2),l.setAttribute("y1",e.top),l.setAttribute("y2",e.top+e.height))}},t.onFinished=function(){for(var e=document.querySelectorAll("svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#playback-paper svg .abcjs-cursor");n&&(n.setAttribute("x1",0),n.setAttribute("x2",0),n.setAttribute("y1",0),n.setAttribute("y2",0))}};!function g(){modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p style="text-align:center;margin:0px;margin-top:18px">',modal_msg+='<input id="abcplayer_wavbutton" class="abcplayer_wavbutton btn btn-wavedownload" onclick="DownloadWave();" type="button" value="Download .WAV" title="Downloads the audio for the current tune as a .WAV file">',modal_msg+='<input id="abcplayer_mp3button" class="abcplayer_mp3button btn btn-mp3download" onclick="DownloadMP3();" type="button" value="Download .MP3" title="Downloads the audio for the current tune as a .MP3 file">',modal_msg+='<input id="abcplayer_midibutton" class="abcplayer_midibutton btn btn-mididownload" onclick="DownloadMIDI();" type="button" value="Download MIDI" title="Downloads the current tune as a MIDI file">',modal_msg+="</p>";var d,c,u,A=window.innerWidth;GetRadioValue("notenodertab");var p=.45*A;gIsAndroid||gIsIOS?p=820:p<850&&(p=850),DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:p,okText:"Close",scrollWithPage:!1});var m=document.getElementsByClassName("modal_flat_ok"),h=null;for(i=0;i<m.length;++i)if("Close"==(h=m[i]).innerText){gTheOKButton=h;var T=h.onclick;h.onclick=function(){T(),l(),gTheABC.focus()};break}ABCJS.synth.supportsAudio()?(o=new ABCJS.synth.SynthController).load("#playback-audio",s,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",d=!1,o.disable(!0),c=ABCJS.renderAbc("playback-paper",e,r)[0],postProcessTab("playback-paper",a,!0),gMIDIbuffer=u=new ABCJS.synth.CreateSynth,u.init({visualObj:c}).then(function(a){if(console.log(a),o){var r=computeFade(e);o.setTune(c,d,{fadeLength:r}).then(function(e){console.log("Audio successfully loaded."),t&&t(n,gTheOKButton)}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")})}()}function PreProcessPlayABC(e){if(gOverridePlayMIDIParams&&(e=OverrideOneTuneMIDIParams(e,gTheMelodyProgram,gTheChordProgram,gTheBassVolume,gTheChordVolume)),gAlwaysInjectPrograms){var t=/^%%MIDI chordprog.*$/m,n=e.match(t);n&&n.length>0||(e=InjectOneTuneMIDIProgram(e,gTheChordProgram,!0)),t=/^%%MIDI program.*$/m;var o=e.match(t);o&&o.length>0||(e=InjectOneTuneMIDIProgram(e,gTheMelodyProgram,!1))}if(gAlwaysInjectVolumes){var t=/^%%MIDI bassvol.*$/m,a=e.match(t);a&&a.length>0||(e=InjectOneTuneMIDIVolume(e,gTheBassVolume,!1));var t=/^%%MIDI chordvol.*$/m,r=e.match(t);r&&r.length>0||(e=InjectOneTuneMIDIVolume(e,gTheChordVolume,!0))}return e}var gAlwaysInjectPrograms=!0,gTheMelodyProgram=0,gTheChordProgram=0,gAlwaysInjectVolumes=!0,gTheBassVolume=32,gTheChordVolume=32,gOverridePlayMIDIParams=!1,gInjectTab_StripChords=!0,gInjectTab_InjectVolumeDirectives=!0,gInjectTab_FontFamily="Palatino",gInjectTab_TabFontSize=11,gInjectTab_StaffSep=80,gInjectTab_MusicSpace=10,gInjectTab_TabLocation=0,gInjectTab_ConcertinaStyle=0,gInjectTab_ConcertinaFingering=0,gInjectTab_PushGlyph="↓",gInjectTab_DrawGlyph="↑",gInjectTab_UseBarForDraw=!1,gLargePlayerControls=!1,gBambooFluteKey=1;function GetInitialConfigurationSettings(){var e=localStorage.AlwaysInjectPrograms;gAlwaysInjectPrograms=!e||"true"==e,gTheMelodyProgram=(e=localStorage.TheMelodyProgram)?e:0,gTheChordProgram=(e=localStorage.TheChordProgram)?e:0,gAlwaysInjectVolumes=!(e=localStorage.AlwaysInjectVolumes)||"true"==e,gTheBassVolume=(e=localStorage.TheBassVolume)?e:32,gTheChordVolume=(e=localStorage.TheChordVolume)?e:32,gOverridePlayMIDIParams=!!(e=localStorage.OverridePlayMIDIParams)&&"true"==e,gInjectTab_FontFamily=(e=localStorage.InjectTab_FontFamily)?e:"Palatino",gInjectTab_InjectVolumeDirectives=!(e=localStorage.InjectTab_InjectVolumeDirectives)||"true"==e,gInjectTab_TabFontSize=(e=localStorage.InjectTab_TabFontSize)?e:10,gInjectTab_StaffSep=(e=localStorage.InjectTab_StaffSep)?e:80,gInjectTab_MusicSpace=(e=localStorage.InjectTab_MusicSpace)?e:10,gInjectTab_TabLocation=(e=localStorage.InjectTab_TabLocation)?e:0,gInjectTab_ConcertinaStyle=(e=localStorage.InjectTab_ConcertinaStyle)?e:0,gInjectTab_ConcertinaFingering=(e=localStorage.InjectTab_ConcertinaFingering)?e:1,gInjectTab_StripChords=!(e=localStorage.InjectTab_StripChords)||"true"==e,gInjectTab_PushGlyph=(e=localStorage.InjectTab_PushGlyph)?e:"↓",gInjectTab_DrawGlyph=(e=localStorage.InjectTab_DrawGlyph)?e:"↑",gInjectTab_UseBarForDraw=!!(e=localStorage.InjectTab_UseBarForDraw)&&"true"==e,gFullScreenScaling=(e=localStorage.FullScreenScaling)?e:50;var t=localStorage.angloButtonNames;t?gAngloButtonNames=JSON.parse(t):resetAngloButtonNames();var n=localStorage.musicXMLImportOptions;n?gMusicXMLImportOptions=JSON.parse(n):resetMusicXMLImportOptions(),gLargePlayerControls=!!(e=localStorage.LargePlayerControls)&&"true"==e,gBambooFluteKey=(e=localStorage.BambooFluteKey)?e:1;var o=localStorage.RenderingFonts;o?gRenderingFonts=JSON.parse(o):resetABCRenderingFonts();var a=localStorage.abcShowTabNames;gShowTabNames=!a||"true"==a,gCapo=(e=localStorage.abcCapo)?e:0,gMP3Bitrate=(e=localStorage.MP3Bitrate)?e:224,SaveConfigurationSettings()}function SaveConfigurationSettings(){gLocalStorageAvailable&&(localStorage.AlwaysInjectPrograms=gAlwaysInjectPrograms,localStorage.TheMelodyProgram=gTheMelodyProgram,localStorage.TheChordProgram=gTheChordProgram,localStorage.AlwaysInjectVolumes=gAlwaysInjectVolumes,localStorage.TheBassVolume=gTheBassVolume,localStorage.TheChordVolume=gTheChordVolume,localStorage.OverridePlayMIDIParams=gOverridePlayMIDIParams,localStorage.InjectTab_StripChords=gInjectTab_StripChords,localStorage.InjectTab_InjectVolumeDirectives=gInjectTab_InjectVolumeDirectives,localStorage.InjectTab_FontFamily=gInjectTab_FontFamily,localStorage.InjectTab_TabFontSize=gInjectTab_TabFontSize,localStorage.InjectTab_StaffSep=gInjectTab_StaffSep,localStorage.InjectTab_MusicSpace=gInjectTab_MusicSpace,localStorage.InjectTab_TabLocation=gInjectTab_TabLocation,localStorage.InjectTab_ConcertinaStyle=gInjectTab_ConcertinaStyle,localStorage.InjectTab_ConcertinaFingering=gInjectTab_ConcertinaFingering,localStorage.InjectTab_PushGlyph=gInjectTab_PushGlyph,localStorage.InjectTab_DrawGlyph=gInjectTab_DrawGlyph,localStorage.InjectTab_UseBarForDraw=gInjectTab_UseBarForDraw,localStorage.FullScreenScaling=gFullScreenScaling,localStorage.angloButtonNames=JSON.stringify(gAngloButtonNames),localStorage.musicXMLImportOptions=JSON.stringify(gMusicXMLImportOptions),localStorage.LargePlayerControls=gLargePlayerControls,localStorage.BambooFluteKey=gBambooFluteKey,localStorage.RenderingFonts=JSON.stringify(gRenderingFonts),gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false",localStorage.abcCapo=gCapo,localStorage.MP3Bitrate=gMP3Bitrate)}var gMusicXMLImportOptions={};function resetMusicXMLImportOptions(){gMusicXMLImportOptions={b:3,n:0,c:0,v:0,d:0,x:1,noped:0,p:"",v1:0,stm:0,s:0,t:0,u:0,v:0,v1:0,mnum:-1,m:1}}function setMusicXMLOptions(){gMusicXMLImportOptions.u=$("#musicxml_unfld").prop("checked")?1:0,gMusicXMLImportOptions.b=parseInt($("#musicxml_bpl").val()||3),gMusicXMLImportOptions.n=parseInt($("#musicxml_cpl").val()||0),gMusicXMLImportOptions.c=parseInt($("#musicxml_crf").val()||0),gMusicXMLImportOptions.d=parseInt($("#musicxml_den").val()||0),gMusicXMLImportOptions.m=parseInt($("#musicxml_midi").val()||0),gMusicXMLImportOptions.x=$("#musicxml_nlb").prop("checked")?1:0,gMusicXMLImportOptions.noped=$("#musicxml_noped").prop("checked")?1:0,gMusicXMLImportOptions.v1=$("#musicxml_v1").prop("checked")?1:0,gMusicXMLImportOptions.stm=$("#musicxml_stems").prop("checked")?1:0,gMusicXMLImportOptions.mnum=parseInt($("#musicxml_mnum").val()||-1)}function idleXMLImport(){$("#musicxml_unfld").prop("checked",1==gMusicXMLImportOptions.u),$("#musicxml_bpl").val(gMusicXMLImportOptions.b),$("#musicxml_cpl").val(gMusicXMLImportOptions.n),$("#musicxml_crf").val(gMusicXMLImportOptions.c),$("#musicxml_den").val(gMusicXMLImportOptions.d),$("#musicxml_midi").val(gMusicXMLImportOptions.m),$("#musicxml_nlb").prop("checked",1==gMusicXMLImportOptions.x),$("#musicxml_noped").prop("checked",1==gMusicXMLImportOptions.noped),$("#musicxml_v1").prop("checked",1==gMusicXMLImportOptions.v1),$("#musicxml_stems").prop("checked",1==gMusicXMLImportOptions.stm),$("#musicxml_mnum").val(gMusicXMLImportOptions.mnum)}function defaultMusicXMLSettings(){DayPilot.Modal.confirm("Are you sure you want to reset the MusicXML import options to their default values?",{top:180,theme:"modal_flat",scrollWithPage:!1}).then(function(e){e.canceled||(resetMusicXMLImportOptions(),idleXMLImport())})}function ConfigureMusicXMLImport(){var e=JSON.parse(JSON.stringify(gMusicXMLImportOptions)),t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:50px;"">Configure MusicXML Import&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#musicxml" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></p>';t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Bars-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_bpl" type="text" pattern="d+" title="Default: 3"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Characters-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_cpl" type="text" pattern="d+" title="Default: 0 - ignore"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Measure numbers:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_mnum" type="text" pattern="d+" title="-1: No measure numbers, 1..n: Number every n-th measure, 0: Number every system"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Unfold repeats:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_unfld" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Credit text filter (level 0-6):&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_crf" type="text" pattern="[0123456]" title="0 (Default), 1, 2, 3, 4, 5, 6"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Denominator unit length for L: tags:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_den" type="text" pattern="dd?" title="0 (Automatic), 1, 2, 4, 8, 16, or 32"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">%%MIDI options:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_midi" type="text" pattern="[012]" title="0: No MIDI, 1: Only program, 2: All MIDI"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No score line breaks:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_nlb" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No pedal directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_noped" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">All directions to first voice:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_v1" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Translate stem directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_stems" type="checkbox"/></div>\n',t+='<p style="text-align:center;margin-top:22px;"><input id="default_musicxml_settings" class="btn btn-clearbutton default_musicxml_settings" onclick="defaultMusicXMLSettings()" type="button" value="Reset to Default" title="Reset the MusicXML import settings to their default values"></p>\n';let n=[{html:t}];setTimeout(function(){idleXMLImport()},150),DayPilot.Modal.form(n,{},{theme:"modal_flat",top:50,width:500,scrollWithPage:!1}).then(function(t){t.canceled?gMusicXMLImportOptions=e:gLocalStorageAvailable&&(localStorage.musicXMLImportOptions=JSON.stringify(gMusicXMLImportOptions))})}function resetAngloButtonNames(){gAngloButtonNames=["L1a","L2a","L3a","L4a","L5a","R1a","R2a","R3a","R4a","R5a","L1","L2","L3","L4","L5","R1","R2","R3","R4","R5","L6","L7","L8","L9","L10","R6","R7","R8","R9","R10"]}function defaultAngloButtonNames(){DayPilot.Modal.confirm("Are you sure you want to reset the Anglo Concertina button names to their default values?",{top:180,theme:"modal_flat",scrollWithPage:!1}).then(function(e){if(!e.canceled){for(resetAngloButtonNames(),i=0;i<10;++i){var t="r1c"+(i+1);document.getElementById(t).value=gAngloButtonNames[i]}for(i=0;i<10;++i){var t="r2c"+(i+1);document.getElementById(t).value=gAngloButtonNames[i+10]}for(i=0;i<10;++i){var t="r3c"+(i+1);document.getElementById(t).value=gAngloButtonNames[i+20]}}})}function initAngloButtonNames(){var e;for(e=0;e<10;++e){var t="r1c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e]}for(e=0;e<10;++e){var t="r2c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e+10]}for(e=0;e<10;++e){var t="r3c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e+20]}}function angloFingeringsChangeHandler(){var e;for(e=0;e<10;++e){var t="r1c"+(e+1);gAngloButtonNames[e]=document.getElementById(t).value}for(e=0;e<10;++e){var t="r2c"+(e+1);gAngloButtonNames[e+10]=document.getElementById(t).value}for(e=0;e<10;++e){var t="r3c"+(e+1);gAngloButtonNames[e+20]=document.getElementById(t).value}for(e=0;e<30;++e)""==gAngloButtonNames[e]&&(gAngloButtonNames[e]=" ")}function ConfigureAngloFingerings(){var e=gAngloButtonNames.slice(),t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:50px;">Configure Anglo Concertina Tablature Button Names&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#injecting_box_or_anglo_concertina_tablature" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>';t+='<div id="anglo-button-names-dialog">',t+='<table style="margin-bottom:24px;text-align:center;">\n',t+="<tr>\n",t+='<td><input class="anglobuttonnames" type="text" id="r1c1" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c2" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c3" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c4" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c5" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c7" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c8" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c9" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c10" onchange="angloFingeringsChangeHandler()"></td>\n',t+="</tr>\n",t+="<tr>\n",t+='<td><input class="anglobuttonnames" type="text" id="r2c1" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c2" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c3" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c4" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c5" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c7" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c8" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c9" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c10" onchange="angloFingeringsChangeHandler()"></td>\n',t+="</tr>\n",t+="<tr>\n",t+='<td><input class="anglobuttonnames" type="text" id="r3c1" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c2" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c3" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c4" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c5" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c7" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c8" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c9" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c10" onchange="angloFingeringsChangeHandler()"></td>\n',t+="</tr>\n",t+="</table>\n",t+="</div>\n",t+='<p style="text-align:center;margin-top:22px;"><input id="default_anglo_fingerings" class="btn btn-clearbutton default_anglo_fingerings" onclick="defaultAngloButtonNames()" type="button" value="Reset to Default" title="Reset the Anglo Concertina button names to their default values"></p>\n';let n=[{html:t}];setTimeout(function(){initAngloButtonNames()},150),DayPilot.Modal.form(n,{},{theme:"modal_flat",top:160,width:800,scrollWithPage:!1}).then(function(t){t.canceled?gAngloButtonNames=e:gLocalStorageAvailable&&(localStorage.angloButtonNames=JSON.stringify(gAngloButtonNames))})}function ConfigureTablatureSettings(){let e={configure_inject_directives:gInjectTab_InjectVolumeDirectives,configure_font_family:gInjectTab_FontFamily,configure_tab_font_size:gInjectTab_TabFontSize,configure_staffsep:gInjectTab_StaffSep,configure_musicspace:gInjectTab_MusicSpace,configure_tab_location:parseInt(gInjectTab_TabLocation),configure_concertina_style:parseInt(gInjectTab_ConcertinaStyle),configure_concertina_fingering:parseInt(gInjectTab_ConcertinaFingering),configure_strip_chords:gInjectTab_StripChords,configure_pushglyph:gInjectTab_PushGlyph,configure_drawglyph:gInjectTab_DrawGlyph,configure_use_bar_for_draw:gInjectTab_UseBarForDraw};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:50px;">Tablature Injection Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#injecting_box_or_anglo_concertina_tablature" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>'},{name:"    Inject %%MIDI directives to mute bass/chords",id:"configure_inject_directives",type:"checkbox",cssClass:"configure_box_settings_form_text"},{html:'<p style="margin-top:18px;font-size:12pt;line-height:14pt;font-family:helvetica"><strong>Tablature Font Settings:</strong></p>'},{name:"Font family (Recommended: Palatino):",id:"configure_font_family",type:"text",cssClass:"configure_box_settings_form_text_wide"},{name:"Tablature font size (Recommended: 10):",id:"configure_tab_font_size",type:"text",cssClass:"configure_box_settings_form_text"},{name:"%%staffsep value (Recommended: 80):",id:"configure_staffsep",type:"text",cssClass:"configure_box_settings_form_text"},{name:"%%musicspace value (Recommended: 10):",id:"configure_musicspace",type:"text",cssClass:"configure_box_settings_form_text"},{name:"Character(s) for Push indication (Clearing this field will reset to ↓ ):",id:"configure_pushglyph",type:"text",cssClass:"configure_box_settings_form_text"},{name:"Character(s) for Draw indication (Clearing this field will reset to ↑ ):",id:"configure_drawglyph",type:"text",cssClass:"configure_box_settings_form_text"},{name:"    Use a bar over button name to indicate Draw (overrides Push and Draw characters)",id:"configure_use_bar_for_draw",type:"checkbox",cssClass:"configure_box_settings_form_text"},{name:"Tab location relative to notation:",id:"configure_tab_location",type:"select",options:[{name:"  Above",id:"0"},{name:"  Below",id:"1"},],cssClass:"configure_box_settings_select"},{name:"    Strip all chords and tab before injecting tab (Tab below only. Tab above always strips.)",id:"configure_strip_chords",type:"checkbox",cssClass:"configure_box_settings_form_text"},{html:'<p style="margin-top:20px;font-size:12pt;line-height:12pt;font-family:helvetica"><strong>Anglo Concertina Tablature Settings:</strong></p>'},{name:"Concertina style:",id:"configure_concertina_style",type:"select",options:[{name:"  Jeffries",id:"0"},{name:"  Wheatstone",id:"1"},],cssClass:"configure_box_settings_select"},{name:"Preferred fingerings:",id:"configure_concertina_fingering",type:"select",options:[{name:"  On-Row",id:"0"},{name:"  Cross-Row",id:"1"},],cssClass:"configure_box_settings_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:12pt;font-family:helvetica">On-Row: Favors D5 and E5 on right-side C-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Cross-Row: Favors D5 and E5 on the left-side G-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Favors C5 on the left-side G-row draw, B4 on the right-side C-row draw.</p>'},{html:'<p style="text-align:center;margin-top:22px;"><input id="configure_anglo_fingerings" class="btn btn-subdialog configure_anglo_fingerings" onclick="ConfigureAngloFingerings()" type="button" value="Configure Anglo Concertina Tablature Button Names" title="Configure the Anglo Concertina tablature button names"></p>'},],e,{theme:"modal_flat",top:13,width:720,scrollWithPage:!1}).then(function(e){e.canceled||(gInjectTab_InjectVolumeDirectives=e.result.configure_inject_directives,gInjectTab_FontFamily=e.result.configure_font_family,gInjectTab_TabFontSize=e.result.configure_tab_font_size,gInjectTab_StaffSep=e.result.configure_staffsep,gInjectTab_MusicSpace=e.result.configure_musicspace,gInjectTab_TabLocation=e.result.configure_tab_location,gInjectTab_ConcertinaStyle=e.result.configure_concertina_style,gInjectTab_ConcertinaFingering=e.result.configure_concertina_fingering,gInjectTab_StripChords=e.result.configure_strip_chords,""==(gInjectTab_PushGlyph=e.result.configure_pushglyph)&&(gInjectTab_PushGlyph="↓"),""==(gInjectTab_DrawGlyph=e.result.configure_drawglyph)&&(gInjectTab_DrawGlyph="↑"),gInjectTab_UseBarForDraw=e.result.configure_use_bar_for_draw,SaveConfigurationSettings())})}function idleFontsDialog(){$('[name="configure_titlefont"]').val(gRenderingFonts.titlefont),$('[name="configure_subtitlefont"]').val(gRenderingFonts.subtitlefont),$('[name="configure_infofont"]').val(gRenderingFonts.infofont),$('[name="configure_partsfont"]').val(gRenderingFonts.partsfont),$('[name="configure_tempofont"]').val(gRenderingFonts.tempofont),$('[name="configure_textfont"]').val(gRenderingFonts.textfont),$('[name="configure_composerfont"]').val(gRenderingFonts.composerfont),$('[name="configure_annotationfont"]').val(gRenderingFonts.annotationfont),$('[name="configure_gchordfont"]').val(gRenderingFonts.gchordfont),$('[name="configure_vocalfont"]').val(gRenderingFonts.vocalfont),$('[name="configure_wordsfont"]').val(gRenderingFonts.wordsfont),$('[name="configure_tabnumberfont"]').val(gRenderingFonts.tabnumberfont),$('[name="configure_historyfont"]').val(gRenderingFonts.historyfont),$('[name="configure_voicefont"]').val(gRenderingFonts.voicefont)}function resetABCRenderingFonts(){gRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tabnumberfont:"Arial 12",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"}}function defaultFontSettings(){DayPilot.Modal.confirm("Are you sure you want to reset the ABC rendering fonts to their default values?",{top:180,theme:"modal_flat",scrollWithPage:!1}).then(function(e){e.canceled||(resetABCRenderingFonts(),idleFontsDialog())})}function ConfigureFonts(){let e={configure_titlefont:gRenderingFonts.titlefont,configure_subtitlefont:gRenderingFonts.subtitlefont,configure_infofont:gRenderingFonts.infofont,configure_partsfont:gRenderingFonts.partsfont,configure_tempofont:gRenderingFonts.tempofont,configure_textfont:gRenderingFonts.textfont,configure_composerfont:gRenderingFonts.composerfont,configure_annotationfont:gRenderingFonts.annotationfont,configure_gchordfont:gRenderingFonts.gchordfont,configure_vocalfont:gRenderingFonts.vocalfont,configure_wordsfont:gRenderingFonts.wordsfont,configure_tabnumberfont:gRenderingFonts.tabnumberfont,configure_historyfont:gRenderingFonts.historyfont,configure_voicefont:gRenderingFonts.voicefont};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:50px;">Configure ABC Rendering Fonts&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#configure_fonts" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>'},{name:"Title font (Default: Palatino 18):",id:"configure_titlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Subtitle font (Default: Palatino 13):",id:"configure_subtitlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Info font (Default: Palatino 13):",id:"configure_infofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Composer font (Default: Palatino 13):",id:"configure_composerfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tempo font (Default: Palatino 13):",id:"configure_tempofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Guitar chord font (Default: Verdana 12):",id:"configure_gchordfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab number font (Default: Arial 12):",id:"configure_tabnumberfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"History font (Default: Times New Roman 14):",id:"configure_historyfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Text font (Default: Palatino 13):",id:"configure_textfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Annotation font (Default: Palatino 13):",id:"configure_annotationfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Voice font (Default: Times New Roman 13):",id:"configure_voicefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Parts font (Default: Palatino 13):",id:"configure_partsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Vocal font (Default: Palatino 13):",id:"configure_vocalfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Words font (Default: Palatino 13):",id:"configure_wordsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{html:'<p style="text-align:center;margin-top:22px;"><input id="default_rendering_fonts" class="btn btn-clearbutton default_rendering_fonts" onclick="defaultFontSettings()" type="button" value="Reset to Default" title="Reset the ABC rendering fonts to their default values"></p>'}],e,{theme:"modal_flat",top:10,width:600,scrollWithPage:!1}).then(function(e){e.canceled||(gRenderingFonts.titlefont=e.result.configure_titlefont,gRenderingFonts.subtitlefont=e.result.configure_subtitlefont,gRenderingFonts.infofont=e.result.configure_infofont,gRenderingFonts.partsfont=e.result.configure_partsfont,gRenderingFonts.tempofont=e.result.configure_tempofont,gRenderingFonts.textfont=e.result.configure_textfont,gRenderingFonts.composerfont=e.result.configure_composerfont,gRenderingFonts.annotationfont=e.result.configure_annotationfont,gRenderingFonts.gchordfont=e.result.configure_gchordfont,gRenderingFonts.vocalfont=e.result.configure_vocalfont,gRenderingFonts.wordsfont=e.result.configure_wordsfont,gRenderingFonts.tabnumberfont=e.result.configure_tabnumberfont,gRenderingFonts.historyfont=e.result.configure_historyfont,gRenderingFonts.voicefont=e.result.configure_voicefont,Render(!0,null),SaveConfigurationSettings())})}function AddAutoPlay(){var e=urltextbox.value;-1==e.indexOf("&play=1")&&(e+="&play=1"),urltextbox.value=e}function SharingControlsDialog(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:50px;">ABC Transcription Tools Sharing Controls&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#sharing_controls" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>';e+='<div id="sharing-controls-dialog">',e+='<p style="margin-top:28px;">',e+='<input id="testurl" class="urlcontrols btn btn-urlcontrols" onclick="TestShareURL()" type="button" value="Test Share URL" title="Opens the Share URL in a new tab">',e+='<input id="copyurl" class="urlcontrols btn btn-urlcontrols" onclick="CopyShareURL()" type="button" value="Copy Share URL" title="Copies the Share URL to the clipboard">',e+='<input id="saveurl" class="urlcontrols btn btn-urlcontrols" onclick="SaveShareURL()" type="button" value="Save Share URL" title="Saves the Share URL to a file">',e+='<input id="shortenurl" class="urlcontrols btn btn-urlcontrols" onclick="ShortenURL()" type="button" value="Shorten URL" title="Shortens the Share URL and copies it to the clipboard">',e+='<input id="generateqrcode" class="urlcontrolslast btn btn-urlcontrols" onclick="GenerateQRCode(event)" type="button" value="Generate QR Code" title="Generates a QR Code for the Share URL.&nbsp;&nbsp;Even if this button is greyed-out, Shift-click attempts to generate a QR code from the text in the Share URL box.">',e+="</p>",e+='<p style="margin-top:24px;">',e+='<textarea id="urltextbox" rows="10" cols="80" spellcheck="false" autocorrect="off" autocapitalize="off" placeholder="URL for sharing will appear here" >',e+="</textarea>",e+="</p>",e+='<p id="shareurlcaption">Share URL</p>',e+='<p style="text-align:center;margin-top:36px;"><input id="addautoplay" class="urlcontrolslast btn btn-urlcontrols" onclick="AddAutoPlay()" type="button" value="Add Auto-Play" title="Adds &play=1 to the ShareURL"></p>',e+="</div>",setTimeout(function(){CreateURLfromHTML()},200),DayPilot.Modal.alert(e,{theme:"modal_flat",top:20,width:800,scrollWithPage:!1}).then(function(){})}function AdvancedControlsDialog(){gInAdvancedSettingsDialog=!0;var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:50px;">ABC Transcription Tools Advanced Controls&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#advanced_controls" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>';e+='<div id="advanced-controls-dialog">',e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">Show/Hide ABC Features</p>',e+='<p style="text-align:center;">',e+='<input id="toggleannotations" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleAnnotations(false)" type="button" value="Hide Annotations" title="Hides/Shows common annotations in the ABC notation">',e+='<input id="toggletext" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTextAnnotations(false)" type="button" value="Hide Text" title="Hides/Shows any text in the ABC notation.">',e+='<input id="togglechords" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleChords(false)" type="button" value="Hide Chords + Injected Tab" title="Hides/Shows any chords in the ABC notation.&nbsp;&nbsp;Also hides any Box or Anglo Concertina tablature.">',e+="</p>",e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">Strip ABC Features</p>',e+='<p style="text-align:center;">',e+='<input id="stripannotations" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleAnnotations(true)" type="button" value="Strip Annotations" title="Strips common annotations from the ABC">',e+='<input id="striptext" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTextAnnotations(true)" type="button" value="Strip Text" title="Strips all text from the ABC">',e+='<input id="stripchords" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleChords(true)" type="button" value="Strip Chords + Injected Tab" title="Strips all chords from the ABC.&nbsp;&nbsp;Also strips any Box or Anglo Concertina tablature.">',e+="</p>",e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">ABC Injection Features</p>',e+='<p style="text-align:center;">',e+='<input id="injectallheaders" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectPDFHeaders(true)" type="button" value="Inject All PDF Annotations" title="Injects all available tool-specific PDF tunebook annotations for title page, table of contents, index generation, etc. at the top of the ABC">',e+='<input id="injectheadertemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectPDFHeaders(false)" type="button" value="Inject PDF Tunebook Annotations Template" title="Injects a template of common useful PDF tunebook annotations at the top of the ABC">',e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectmelody" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectMIDIInstrument(false);" type="button" value="Inject MIDI Melody" title="Injects %%MIDI program melody annotation into all tunes in the ABC">',e+='<input id="injectchords" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectMIDIInstrument(true);" type="button" value="Inject MIDI Bass/Chord" title="Injects %%MIDI chordprog bass/chord annotation into all tunes in the ABC">',e+='<input id="injectnotenames" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectABCNoteNameLyrics()" type="button" value="Inject Note Name Lyrics" title="Injects note names as lyrics in the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectbctab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_BC()" type="button" value="Inject B/C Box Tab" title="Injects B/C box tablature into the ABC">',e+='<input id="injectcdtab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_CsD()" type="button" value="Inject C#/D Box Tab" title="Injects C#/D box tablature into the ABC">',e+='<input id="injectanglotab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Anglo()" type="button" value="Inject Anglo Concertina Tab" title="Injects Anglo Concertina tablature into the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectbambooflute" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Bamboo_Flute()" type="button" value="Inject Bamboo Flute Tab" title="Injects Bamboo flute tablature into the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;"><input id="configure_box_advanced" class="btn btn-subdialog configure_box_advanced " onclick="ConfigureTablatureSettings()" type="button" value="Configure Tablature Injection Settings" title="Configure the tablature injection settings"></p>',e+='<p style="text-align:center;margin-top:22px;"><input id="configure_batch_mp3_export" class="btn btn-batchmp3export configure_batch_mp3_export " onclick="BatchMP3Export()" type="button" value="Export all Tunes as MP3" title="Exports all the tunes in the ABC text area as .mp3 files"></p>',e+="</div>",setTimeout(function(){IdleAdvancedControls(!0),IdleAllowShowTabNames()},200),DayPilot.Modal.alert(e,{theme:"modal_flat",top:20,width:700,scrollWithPage:!1}).then(function(){gInAdvancedControlsDialog=!1})}function ConfigureToolSettings(e){if(e.shiftKey){ConfigureTablatureSettings();return}if(e.altKey){ConfigureMusicXMLImport();return}var t=gAlwaysInjectPrograms,n=gTheMelodyProgram,o=gTheChordProgram,a=gAlwaysInjectVolumes,r=gTheBassVolume,l=gTheChordVolume,s=gOverridePlayMIDIParams,g=gFullScreenScaling,d=gStaffSpacing-STAFFSPACEOFFSET,c=gShowTabNames,u=gCapo;let A={configure_inject_programs:t,configure_melody_program:n,configure_chord_program:o,configure_inject_volumes:a,configure_bass_volume:r,configure_chord_volume:l,configure_override_play_midi_params:s,configure_fullscreen_scaling:g,configure_staff_spacing:d,configure_large_player_controls:gLargePlayerControls,configure_show_tab_names:gShowTabNames,configure_capo:gCapo,configure_mp3_bitrate:gMP3Bitrate};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:50px;">ABC Transcription Tools Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="http://michaeleskin.com/abctools/userguide.html#settings_dialog" target="_blank" style="text-decoration:none;">\uD83D\uDCA1</a></span></p>'},{name:"Full screen tune display scaling (percentage):",id:"configure_fullscreen_scaling",type:"number",cssClass:"configure_settings_form_text"},{name:"Staff spacing (default is 10):",id:"configure_staff_spacing",type:"number",cssClass:"configure_settings_form_text"},{html:'<p style="font-size:4pt;font-family:helvetica">&nbsp;</p>'},{name:"    Show stringed instrument names on tablature (never shown in the Player)",id:"configure_show_tab_names",type:"checkbox",cssClass:"configure_box_settings_form_text"},{name:"Stringed instrument capo fret postion:",id:"configure_capo",type:"number",cssClass:"configure_settings_form_text"},{name:"            Use Default Melody and Bass/Chord programs when playing tunes",id:"configure_inject_programs",type:"checkbox",cssClass:"configure_settings_form_text"},{name:"Default Melody MIDI program (0-135):",id:"configure_melody_program",type:"number",cssClass:"configure_settings_form_text"},{name:"Default Bass/Chords MIDI program (0-135):",id:"configure_chord_program",type:"number",cssClass:"configure_settings_form_text"},{html:'<p style="margin-top:12px;font-size:12pt;line-height:14pt;font-family:helvetica">%%MIDI program or %%MIDI chordprog present in the ABC will override the default value.</p>'},{html:'<p style="font-size:12pt;font-family:helvetica;margin-bottom:12px;margin-top:12px;text-align:center"><a href="http://michaeleskin.com/documents/general_midi_extended.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'},{name:"            Use Default Bass/Chord volumes when playing tunes",id:"configure_inject_volumes",type:"checkbox",cssClass:"configure_settings_form_text"},{name:"Default Bass MIDI volume (0-127):",id:"configure_bass_volume",type:"number",cssClass:"configure_settings_form_text"},{name:"Default Chords MIDI volume (0-127):",id:"configure_chord_volume",type:"number",cssClass:"configure_settings_form_text"},{html:'<p style="margin-top:12px;margin-bottom:0px;font-size:12pt;line-height:14pt;font-family:helvetica">%MIDI bassvol or %%MIDI chordvol present in the ABC will override the default value.</p>'},{name:"            Override all MIDI programs and volumes in the ABC when playing tunes",id:"configure_override_play_midi_params",type:"checkbox",cssClass:"configure_settings_form_text"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:14pt;font-family:helvetica">To change the Melody volume, add !ppp!, !pp!, !p!, !mp!, !mf!, !f!, or !ff! before the first ABC note.</p>'},{name:"MP3 audio export bitrate (kbit/sec):",id:"configure_mp3_bitrate",type:"number",cssClass:"configure_settings_form_text"},{name:"    Player uses large controls (easier to touch on mobile and tablet)",id:"configure_large_player_controls",type:"checkbox",cssClass:"configure_box_settings_form_text"},{html:'<p style="text-align:center;"><input id="configure_fonts" class="btn btn-subdialog configure_fonts" onclick="ConfigureFonts()" type="button" value="Configure ABC Fonts" title="Configure the fonts used for rendering the ABC"><input id="configure_box" class="btn btn-subdialog configure_box" onclick="ConfigureTablatureSettings()" type="button" value="Configure Tablature Injection Settings" title="Configure the tablature injection settings"><input id="configure_musicxml_import" class="btn btn-subdialog configure_musicxml_import" onclick="ConfigureMusicXMLImport()" type="button" value="Configure MusicXML Import" title="Configure MusicXML import parameters"></p>'},],A,{theme:"modal_flat",top:10,width:780,scrollWithPage:!1}).then(function(e){if(e.canceled)gTheABC.focus();else{gAlwaysInjectPrograms=e.result.configure_inject_programs,gTheMelodyProgram=e.result.configure_melody_program,gTheChordProgram=e.result.configure_chord_program,gAlwaysInjectVolumes=e.result.configure_inject_volumes,gTheBassVolume=e.result.configure_bass_volume,gTheChordVolume=e.result.configure_chord_volume,gOverridePlayMIDIParams=e.result.configure_override_play_midi_params,gLargePlayerControls=e.result.configure_large_player_controls,gShowTabNames=e.result.configure_show_tab_names;var t=e.result.configure_staff_spacing;if(t=parseInt(t),isNaN(t)||void 0==t||(t<-1*STAFFSPACEOFFSET&&(t=-1*STAFFSPACEOFFSET),t!=d&&SetStaffSpacing(t)),isNaN(parseInt(gTheMelodyProgram))&&(gTheMelodyProgram=0),gTheMelodyProgram<0&&(gTheMelodyProgram=0),gTheMelodyProgram>135&&(gTheMelodyProgram=135),isNaN(parseInt(gTheChordProgram))&&(gTheChordProgram=0),gTheChordProgram<0&&(gTheChordProgram=0),gTheChordProgram>135&&(gTheChordProgram=135),isNaN(parseInt(gTheBassVolume))&&(gTheBassVolume=0),gTheBassVolume<0&&(gTheBassVolume=0),gTheBassVolume>127&&(gTheBassVolume=127),isNaN(parseInt(gTheChordVolume))&&(gTheChordVolume=0),gTheChordVolume<0&&(gTheChordVolume=0),gTheChordVolume>127&&(gTheChordVolume=127),(gAlwaysInjectPrograms||gOverridePlayMIDIParams)&&("15"==gTheMelodyProgram||"15"==gTheChordProgram)){var n='<p style="text-align:center;font-size:16pt;font-family:helvetica">Special Note on the Dulcimer (15) Instrument</p>';n+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Selecting the Dulcimer (15) program for either the melody or chords automatically sets all note release times to 4 seconds to allow the notes to ring.</p>',n+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">This can be useful for tunes using solo melody instruments with long release times like Orchestral Harp (46) or Koto (107).</p>',n+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">For those instruments played solo, set the melody instrument program as desired and the chord instrument program to Dulcimer (15).</p>',n+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">In this case, you may not want to include any chords in the ABC, as they will be played using the Dulcimer (15) instrument.</p>',DayPilot.Modal.alert(n,{theme:"modal_flat",top:50,width:600,scrollWithPage:!1}).then(function(){gTheABC.focus()})}isNaN(parseInt(gFullScreenScaling=(gFullScreenScaling=e.result.configure_fullscreen_scaling).replace("%","")))&&(gFullScreenScaling=50),gFullScreenScaling<25&&(gFullScreenScaling=25),gFullScreenScaling>100&&(gFullScreenScaling=100);var o=e.result.configure_capo;if(!isNaN(parseInt(o))){var a=parseInt(o);a>=0&&a<=12&&(gCapo=parseInt(o))}var r=parseInt(e.result.configure_mp3_bitrate);!isNaN(r)&&((gMP3Bitrate=r)<96&&(gMP3Bitrate=96),gMP3Bitrate>384&&(gMP3Bitrate=384)),IdleAllowShowTabNames(),SaveConfigurationSettings(),(c!=gShowTabNames||gAllowShowTabNames&&gCapo!=u)&&RenderAsync(!0,null,function(){gTheABC.focus()})}})}function isXML(e){return -1!=e.slice(0,100).indexOf("<?xml")}function importMusicXML(e){var t=$.parseXML(e),n=vertaal(t,gMusicXMLImportOptions)[0];return(n=(n=(n=(n=(n=(n=n.replaceAll("[K:treble]","")).replaceAll("[K:alto]","")).replaceAll("[K:alto1]","")).replaceAll("[K:alto2]","")).replaceAll("[K:tenor]","")).replaceAll("[K:bass]","")).replaceAll("[K:bass3]","")}function DoStartup(){if(gShowAdvancedControls=!1,gShowShareControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gRenderingPDF=!1,gAllowSave=!1,gAllowURLSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gIsMaximized=!1,gCapo=0,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gShowTabNames=!0,gAllowShowTabNames=!1,gLastAutoScrolledTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gLocalStorageAvailable=!1,gPDFQuality=.75,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gFullScreenScaling=50,HideMaximizeButton(),DoMaximize(),gIsSafari=!1,isSafari()&&(gIsSafari=!0),gIsChrome=!1,!gIsSafari&&isChrome()&&(gIsChrome=!0),gIsIOS=!1,isIOS()&&(gIsIOS=!0),gIsIPad=!1,isIPad()&&(gIsIPad=!0),gIsIPhone=!1,isIPhone()&&(gIsIPhone=!0),gIsAndroid=!1,isAndroid()&&(gIsAndroid=!0),gIsIOS&&document.getElementById("selectabcfile").removeAttribute("accept"),gIsIOS||gIsAndroid){var e=document.getElementById("toolpagetitle");e.size=4,e.style.fontFamily="Helvetica",(e=document.getElementById("notenlinks")).style.paddingTop="20px",(e=gTheABC).cols=74,e.style.fontSize="13pt",e.style.lineHeight="15pt",(e=document.getElementById("app-container")).style.width="860px",e.style.display="block",e.style.marginLeft="0px",(e=document.getElementById("notation-placeholder")).style.width="860px",e.style.display="none",(e=document.getElementById("noscroller")).style.width="860px",e.style.display="none",(e=document.getElementById("notation-holder")).style.width="820px",e.style.display="block",e.style.marginLeft="20px",e.style.marginRight="0px",e.style.overflow="hidden",(e=document.getElementById("notation-spacer")).style.width="860px",e.style.display="block",e.style.marginRight="0px",(e=document.getElementById("uioverlay")).style.width="860px",e.style.display="block",(e=document.getElementById("loading-bar-spinner")).style.top="36px",e.style.left="36px",e.style.marginLeft="-16px",e.style.marginTop="-16px",(e=document.getElementById("spinner-icon")).style.width="32px",e.style.height="32px"}(gIsIPhone||gIsAndroid)&&(document.getElementById("zoombutton").style.right="36px"),gIsIPad&&(document.getElementById("zoombutton").style.width="36px",document.getElementById("zoombutton").style.height="36px",document.getElementById("zoombutton").style.top="8px",document.getElementById("zoombutton").style.right="8px"),document.getElementById("abc").oninput=debounce(()=>{gForceFullRender?RenderAsync(!0,null):OnABCTextChange(),gForceFullRender=!1},DEBOUNCEMS),document.getElementById("abc").onclick=debounce(()=>{MakeTuneVisible(!1)},AUTOSCROLLDEBOUNCEMS),document.getElementById("selectabcfile").onchange=()=>{let e=document.getElementById("selectabcfile");if(0===e.files.length){DayPilot.Modal.alert("Please select an ABC or MusicXML file",{theme:"modal_flat",top:50,scrollWithPage:!1});return}let t=e.files[0];if(ensureABCFile(t.name)){var n=-1!=t.name.toLowerCase().indexOf(".mxl");if(gTheABC.value="",Render(!0,null),document.getElementById("abc-selected").innerText="Loading: "+t.name,gDisplayedName=t.name,n){new JSZip().loadAsync(t).then(function(e){e.files["META-INF/container.xml"].async("string").then(function(t){var n=$.parseXML(t).getElementsByTagName("rootfile")[0].getAttribute("full-path");e.files[n].async("string").then(function(e){if(isXML(e))e=importMusicXML(e);else{DayPilot.Modal.alert("This is not a valid MXL file.",{theme:"modal_flat",top:50,scrollWithPage:!1});return}gTheABC.value=e,FocusABC(),setTimeout(function(){RestoreDefaults(),window.scrollTo({top:0}),gABCFromFile=!0,RenderAsync(!0,null,function(){UpdateNotationTopPosition()})},100)})},function(){DayPilot.Modal.alert("This is not a valid MXL file.",{theme:"modal_flat",top:50,scrollWithPage:!1})})},function(){DayPilot.Modal.alert("This is not a valid MXL file.",{theme:"modal_flat",top:50,scrollWithPage:!1})});return}let o=new FileReader;o.addEventListener("load",e=>{var t=e.target.result;isXML(t)&&(t=importMusicXML(t)),gTheABC.value=t,FocusABC(),setTimeout(function(){RestoreDefaults(),window.scrollTo({top:0}),gABCFromFile=!0,RenderAsync(!0,null,function(){UpdateNotationTopPosition()})},100)}),o.readAsText(t)}},SetRadioValue("notenodertab","noten"),document.getElementById("pdfformat").value="one",document.getElementById("pagenumbers").value="none",document.getElementById("firstpage").value="yes",document.getElementById("zoombutton").onclick=function(){ToggleMaximize()},gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,ClearNoRender(),resetAngloButtonNames(),resetMusicXMLImportOptions(),window.localStorage&&(gLocalStorageAvailable=!0,GetInitialConfigurationSettings());var t=processShareLink();t?(isFirstRun()&&showZoomInstructionsScreen(),UpdateLocalStorage()):(DoMinimize(),document.getElementById("notation-placeholder").style.display="block",restoreStateFromLocalStorage()),UpdateNotationTopPosition(),new ResizeObserver(TextBoxResizeHandler).observe(gTheABC),gIsIOS||gIsAndroid||(window.onresize=function(){HandleWindowResize()}),HandleWindowResize(),ShowAllControls(),t||(document.getElementById("toggleallcontrols").classList.add("toggleallcontrolsdisabled"),document.getElementById("notenrechts").style.display="none",gAllowControlToggle=!1),gTheABC.focus()}function WaitForReady(e){if("loading"!==document.readyState){e();return}document.addEventListener("DOMContentLoaded",e)}WaitForReady(DoStartup);
